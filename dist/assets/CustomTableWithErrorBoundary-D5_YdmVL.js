var Ft=Object.defineProperty;var Lt=(n,r,a)=>r in n?Ft(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a;var ct=(n,r,a)=>Lt(n,typeof r!="symbol"?r+"":r,a);import{e as Ze,R as Mt,j as e,C as bt,g as yt,h as _t,k as wt,B as Z,a0 as Pt,c as we,r as u,a1 as Q,a as lt,L as Me,I as Re,i as $t,l as ge,x as Ut,a9 as Ct,aa as jt,ab as vt,ac as tt,aE as dt,ad as st,aF as Nt,aD as zt,o as rt,p as at,q as nt,t as it,v as $e,aB as St,_ as ze,$ as qt,ar as Bt,ak as Ht}from"./index-BECPHSeM.js";import{S as Vt}from"./switch-tBURA5Tk.js";import{S as Wt}from"./save-DH-CNVZ5.js";import{R as kt}from"./refresh-cw-CHMT192_.js";import{A as Gt}from"./CustomTable-CXdPKneF.js";import{P as Kt}from"./plus-BPHhOq-4.js";import{S as Xt}from"./square-pen-BWMCnksF.js";import{C as Et}from"./checkbox-CraTRF2W.js";import{S as Qt}from"./sliders-horizontal-BJXosotJ.js";import{T as Yt,a as Jt,b as He,c as ut,d as Zt,e as Ve}from"./table-ClZeedXs.js";import{T as Rt}from"./trash-2-De5E7ujL.js";import{D as Dt,b as Ot,c as Ge,d as Ke,e as Xe,f as Qe}from"./dialog-DvxtJGTz.js";import{T as es}from"./textarea-D4iZ-kUl.js";import{C as ts}from"./chevron-left-CSZGt6Wi.js";import"./index-DphnJHhj.js";import"./x-WtqlxTpi.js";/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],rs=Ze("file-spreadsheet",ss);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ns=Ze("file-text",as);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ls=Ze("funnel",is);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],cs=Ze("triangle-alert",os);class ds extends Mt.Component{constructor(a){super(a);ct(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,i){this.setState({error:a,errorInfo:i})}render(){return this.state.hasError?e.jsxs(bt,{className:"mx-[6rem] mt-8",children:[e.jsx(yt,{children:e.jsxs(_t,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(cs,{className:"h-5 w-5"}),"Something went wrong"]})}),e.jsxs(wt,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"The table encountered an error. Please try refreshing the page."}),!1,e.jsx(Z,{onClick:this.handleReset,children:"Reload Page"})]})]}):this.props.children}}var Ye={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var us=Ye.exports,ht;function hs(){return ht||(ht=1,function(n,r){((a,i)=>{n.exports=i()})(us,function a(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},d,m=!i.document&&!!i.postMessage,h=i.IS_PAPA_WORKER||!1,C={},j=0,l={};function N(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(s){var c=he(s);c.chunkSize=parseInt(c.chunkSize),s.step||s.chunk||(c.chunkSize=null),this._handle=new p(c),(this._handle.streamer=this)._config=c}).call(this,t),this.parseChunk=function(s,c){var g=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<g){let k=this._config.newline;k||(x=this._config.quoteChar||'"',k=this._handle.guessLineEndings(s,x)),s=[...s.split(k).slice(g)].join(k)}this.isFirstChunk&&_(this._config.beforeFirstChunk)&&(x=this._config.beforeFirstChunk(s))!==void 0&&(s=x),this.isFirstChunk=!1,this._halted=!1;var g=this._partialLine+s,x=(this._partialLine="",this._handle.parse(g,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(s=x.meta.cursor,g=(this._finished||(this._partialLine=g.substring(s-this._baseIndex),this._baseIndex=s),x&&x.data&&(this._rowCount+=x.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),h)i.postMessage({results:x,workerId:l.WORKER_ID,finished:g});else if(_(this._config.chunk)&&!c){if(this._config.chunk(x,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=x=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(x.data),this._completeResults.errors=this._completeResults.errors.concat(x.errors),this._completeResults.meta=x.meta),this._completed||!g||!_(this._config.complete)||x&&x.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),g||x&&x.meta.paused||this._nextChunk(),x}this._halted=!0},this._sendError=function(s){_(this._config.error)?this._config.error(s):h&&this._config.error&&i.postMessage({workerId:l.WORKER_ID,error:s,finished:!1})}}function z(t){var s;(t=t||{}).chunkSize||(t.chunkSize=l.RemoteChunkSize),N.call(this,t),this._nextChunk=m?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(c){this._input=c,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),m||(s.onload=W(this._chunkLoaded,this),s.onerror=W(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!m),this._config.downloadRequestHeaders){var c,g=this._config.downloadRequestHeaders;for(c in g)s.setRequestHeader(c,g[c])}var x;this._config.chunkSize&&(x=this._start+this._config.chunkSize-1,s.setRequestHeader("Range","bytes="+this._start+"-"+x));try{s.send(this._config.downloadRequestBody)}catch(k){this._chunkError(k.message)}m&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize||s.responseText.length,this._finished=!this._config.chunkSize||this._start>=(c=>(c=c.getResponseHeader("Content-Range"))!==null?parseInt(c.substring(c.lastIndexOf("/")+1)):-1)(s),this.parseChunk(s.responseText)))},this._chunkError=function(c){c=s.statusText||c,this._sendError(new Error(c))}}function H(t){(t=t||{}).chunkSize||(t.chunkSize=l.LocalChunkSize),N.call(this,t);var s,c,g=typeof FileReader<"u";this.stream=function(x){this._input=x,c=x.slice||x.webkitSlice||x.mozSlice,g?((s=new FileReader).onload=W(this._chunkLoaded,this),s.onerror=W(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var x=this._input,k=(this._config.chunkSize&&(k=Math.min(this._start+this._config.chunkSize,this._input.size),x=c.call(x,this._start,k)),s.readAsText(x,this._config.encoding));g||this._chunkLoaded({target:{result:k}})},this._chunkLoaded=function(x){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(x.target.result)},this._chunkError=function(){this._sendError(s.error)}}function M(t){var s;N.call(this,t=t||{}),this.stream=function(c){return s=c,this._nextChunk()},this._nextChunk=function(){var c,g;if(!this._finished)return c=this._config.chunkSize,s=c?(g=s.substring(0,c),s.substring(c)):(g=s,""),this._finished=!s,this.parseChunk(g)}}function o(t){N.call(this,t=t||{});var s=[],c=!0,g=!1;this.pause=function(){N.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){N.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(x){this._input=x,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){g&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):c=!0},this._streamData=W(function(x){try{s.push(typeof x=="string"?x:x.toString(this._config.encoding)),c&&(c=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(k){this._streamError(k)}},this),this._streamError=W(function(x){this._streamCleanUp(),this._sendError(x)},this),this._streamEnd=W(function(){this._streamCleanUp(),g=!0,this._streamData("")},this),this._streamCleanUp=W(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function p(t){var s,c,g,x,k=Math.pow(2,53),q=-k,pe=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,be=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,L=this,G=0,S=0,ce=!1,E=!1,A=[],y={data:[],errors:[],meta:{}};function V(P){return t.skipEmptyLines==="greedy"?P.join("").trim()==="":P.length===1&&P[0].length===0}function ae(){if(y&&g&&(ye("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),g=!1),t.skipEmptyLines&&(y.data=y.data.filter(function(R){return!V(R)})),de()){let R=function(te,le){_(t.transformHeader)&&(te=t.transformHeader(te,le)),A.push(te)};if(y)if(Array.isArray(y.data[0])){for(var P=0;de()&&P<y.data.length;P++)y.data[P].forEach(R);y.data.splice(0,1)}else y.data.forEach(R)}function U(R,te){for(var le=t.header?{}:[],K=0;K<R.length;K++){var B=K,F=R[K],F=((Ce,T)=>(J=>(t.dynamicTypingFunction&&t.dynamicTyping[J]===void 0&&(t.dynamicTyping[J]=t.dynamicTypingFunction(J)),(t.dynamicTyping[J]||t.dynamicTyping)===!0))(Ce)?T==="true"||T==="TRUE"||T!=="false"&&T!=="FALSE"&&((J=>{if(pe.test(J)&&(J=parseFloat(J),q<J&&J<k))return 1})(T)?parseFloat(T):be.test(T)?new Date(T):T===""?null:T):T)(B=t.header?K>=A.length?"__parsed_extra":A[K]:B,F=t.transform?t.transform(F,B):F);B==="__parsed_extra"?(le[B]=le[B]||[],le[B].push(F)):le[B]=F}return t.header&&(K>A.length?ye("FieldMismatch","TooManyFields","Too many fields: expected "+A.length+" fields but parsed "+K,S+te):K<A.length&&ye("FieldMismatch","TooFewFields","Too few fields: expected "+A.length+" fields but parsed "+K,S+te)),le}var Y;y&&(t.header||t.dynamicTyping||t.transform)&&(Y=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(U),Y=y.data.length):y.data=U(y.data,0),t.header&&y.meta&&(y.meta.fields=A),S+=Y)}function de(){return t.header&&A.length===0}function ye(P,U,Y,R){P={type:P,code:U,message:Y},R!==void 0&&(P.row=R),y.errors.push(P)}_(t.step)&&(x=t.step,t.step=function(P){y=P,de()?ae():(ae(),y.data.length!==0&&(G+=P.data.length,t.preview&&G>t.preview?c.abort():(y.data=y.data[0],x(y,L))))}),this.parse=function(P,U,Y){var R=t.quoteChar||'"',R=(t.newline||(t.newline=this.guessLineEndings(P,R)),g=!1,t.delimiter?_(t.delimiter)&&(t.delimiter=t.delimiter(P),y.meta.delimiter=t.delimiter):((R=((te,le,K,B,F)=>{var Ce,T,J,Se;F=F||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var ke=0;ke<F.length;ke++){for(var je,Oe=F[ke],ue=0,ve=0,oe=0,xe=(J=void 0,new re({comments:B,delimiter:Oe,newline:le,preview:10}).parse(te)),_e=0;_e<xe.data.length;_e++)K&&V(xe.data[_e])?oe++:(je=xe.data[_e].length,ve+=je,J===void 0?J=je:0<je&&(ue+=Math.abs(je-J),J=je));0<xe.data.length&&(ve/=xe.data.length-oe),(T===void 0||ue<=T)&&(Se===void 0||Se<ve)&&1.99<ve&&(T=ue,Ce=Oe,Se=ve)}return{successful:!!(t.delimiter=Ce),bestDelimiter:Ce}})(P,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=R.bestDelimiter:(g=!0,t.delimiter=l.DefaultDelimiter),y.meta.delimiter=t.delimiter),he(t));return t.preview&&t.header&&R.preview++,s=P,c=new re(R),y=c.parse(s,U,Y),ae(),ce?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return ce},this.pause=function(){ce=!0,c.abort(),s=_(t.chunk)?"":s.substring(c.getCharIndex())},this.resume=function(){L.streamer._halted?(ce=!1,L.streamer.parseChunk(s,!0)):setTimeout(L.resume,3)},this.aborted=function(){return E},this.abort=function(){E=!0,c.abort(),y.meta.aborted=!0,_(t.complete)&&t.complete(y),s=""},this.guessLineEndings=function(te,R){te=te.substring(0,1048576);var R=new RegExp(w(R)+"([^]*?)"+w(R),"gm"),Y=(te=te.replace(R,"")).split("\r"),R=te.split(`
`),te=1<R.length&&R[0].length<Y[0].length;if(Y.length===1||te)return`
`;for(var le=0,K=0;K<Y.length;K++)Y[K][0]===`
`&&le++;return le>=Y.length/2?`\r
`:"\r"}}function w(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function re(t){var s=(t=t||{}).delimiter,c=t.newline,g=t.comments,x=t.step,k=t.preview,q=t.fastMode,pe=null,be=!1,L=t.quoteChar==null?'"':t.quoteChar,G=L;if(t.escapeChar!==void 0&&(G=t.escapeChar),(typeof s!="string"||-1<l.BAD_DELIMITERS.indexOf(s))&&(s=","),g===s)throw new Error("Comment character same as delimiter");g===!0?g="#":(typeof g!="string"||-1<l.BAD_DELIMITERS.indexOf(g))&&(g=!1),c!==`
`&&c!=="\r"&&c!==`\r
`&&(c=`
`);var S=0,ce=!1;this.parse=function(E,A,y){if(typeof E!="string")throw new Error("Input must be a string");var V=E.length,ae=s.length,de=c.length,ye=g.length,P=_(x),U=[],Y=[],R=[],te=S=0;if(!E)return ue();if(q||q!==!1&&E.indexOf(L)===-1){for(var le=E.split(c),K=0;K<le.length;K++){if(R=le[K],S+=R.length,K!==le.length-1)S+=c.length;else if(y)return ue();if(!g||R.substring(0,ye)!==g){if(P){if(U=[],Se(R.split(s)),ve(),ce)return ue()}else Se(R.split(s));if(k&&k<=K)return U=U.slice(0,k),ue(!0)}}return ue()}for(var B=E.indexOf(s,S),F=E.indexOf(c,S),Ce=new RegExp(w(G)+w(L),"g"),T=E.indexOf(L,S);;)if(E[S]===L)for(T=S,S++;;){if((T=E.indexOf(L,T+1))===-1)return y||Y.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:U.length,index:S}),je();if(T===V-1)return je(E.substring(S,T).replace(Ce,L));if(L===G&&E[T+1]===G)T++;else if(L===G||T===0||E[T-1]!==G){B!==-1&&B<T+1&&(B=E.indexOf(s,T+1));var J=ke((F=F!==-1&&F<T+1?E.indexOf(c,T+1):F)===-1?B:Math.min(B,F));if(E.substr(T+1+J,ae)===s){R.push(E.substring(S,T).replace(Ce,L)),E[S=T+1+J+ae]!==L&&(T=E.indexOf(L,S)),B=E.indexOf(s,S),F=E.indexOf(c,S);break}if(J=ke(F),E.substring(T+1+J,T+1+J+de)===c){if(R.push(E.substring(S,T).replace(Ce,L)),Oe(T+1+J+de),B=E.indexOf(s,S),T=E.indexOf(L,S),P&&(ve(),ce))return ue();if(k&&U.length>=k)return ue(!0);break}Y.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:U.length,index:S}),T++}}else if(g&&R.length===0&&E.substring(S,S+ye)===g){if(F===-1)return ue();S=F+de,F=E.indexOf(c,S),B=E.indexOf(s,S)}else if(B!==-1&&(B<F||F===-1))R.push(E.substring(S,B)),S=B+ae,B=E.indexOf(s,S);else{if(F===-1)break;if(R.push(E.substring(S,F)),Oe(F+de),P&&(ve(),ce))return ue();if(k&&U.length>=k)return ue(!0)}return je();function Se(oe){U.push(oe),te=S}function ke(oe){var xe=0;return xe=oe!==-1&&(oe=E.substring(T+1,oe))&&oe.trim()===""?oe.length:xe}function je(oe){return y||(oe===void 0&&(oe=E.substring(S)),R.push(oe),S=V,Se(R),P&&ve()),ue()}function Oe(oe){S=oe,Se(R),R=[],F=E.indexOf(c,S)}function ue(oe){if(t.header&&!A&&U.length&&!be){var xe=U[0],_e={},Ie=new Set(xe);let Le=!1;for(let Ee=0;Ee<xe.length;Ee++){let Ne=xe[Ee];if(_e[Ne=_(t.transformHeader)?t.transformHeader(Ne,Ee):Ne]){let f,O=_e[Ne];for(;f=Ne+"_"+O,O++,Ie.has(f););Ie.add(f),xe[Ee]=f,_e[Ne]++,Le=!0,(pe=pe===null?{}:pe)[f]=Ne}else _e[Ne]=1,xe[Ee]=Ne;Ie.add(Ne)}be=!0}return{data:U,errors:Y,meta:{delimiter:s,linebreak:c,aborted:ce,truncated:!!oe,cursor:te+(A||0),renamedHeaders:pe}}}function ve(){x(ue()),U=[],Y=[]}},this.abort=function(){ce=!0},this.getCharIndex=function(){return S}}function fe(t){var s=t.data,c=C[s.workerId],g=!1;if(s.error)c.userError(s.error,s.file);else if(s.results&&s.results.data){var x={abort:function(){g=!0,X(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ee,resume:ee};if(_(c.userStep)){for(var k=0;k<s.results.data.length&&(c.userStep({data:s.results.data[k],errors:s.results.errors,meta:s.results.meta},x),!g);k++);delete s.results}else _(c.userChunk)&&(c.userChunk(s.results,x,s.file),delete s.results)}s.finished&&!g&&X(s.workerId,s.results)}function X(t,s){var c=C[t];_(c.userComplete)&&c.userComplete(s),c.terminate(),delete C[t]}function ee(){throw new Error("Not implemented.")}function he(t){if(typeof t!="object"||t===null)return t;var s,c=Array.isArray(t)?[]:{};for(s in t)c[s]=he(t[s]);return c}function W(t,s){return function(){t.apply(s,arguments)}}function _(t){return typeof t=="function"}return l.parse=function(t,s){var c=(s=s||{}).dynamicTyping||!1;if(_(c)&&(s.dynamicTypingFunction=c,c={}),s.dynamicTyping=c,s.transform=!!_(s.transform)&&s.transform,!s.worker||!l.WORKERS_SUPPORTED)return c=null,l.NODE_STREAM_INPUT,typeof t=="string"?(t=(g=>g.charCodeAt(0)!==65279?g:g.slice(1))(t),c=new(s.download?z:M)(s)):t.readable===!0&&_(t.read)&&_(t.on)?c=new o(s):(i.File&&t instanceof File||t instanceof Object)&&(c=new H(s)),c.stream(t);(c=(()=>{var g;return!!l.WORKERS_SUPPORTED&&(g=(()=>{var x=i.URL||i.webkitURL||null,k=a.toString();return l.BLOB_URL||(l.BLOB_URL=x.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",k,")();"],{type:"text/javascript"})))})(),(g=new i.Worker(g)).onmessage=fe,g.id=j++,C[g.id]=g)})()).userStep=s.step,c.userChunk=s.chunk,c.userComplete=s.complete,c.userError=s.error,s.step=_(s.step),s.chunk=_(s.chunk),s.complete=_(s.complete),s.error=_(s.error),delete s.worker,c.postMessage({input:t,config:s,workerId:c.id})},l.unparse=function(t,s){var c=!1,g=!0,x=",",k=`\r
`,q='"',pe=q+q,be=!1,L=null,G=!1,S=((()=>{if(typeof s=="object"){if(typeof s.delimiter!="string"||l.BAD_DELIMITERS.filter(function(A){return s.delimiter.indexOf(A)!==-1}).length||(x=s.delimiter),typeof s.quotes!="boolean"&&typeof s.quotes!="function"&&!Array.isArray(s.quotes)||(c=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(be=s.skipEmptyLines),typeof s.newline=="string"&&(k=s.newline),typeof s.quoteChar=="string"&&(q=s.quoteChar),typeof s.header=="boolean"&&(g=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");L=s.columns}s.escapeChar!==void 0&&(pe=s.escapeChar+q),s.escapeFormulae instanceof RegExp?G=s.escapeFormulae:typeof s.escapeFormulae=="boolean"&&s.escapeFormulae&&(G=/^[=+\-@\t\r].*$/)}})(),new RegExp(w(q),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return ce(null,t,be);if(typeof t[0]=="object")return ce(L||Object.keys(t[0]),t,be)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||L),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),ce(t.fields||[],t.data||[],be);throw new Error("Unable to serialize unrecognized input");function ce(A,y,V){var ae="",de=(typeof A=="string"&&(A=JSON.parse(A)),typeof y=="string"&&(y=JSON.parse(y)),Array.isArray(A)&&0<A.length),ye=!Array.isArray(y[0]);if(de&&g){for(var P=0;P<A.length;P++)0<P&&(ae+=x),ae+=E(A[P],P);0<y.length&&(ae+=k)}for(var U=0;U<y.length;U++){var Y=(de?A:y[U]).length,R=!1,te=de?Object.keys(y[U]).length===0:y[U].length===0;if(V&&!de&&(R=V==="greedy"?y[U].join("").trim()==="":y[U].length===1&&y[U][0].length===0),V==="greedy"&&de){for(var le=[],K=0;K<Y;K++){var B=ye?A[K]:K;le.push(y[U][B])}R=le.join("").trim()===""}if(!R){for(var F=0;F<Y;F++){0<F&&!te&&(ae+=x);var Ce=de&&ye?A[F]:F;ae+=E(y[U][Ce],F)}U<y.length-1&&(!V||0<Y&&!te)&&(ae+=k)}}return ae}function E(A,y){var V,ae;return A==null?"":A.constructor===Date?JSON.stringify(A).slice(1,25):(ae=!1,G&&typeof A=="string"&&G.test(A)&&(A="'"+A,ae=!0),V=A.toString().replace(S,pe),(ae=ae||c===!0||typeof c=="function"&&c(A,y)||Array.isArray(c)&&c[y]||((de,ye)=>{for(var P=0;P<ye.length;P++)if(-1<de.indexOf(ye[P]))return!0;return!1})(V,l.BAD_DELIMITERS)||-1<V.indexOf(x)||V.charAt(0)===" "||V.charAt(V.length-1)===" ")?q+V+q:V)}},l.RECORD_SEP="",l.UNIT_SEP="",l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!m&&!!i.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=re,l.ParserHandle=p,l.NetworkStreamer=z,l.FileStreamer=H,l.StringStreamer=M,l.ReadableStreamStreamer=o,i.jQuery&&((d=i.jQuery).fn.parse=function(t){var s=t.config||{},c=[];return this.each(function(k){if(!(d(this).prop("tagName").toUpperCase()==="INPUT"&&d(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var q=0;q<this.files.length;q++)c.push({file:this.files[q],inputElem:this,instanceConfig:d.extend({},s)})}),g(),this;function g(){if(c.length===0)_(t.complete)&&t.complete();else{var k,q,pe,be,L=c[0];if(_(t.before)){var G=t.before(L.file,L.inputElem);if(typeof G=="object"){if(G.action==="abort")return k="AbortError",q=L.file,pe=L.inputElem,be=G.reason,void(_(t.error)&&t.error({name:k},q,pe,be));if(G.action==="skip")return void x();typeof G.config=="object"&&(L.instanceConfig=d.extend(L.instanceConfig,G.config))}else if(G==="skip")return void x()}var S=L.instanceConfig.complete;L.instanceConfig.complete=function(ce){_(S)&&S(ce,L.file,L.inputElem),x()},l.parse(L.file,L.instanceConfig)}}function x(){c.splice(0,1),g()}}),h&&(i.onmessage=function(t){t=t.data,l.WORKER_ID===void 0&&t&&(l.WORKER_ID=t.workerId),typeof t.input=="string"?i.postMessage({workerId:l.WORKER_ID,results:l.parse(t.input,t.config),finished:!0}):(i.File&&t.input instanceof File||t.input instanceof Object)&&(t=l.parse(t.input,t.config))&&i.postMessage({workerId:l.WORKER_ID,results:t,finished:!0})}),(z.prototype=Object.create(N.prototype)).constructor=z,(H.prototype=Object.create(N.prototype)).constructor=H,(M.prototype=Object.create(M.prototype)).constructor=M,(o.prototype=Object.create(N.prototype)).constructor=o,l})}(Ye)),Ye.exports}var fs=hs();const ms=Pt(fs),se={debug:(...n)=>{},info:(...n)=>{},warn:(...n)=>{},error:(...n)=>{},group:(n,r)=>{}},Te="https://click.wa.expert/api",De={fetchRecords:async n=>{try{se.debug("Fetching records with params:",n);const r=await we.post(`${Te}/data/getAllData`,n);return{data:r.data.data||[],columns:r.data.columns||[],success:!0}}catch(r){throw se.error("Error fetching records:",r),r}},fetchPaymentRecords:async n=>{try{const r=await we.get(`${Te}/payment-reminders/list?owner_id=${n}`);return{data:r.data.data||r.data||[],success:!0}}catch(r){throw se.error("Error fetching payment records:",r),r}},fetchRecordById:async(n,r)=>{try{const a=decodeURIComponent(r);return{data:(await we.post(`${Te}/data/getRecordById`,{schemaName:n.schemaName,tableName:n.tableName,id:a})).data,success:!0}}catch(a){return se.error("Error fetching record by ID:",a),{data:null,success:!1,error:a.message}}},createRecord:async(n,r)=>{try{return{data:(await we.post(`${Te}/data/createRecord`,{schemaName:n.schemaName,tableName:n.tableName,record:r})).data,success:!0}}catch(a){throw se.error("Error creating record:",a),a}},createPaymentReminder:async n=>{try{return{data:(await we.post(`${Te}/payment-reminders/add`,n,{headers:{"Content-Type":"application/json"}})).data,success:!0}}catch(r){throw se.error("Error creating payment reminder:",r),r}},updateRecord:async(n,r,a,i)=>{try{return{data:(await we.post(`${Te}/data/updateMultiple`,{schemaName:n.schemaName,tableName:n.tableName,recordId:r,ownerId:a,updates:i},{headers:{"Content-Type":"application/json"}})).data,success:!0}}catch(d){throw se.error("Error updating record:",d),d}},deleteRecord:async(n,r)=>{try{const a=new URLSearchParams({id:r,schemaName:n.schemaName,tableName:n.tableName});return{data:(await we.get(`${Te}/data/deleteRecord?${a.toString()}`)).data,success:!0}}catch(a){throw se.error("Error deleting record:",a),a}},fetchDropdownSetup:async(n,r)=>{try{const a=await we.get(`${Te}/reference/setup/check?owner_id=${n}&product_name=${r}`);return a.data.exists&&a.data.setup?{mapping:a.data.setup.mapping||{},columnOrder:a.data.setup.columnOrder||{},exists:!0,success:!0}:{mapping:{},columnOrder:{},exists:!1,success:!0}}catch(a){return se.error("Error fetching dropdown setup:",a),{mapping:{},columnOrder:{},exists:!1,success:!1}}}},ps={DEFAULT_PAGE_SIZE:20},me={TEXT:"text",NUMBER:"number",EMAIL:"email",PHONE:"tel",URL:"url",DATE:"date",TEXTAREA:"textarea",CHECKBOX:"checkbox",SELECT_STATUS:"select-status",SELECT_PRIORITY:"select-priority"},et={PENDING:"pending",IN_PROGRESS:"in progress",COMPLETED:"completed"},Pe={LOW:"low",MEDIUM:"medium",HIGH:"high"},At={[et.PENDING]:"bg-yellow-100 text-yellow-700 border-yellow-200",[et.IN_PROGRESS]:"bg-blue-100 text-blue-700 border-blue-200",[et.COMPLETED]:"bg-green-100 text-green-700 border-green-200",default:"bg-gray-100 text-gray-700 border-gray-200"},Tt={[Pe.HIGH]:"bg-red-100 text-red-700 border-red-200",[Pe.MEDIUM]:"bg-orange-100 text-orange-700 border-orange-200",[Pe.LOW]:"bg-green-100 text-green-700 border-green-200",default:"bg-gray-100 text-gray-700 border-gray-200"},xs=["invoice","date","due_date","final_due_date","last_overdue_reminder_date","sent_at","created_at","updated_at"],gs=["out_webhooks","emails"],We={PA_ID:"pa_id",US_ID:"us_id"},bs=n=>n.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),ys=(n,r)=>{const a=r.toLowerCase();return a.includes("email")?me.EMAIL:a.includes("phone")?me.PHONE:a.includes("url")||a.includes("link")||a.includes("invoice_url")?me.URL:a==="status"?me.SELECT_STATUS:a==="priority"?me.SELECT_PRIORITY:a.includes("description")||a.includes("notes")||a.includes("comment")?me.TEXTAREA:a.includes("date")||a.includes("created")||a.includes("updated")||a==="invoice"?me.DATE:typeof n=="number"?me.NUMBER:typeof n=="boolean"?me.CHECKBOX:n&&n.length>100?me.TEXTAREA:me.TEXT},It=()=>Date.now().toString(),Je=(n,r)=>r[n==null?void 0:n.toLowerCase()]||r.default,ft=(n,r=null)=>n.filter(a=>{if(a.id==="id"||a.id.includes("_comment")||a.id.includes("created_at")||a.id.includes("updated_at"))return!1;if(r){const i=a.id.toLowerCase(),d=a.name.toLowerCase();if(i.includes("balance")||d.includes("balance"))return!1}return!0}),mt=(n,r={})=>n.filter(a=>r[a.id]!==0).sort((a,i)=>{const d=r[a.id]||999,m=r[i.id]||999;return d!==m?d-m:a.name.localeCompare(i.name)}),_s=(n,r=[],a=[])=>Object.fromEntries(Object.entries(n).map(([i,d])=>r.includes(i)?[i,d===""?null:d]:a.includes(i)?d===""?[i,null]:[i,d]:[i,d===""?null:d])),ws=(n,r=[])=>Object.fromEntries(Object.entries(n).filter(([a,i])=>i!=null&&i!==""?!0:r.includes(a))),Cs=(n,r="normal",a)=>{const[i,d]=u.useState([]),[m,h]=u.useState([]),[C,j]=u.useState([]),[l,N]=u.useState({}),[z,H]=u.useState(!0),M=u.useCallback(async()=>{try{H(!0),se.debug("Fetching table data",{apiParams:n,type:r});let o;r==="normal"?(o=await De.fetchRecords(n),N(o.columns)):o=await De.fetchPaymentRecords(a);let p=o.data||[];if(r==="payment"&&(p=p.filter(w=>w.type==="original"||w.type==="Original")),h(p),d(p),p.length>0){const w=p[0],re=Object.keys(w).map(fe=>({id:fe,name:bs(fe),sortable:!0,visible:!0,type:ys(w[fe],fe)}));j(re)}else j([])}catch(o){se.error("Error fetching table data:",o),Q.error("Failed to fetch records"),h([]),d([]),j([])}finally{H(!1)}},[n.schemaName,n.tableName,r,a]);return u.useEffect(()=>{M()},[M]),{records:i,setRecords:d,originalRecords:m,columns:C,setColumns:j,metaData:l,loading:z,fetchData:M,refreshData:M}},pt="https://click.wa.expert/api",xt={async fetch(n,r){var a;try{const i=`${n}_${r}`,d=await we.post(`${pt}/data/getRecordById`,{id:i,schemaName:"public",tableName:"column_preferences"});let m=d.data.column_visibility;if(typeof m=="string")try{m=JSON.parse(m)}catch{return null}return{...d.data,column_visibility:m}}catch(i){return((a=i.response)==null?void 0:a.status)===404,null}},async save(n,r,a,i){var m;try{const h=`${n}_${r}`,C=JSON.stringify(a),j=`${pt}/data/createRecord`,l={schemaName:"public",tableName:"column_preferences",record:{us_id:h,owner_id:n,table_name:r,schema_name:i,column_visibility:C,updated_at:new Date().toISOString()}};return{success:!0,data:(await we.post(j,l)).data}}catch(h){return{success:!1,error:((m=h.response)==null?void 0:m.data)||h.message}}}},js=(n,r,a,i)=>{const[d,m]=u.useState(i),[h,C]=u.useState(!1),j=u.useCallback(async()=>{try{const o=await xt.fetch(n,r);return o&&o.column_visibility?(se.debug("Loaded column preferences:",o.column_visibility),o.column_visibility):null}catch(o){return se.error("Error loading column preferences:",o),null}},[n,r]),l=u.useCallback((o,p)=>p?o.map(w=>{const re=p[w.id]!==void 0?p[w.id]:!0;return{...w,visible:re}}):o,[]),N=u.useCallback(async o=>{try{const p={};o.forEach(re=>{p[re.id]=re.visible}),(await xt.save(n,r,p,a)).success&&(se.debug("Column preferences saved successfully"),Q.success("Column preferences saved"))}catch(p){se.error("Error saving column preferences:",p),Q.error("Failed to save column preferences")}},[n,r,a]),z=u.useCallback(async o=>{const p=d.map(w=>w.id===o?{...w,visible:!w.visible}:w);m(p),await N(p)},[d,N]),H=u.useCallback(async()=>{const o=d.map(p=>({...p,visible:!0}));m(o),await N(o),Q.success("Column visibility reset to default")},[d,N]),M=u.useCallback(async()=>{const o=d.map(p=>({...p,visible:!1}));m(o),await N(o),Q.success("All columns hidden")},[d,N]);return u.useEffect(()=>{(async()=>{if(!h&&i.length>0){const p=await j(),w=l(i,p);m(w),C(!0)}})()},[i,h,j,l]),u.useEffect(()=>{i.length>0&&!h&&m(i)},[i,h]),{columns:d,setColumns:m,toggleColumnVisibility:z,resetColumnVisibility:H,hideAllColumns:M,visibleColumns:d.filter(o=>o.visible)}},vs=n=>{const[r,a]=u.useState(""),[i,d]=u.useState([]),[m,h]=u.useState([]),C=u.useMemo(()=>{if(!n.length)return[];let o=[...n];if(r.trim()!==""){const p=r.toLowerCase();o=o.filter(w=>Object.values(w).some(re=>String(re).toLowerCase().includes(p)))}return i.length>0&&(o=o.filter(p=>i.includes(p.status))),m.length>0&&(o=o.filter(p=>m.includes(p.priority))),se.debug("Filtered records:",{original:n.length,filtered:o.length,searchTerm:r,statusFilter:i,priorityFilter:m}),o},[n,r,i,m]),j=u.useMemo(()=>Array.from(new Set(n.map(o=>o.status))).filter(Boolean),[n]),l=u.useMemo(()=>Array.from(new Set(n.map(o=>o.priority))).filter(Boolean),[n]),N=u.useCallback(o=>{d(p=>p.includes(o)?p.filter(w=>w!==o):[...p,o])},[]),z=u.useCallback(o=>{h(p=>p.includes(o)?p.filter(w=>w!==o):[...p,o])},[]),H=u.useCallback(()=>{a(""),d([]),h([])},[]),M=u.useMemo(()=>r!==""||i.length>0||m.length>0,[r,i,m]);return{searchTerm:r,setSearchTerm:a,statusFilter:i,setStatusFilter:d,priorityFilter:m,setPriorityFilter:h,filteredRecords:C,uniqueStatuses:j,uniquePriorities:l,toggleStatusFilter:N,togglePriorityFilter:z,clearFilters:H,hasActiveFilters:M}},Ns=(n,r=ps.DEFAULT_PAGE_SIZE)=>{const[a,i]=u.useState(1),[d,m]=u.useState(r),h=n.length,C=Math.ceil(h/d),j=u.useMemo(()=>{const o=a*d,p=o-d;return n.slice(p,o)},[n,a,d]),l=u.useCallback(o=>{const p=Math.max(1,Math.min(o,C));i(p)},[C]),N=u.useCallback(()=>{a<C&&i(o=>o+1)},[a,C]),z=u.useCallback(()=>{a>1&&i(o=>o-1)},[a]),H=u.useCallback(o=>{m(o),i(1)},[]),M=u.useCallback(()=>{i(1),m(r)},[r]);return{currentPage:a,pageSize:d,totalRecords:h,totalPages:C,currentRecords:j,setCurrentPage:l,nextPage:N,previousPage:z,changePageSize:H,resetPagination:M}},Ss=(n,r,a)=>{const[i,d]=u.useState({}),[m,h]=u.useState(!1),[C,j]=u.useState(!1),l=u.useCallback((p={})=>{d(p)},[]),N=u.useCallback((p,w)=>{d(re=>({...re,[p]:w}))},[]),z=u.useCallback(()=>{d({})},[]),H=u.useCallback(async(p={})=>{try{h(!0);const w={...i,...p};se.debug("Submitting form data:",w);const re=_s(w,xs,gs),X=ws(re,["status","type"]);se.debug("Cleaned record data:",X);let ee;return r==="payment"?ee=await De.createPaymentReminder(X):ee=await De.createRecord(n,X),Q.success("Record created successfully!"),a&&a(ee.data),z(),j(!1),ee}catch(w){throw se.error("Error submitting form:",w),w.response?Q.error(`Failed to create record: ${w.response.data.error||w.response.data.message||"Unknown error"}`):Q.error(`Failed to create record: ${w.message}`),w}finally{h(!1)}},[i,n,r,a,z]),M=u.useCallback((p={})=>{l(p),j(!0)},[l]),o=u.useCallback(()=>{j(!1),z()},[z]);return{formData:i,isSubmitting:m,isOpen:C,initializeForm:l,handleFieldChange:N,resetForm:z,submitForm:H,openForm:M,closeForm:o}},ks=(n,r)=>{const[a,i]=u.useState({}),[d,m]=u.useState({}),[h,C]=u.useState(!1),[j,l]=u.useState(!0),N=u.useCallback(async()=>{try{l(!0);const o=await De.fetchDropdownSetup(n,r);o.exists?(i(o.mapping),m(o.columnOrder),C(!0),se.debug("Dropdown setup loaded:",{mapping:o.mapping,columnOrder:o.columnOrder})):(i({}),m({}),C(!1))}catch(o){se.error("Error fetching dropdown setup:",o),i({}),m({}),C(!1)}finally{l(!1)}},[n,r]),z=u.useCallback(o=>a[o]||[],[a]),H=u.useCallback(o=>{const p=a[o];return Array.isArray(p)&&p.length>0},[a]),M=u.useCallback(o=>d[o]||999,[d]);return u.useEffect(()=>{n&&r&&N()},[n,r,N]),{dropdownSetup:a,columnOrder:d,setupExists:h,loading:j,fetchSetup:N,getDropdownOptions:z,hasDropdown:H,getColumnOrder:M}},Es=({tableName:n="jobstatus",onCounterUpdate:r})=>{const[a,i]=u.useState(0),[d,m]=u.useState(""),[h,C]=u.useState(!1),[j,l]=u.useState(!1),[N,z]=u.useState(!1),[H,M]=u.useState(null),o=lt(X=>X.user),p=o.owner_id===null?o.id:o.owner_id,w=async()=>{try{z(!0);const X="https://click.wa.expert/api/data/getRecordById",he={id:`${p}_${n}`,schemaName:"public",tableName:"counter_setup"},{data:W}=await we.post(X,he);if(W){const _=parseInt(W.counter,10)||0;i(_),m(W.prefix||""),C(W.is_active||!1),M(W.id),r&&r({counter:_,prefix:W.prefix||"",isActive:W.is_active||!1,recordId:W.id})}}catch{i(1),m(""),C(!1),M(null),await re()}finally{z(!1)}},re=async()=>{try{const X="https://click.wa.expert/api/data/createRecord",he={schemaName:"public",tableName:"counter_setup",record:{us_id:`${p}_${n}`,owner_id:p,table_name:n,prefix:"",counter:1,is_active:!1}},{data:W}=await we.post(X,he);await w()}catch{}},fe=async()=>{try{l(!0);const X=parseInt(a,10),ee="https://click.wa.expert/api/data/createRecord",he=`${p}_${n}`,W={schemaName:"public",tableName:"counter_setup",record:{us_id:he,owner_id:p,table_name:n,prefix:d,counter:X,is_active:h,updated_at:new Date().toISOString()}};await we.post(ee,W),Q.success("Counter settings saved successfully"),r&&r({counter:X,prefix:d,isActive:h,recordId:H||he}),await w()}catch{Q.error("Failed to save counter settings")}finally{l(!1)}};return u.useEffect(()=>{w()},[n]),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(Vt,{id:"counter-active",checked:h,onCheckedChange:C}),e.jsx(Me,{htmlFor:"counter-active",className:"text-sm font-medium whitespace-nowrap",children:"Auto Counter"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[120px]",children:[e.jsx(Me,{htmlFor:"prefix",className:"text-sm whitespace-nowrap",children:"Prefix:"}),e.jsx(Re,{id:"prefix",type:"text",value:d,onChange:X=>m(X.target.value),placeholder:"INV",className:"h-9"})]}),h&&e.jsxs("div",{className:"text-sm bg-blue-50 px-2 py-1.5 rounded border border-blue-200 flex w-[10rem] items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Next : "}),e.jsxs("span",{className:"font-mono font-semibold text-blue-700",children:[d,a]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(Z,{onClick:fe,disabled:j,size:"sm",variant:"default",children:e.jsx(Wt,{className:"h-3.5 w-3.5"})}),e.jsx(Z,{onClick:w,disabled:N,variant:"outline",size:"sm",children:e.jsx(kt,{className:`h-3.5 w-3.5 ${N?"animate-spin":""}`})})]})]})})})},Rs=({title:n="All Records",description:r="View and manage all database records",searchTerm:a="",onSearchChange:i,tableName:d,onCounterUpdate:m,urlParams:h={},dropdownSetupExists:C=!1,columnOrderExists:j=!1})=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:e.jsxs("div",{className:"w-[95%]",children:[e.jsxs("div",{className:"flex md:flex-row md:items-center justify-between w-full",children:[e.jsx(_t,{className:"text-2xl font-semibold text-slate-700",children:n}),e.jsx("div",{className:"lg:flex-1 lg:max-w-[500px]",children:e.jsx(Es,{tableName:d,onCounterUpdate:m})})]}),e.jsxs($t,{className:"mt-1",children:[r,h.pa_id&&e.jsx("div",{className:"flex gap-2 mt-1",children:e.jsxs(ge,{variant:"outline",className:"text-xs bg-green-50 border-green-200",children:["PA ID: ",h.pa_id]})}),h.process_name&&e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(ge,{variant:"outline",className:"text-xs bg-purple-50 border-purple-200",children:["Process: ",h.process_name]}),e.jsxs(ge,{variant:"outline",className:"text-xs bg-blue-50 border-blue-200",children:[h.process_name,"_balance"]})]}),C&&e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(ge,{variant:"outline",className:"text-xs",children:"Dropdown Configured"}),j&&e.jsxs(ge,{variant:"outline",className:"text-xs bg-blue-50 border-blue-200",children:[e.jsx(Gt,{className:"h-3 w-3 mr-1"}),"Custom Order"]})]})]})]})}),e.jsx("div",{className:"flex flex-col lg:flex-row items-stretch lg:items-end gap-3",children:e.jsxs("div",{className:"relative lg:w-[300px]",children:[e.jsx(Ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(Re,{type:"text",placeholder:"Search records...",value:a,onChange:i,className:"pl-9"})]})})]}),Ds=({onRefresh:n,onAddRecord:r,onExportCSV:a,onToggleEdit:i,editEnabled:d=!1,canEdit:m=!0,isLoading:h=!1})=>e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Z,{className:"flex items-center gap-2",onClick:r,disabled:h,children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Record"})]}),e.jsxs(Z,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:n,disabled:h,children:[e.jsx(kt,{className:`h-4 w-4 ${h?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs(Z,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:a,disabled:h,children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export CSV"})]}),m&&e.jsxs(Z,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:i,disabled:h,children:[e.jsx(Xt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Editing":"Edit"}),d&&e.jsx(ge,{className:"ml-1 bg-blue-500",children:"ON"})]})]}),Os=({uniqueStatuses:n=[],uniquePriorities:r=[],statusFilter:a=[],priorityFilter:i=[],onToggleStatus:d,onTogglePriority:m,onClearStatusFilter:h,onClearPriorityFilter:C})=>{const j=a.length+i.length;return e.jsxs(Ct,{children:[e.jsx(jt,{asChild:!0,children:e.jsxs(Z,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Filters"}),j>0&&e.jsx(ge,{className:"ml-1 py-0 px-1.5 h-5 min-w-5 bg-blue-500 text-white rounded-full",children:j})]})}),e.jsxs(vt,{align:"start",className:"w-56",children:[e.jsxs(tt,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Filter by Status"}),a.length>0&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:h,children:"Clear"})]}),n.length>0?n.map(l=>e.jsxs(dt,{checked:a.includes(l),onCheckedChange:()=>d(l),children:[e.jsx(ge,{className:`font-medium mr-2 ${Je(l,At)}`,children:l}),e.jsx("span",{children:l})]},l)):e.jsx(st,{disabled:!0,children:"No statuses available"}),e.jsx(Nt,{}),e.jsxs(tt,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Filter by Priority"}),i.length>0&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:C,children:"Clear"})]}),r.length>0?r.map(l=>e.jsxs(dt,{checked:i.includes(l),onCheckedChange:()=>m(l),children:[e.jsx(ge,{className:`font-medium mr-2 ${Je(l,Tt)}`,children:l}),e.jsx("span",{children:l})]},l)):e.jsx(st,{disabled:!0,children:"No priorities available"})]})]})},As=({columns:n=[],onToggleColumn:r,onResetVisibility:a,onHideAll:i})=>e.jsxs(Ct,{children:[e.jsx(jt,{asChild:!0,children:e.jsxs(Z,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Columns"})]})}),e.jsxs(vt,{align:"start",className:"w-56",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[e.jsx(tt,{className:"p-0",children:"Toggle Columns"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:d=>{d.stopPropagation(),i()},children:"Hide All"}),e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:d=>{d.stopPropagation(),a()},children:"Reset"})]})]}),e.jsx(Nt,{}),n.map(d=>e.jsx(st,{onSelect:m=>{m.preventDefault(),r(d.id)},children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(Et,{checked:d.visible,onCheckedChange:()=>r(d.id)}),e.jsx("span",{className:"flex-1",children:d.name}),!d.visible&&e.jsx(ge,{variant:"secondary",className:"text-xs",children:"Hidden"})]})},d.id))]})]}),Ts=({records:n=[],columns:r=[],loading:a=!1,editEnabled:i=!1,canDelete:d=!1,onSort:m,onDeleteRecord:h,onEditRecord:C,onSaveRecord:j,sortColumn:l=null,sortDirection:N="asc",emptyMessage:z="No records found",onClearFilters:H})=>{const[M,o]=u.useState(null),[p,w]=u.useState({}),re=u.useCallback(_=>{i&&(o(_.id),w(_),C&&C(_))},[i,C]),fe=u.useCallback(()=>{j&&j(M,p),o(null),w({})},[M,p,j]),X=u.useCallback(()=>{o(null),w({})},[]),ee=u.useCallback((_,t)=>{w(s=>({...s,[_]:t}))},[]),he=(_,t)=>{const s=_[t.id];return M===_.id&&t.id!=="id"&&i?e.jsx(Re,{type:"text",value:p[t.id]||"",onChange:c=>ee(t.id,c.target.value),className:"border rounded px-2 py-1 w-full",onClick:c=>c.stopPropagation()}):t.id==="status"?e.jsx(ge,{className:`font-medium ${Je(s,At)}`,children:s}):t.id==="priority"?e.jsx(ge,{className:`font-medium ${Je(s,Tt)}`,children:s}):t.id==="task_file"&&s?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{children:s})]}):e.jsx("span",{children:s||"â€”"})},W=r.filter(_=>_.visible);return e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Yt,{children:[e.jsx(Jt,{children:e.jsxs(He,{className:"bg-slate-50",children:[d&&e.jsx(ut,{className:"w-[60px] text-center",children:"Delete"}),W.map(_=>e.jsx(ut,{className:`${_.sortable?"cursor-pointer hover:bg-slate-100":""}`,onClick:()=>_.sortable&&m&&m(_.id),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:_.name}),l===_.id&&e.jsx(zt,{className:`h-4 w-4 transition-transform ${N==="desc"?"rotate-180":""}`})]})},_.id))]})}),e.jsx(Zt,{children:a?e.jsx(He,{children:e.jsx(Ve,{colSpan:W.length+(d?1:0),className:"h-24 text-center",children:"Loading records..."})}):n.length===0?e.jsx(He,{children:e.jsxs(Ve,{colSpan:W.length+(d?1:0),className:"h-24 text-center",children:[z,H&&e.jsx(Z,{variant:"link",onClick:H,className:"ml-2",children:"Clear filters?"})]})}):n.map((_,t)=>e.jsxs(He,{className:"hover:bg-slate-50 cursor-pointer",onClick:()=>re(_),children:[d&&e.jsx(Ve,{className:"w-[60px] text-center",children:e.jsx(Z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:s=>{s.stopPropagation(),h&&h(_)},children:e.jsx(Rt,{className:"h-4 w-4"})})}),W.map(s=>e.jsx(Ve,{children:he(_,s)},s.id))]},_.id||t))})]})}),M&&i&&e.jsxs("div",{className:"flex gap-2 p-3 bg-slate-50 border-t",children:[e.jsx(Z,{size:"sm",onClick:fe,children:"Save Changes"}),e.jsx(Z,{size:"sm",variant:"ghost",onClick:X,children:"Cancel"})]})]})},gt=({column:n,value:r,onChange:a,dropdownOptions:i=[],isAutoFilled:d=!1,disabled:m=!1})=>{const{id:h,type:C,name:j}=n;if(d)return e.jsx(Re,{id:h,type:"text",value:r||"",disabled:!0,className:"bg-gray-50 cursor-not-allowed text-gray-600",placeholder:`Auto-filled ${j.toLowerCase()}`});if(i.length>0)return e.jsxs(rt,{value:r||"",onValueChange:l=>a(h,l),disabled:m,children:[e.jsx(at,{children:e.jsx(nt,{placeholder:`Select ${j.toLowerCase()}`})}),e.jsx(it,{children:i.map((l,N)=>e.jsx($e,{value:l,children:l},N))})]});switch(C){case me.TEXTAREA:return e.jsx(es,{id:h,value:r||"",onChange:l=>a(h,l.target.value),placeholder:`Enter ${j.toLowerCase()}`,rows:3,disabled:m});case me.SELECT_PRIORITY:return e.jsxs(rt,{value:r||"",onValueChange:l=>a(h,l),disabled:m,children:[e.jsx(at,{children:e.jsx(nt,{placeholder:"Select priority"})}),e.jsxs(it,{children:[e.jsx($e,{value:Pe.LOW,children:"Low"}),e.jsx($e,{value:Pe.MEDIUM,children:"Medium"}),e.jsx($e,{value:Pe.HIGH,children:"High"})]})]});case me.NUMBER:return e.jsx(Re,{id:h,type:"number",value:r||"",onChange:l=>a(h,l.target.value),placeholder:`Enter ${j.toLowerCase()}`,disabled:m});case me.EMAIL:return e.jsx(Re,{id:h,type:"email",value:r||"",onChange:l=>a(h,l.target.value),placeholder:`Enter ${j.toLowerCase()}`,disabled:m});case me.PHONE:return e.jsx(Re,{id:h,type:"tel",value:r||"",onChange:l=>a(h,l.target.value),placeholder:`Enter ${j.toLowerCase()}`,disabled:m});case me.DATE:return e.jsx(Re,{id:h,type:"date",value:r||"",onChange:l=>a(h,l.target.value),disabled:m});case me.URL:return e.jsx(Re,{id:h,type:"url",value:r||"",onChange:l=>a(h,l.target.value),placeholder:`Enter ${j.toLowerCase()}`,disabled:m});case me.CHECKBOX:return e.jsx(Et,{id:h,checked:r||!1,onCheckedChange:l=>a(h,l),disabled:m});default:return e.jsx(Re,{id:h,type:"text",value:r||"",onChange:l=>a(h,l.target.value),placeholder:`Enter ${j.toLowerCase()}`,disabled:m})}},Is=({isOpen:n,onClose:r,onSubmit:a,formData:i,onFieldChange:d,columns:m,metaData:h=[],dropdownSetup:C={},columnOrder:j={},processName:l=null,isSubmitting:N=!1,counterConfig:z,setCounterConfig:H,mode:M="create"})=>{const o=lt(f=>f.user),p=(o==null?void 0:o.owner_id)??(o==null?void 0:o.id),[w,re]=St(),[fe,X]=u.useState(!1),[ee,he]=u.useState(""),[W,_]=u.useState({}),[t,s]=u.useState([]),[c,g]=u.useState([]),[x,k]=u.useState({}),[q,pe]=u.useState({}),[be,L]=u.useState(null),[G,S]=u.useState(null),[ce,E]=u.useState(!1),[A,y]=u.useState(!1),[V,ae]=u.useState(!1),[de,ye]=u.useState([]);u.useEffect(()=>{U()},[]);const P=o.schema_name,U=async()=>{const f=`https://click.wa.expert/api/data/getAllTables?schemaName=${P}`,{data:O}=await we.get(f);ye(O.data)},Y=u.useMemo(()=>{const f=ft(m,l);return mt(f,j)},[m,l,j]),R=f=>{const O=h.find(v=>v.column_name===f);return(O==null?void 0:O.is_nullable)==="NO"},te=f=>f===We.PA_ID,le=f=>{const O=C[f];return Array.isArray(O)?O:[]},K=f=>l&&(f.id.toLowerCase().includes("quantity")||f.name.toLowerCase().includes("quantity")),B=()=>{const f=window.location.pathname.split("/");return f[f.length-2]},F=(f,O)=>{const v={};return Object.entries(f).forEach(([b,D])=>{if(D===""||D===null||D===void 0)return;const ne=O.find(I=>I.column_name===b);if(ne){const I=ne.data_type.toLowerCase();if(I.includes("int")||I.includes("serial")){const $=parseInt(D,10);isNaN($)||(v[b]=$)}else if(I.includes("numeric")||I.includes("decimal")||I.includes("float")||I.includes("double")){const $=parseFloat(D);isNaN($)||(v[b]=$)}else I.includes("bool")?v[b]=D===!0||D==="true"||D==="1":(I.includes("date")||I.includes("time"),v[b]=D)}else v[b]=D}),v},Ce=async f=>{try{const O={schemaName:o.schema_name,tableName:f,userId:o.id,userEmail:o.email},v=await we.post("https://click.wa.expert/api/data/getAllData",O),b=v.data.data||[],D=v.data.columns||[];let ne=[];if(b.length>0){const Be=b[0];ne=Object.keys(Be).map(Ae=>({id:Ae,name:T(Ae),accessor:Ae,sortable:!0,visible:!0,type:J(Be[Ae],Ae)}))}const I=`https://click.wa.expert/api/reference/setup/check?owner_id=${p}&product_name=${f}`,$=await we.get(I);let ie={},qe={};return $.data.exists&&$.data.setup&&(ie=$.data.setup.mapping||{},qe=$.data.setup.columnOrder||{}),{columns:ne,metaData:D,dropdownSetup:ie,columnOrder:qe,processName:null}}catch(O){throw O}},T=f=>f.split("_").map(O=>O.charAt(0).toUpperCase()+O.slice(1)).join(" "),J=(f,O)=>{const v=O.toLowerCase();return v.includes("email")?"email":v.includes("phone")?"tel":v.includes("url")||v.includes("link")?"url":v==="status"?"select-status":v==="priority"?"select-priority":v.includes("description")||v.includes("notes")||v.includes("comment")?"textarea":v.includes("date")||v.includes("created")||v.includes("updated")?"date":typeof f=="number"?"number":typeof f=="boolean"?"checkbox":f&&f.length>100?"textarea":"text"},Se=async f=>{try{const O=B();let v=F(f,h);const b={process_name:w.get("process_name"),pa_id:w.get("pa_id"),status:w.get("status")};if(b.process_name){const I=`${b.process_name}_balance`,$=m.find(ie=>ie.id.toLowerCase().includes("quantity"));if($){const ie=v[$.id];ie&&(v[I]=ie)}}(b.status&&b.pa_id||b.process_name&&b.pa_id)&&(v.us_id=`${b.pa_id} -S- ${v.us_id}`);const D={schemaName:o.schema_name,tableName:O};return await De.createRecord(D,v)}catch(O){throw O}},ke=async(f,O)=>{try{const v=F(f,c);G&&v.us_id&&(v.us_id=`${G} -S- ${v.us_id}`);const b={schemaName:o.schema_name,tableName:O};return await De.createRecord(b,v)}catch(v){throw v}},je=async()=>{await a()},Oe=async()=>{var f,O,v,b,D,ne;ae(!0);try{const I=await Se(i);let $=null;if((O=(f=I==null?void 0:I.data)==null?void 0:f.data)!=null&&O.us_id)$=I.data.data.us_id;else if(i.us_id)$=i.us_id;else if((b=(v=I==null?void 0:I.data)==null?void 0:v.data)!=null&&b.us_id&&I.data.data.us_id.includes(" -S- ")){const ie=I.data.data.us_id.split(" -S- ");$=ie[ie.length-1]}if(z.isActive&&z.recordId)try{await De.updateRecord({schemaName:"public",tableName:"counter_setup"},z.recordId,p,{counter:z.counter+1}),H(ie=>({...ie,counter:ie.counter+1}))}catch{Q.warning("Record created but counter increment failed")}$?(S($),Q.success("Record created successfully"),X(!0)):Q.error("Could not get us_id from created record")}catch(I){Q.error("Failed to create record: "+(((ne=(D=I.response)==null?void 0:D.data)==null?void 0:ne.details)||I.message))}finally{ae(!1)}},ue=async()=>{if(ee){E(!0);try{const f=await Ce(ee);s(f.columns||[]),g(f.metaData||[]),k(f.dropdownSetup||{}),pe(f.columnOrder||{}),L(f.processName||null);const O={[We.PA_ID]:G,us_id:It()};f.columns.forEach(v=>{O[v.id]||(O[v.id]="")}),_(O),X(!1)}catch{Q.error("Failed to load table structure. Please try again.")}finally{E(!1)}}},ve=(f,O)=>{_(v=>({...v,[f]:O}))},oe=async()=>{y(!0);try{await ke(W,ee)&&(Q.success("Detail record created successfully"),_e(),window.location.reload())}catch{Q.error("Failed to create detail record. Please try again.")}finally{y(!1)}},xe=async()=>{y(!0);try{await ke(W,ee)&&(Q.success("Detail record created successfully"),_({}),s([]),g([]),k({}),pe({}),L(null),he(""),X(!0))}catch{Q.error("Failed to create detail record. Please try again.")}finally{y(!1)}},_e=()=>{X(!1),he(""),_({}),s([]),g([]),k({}),pe({}),L(null),S(null),r()},Ie=()=>e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{children:[e.jsx(Ke,{children:"Select Table for Details"}),e.jsxs(Xe,{children:["Choose a table to add detail records linked to the parent record (pa_id: ",G,")"]})]}),e.jsxs("div",{className:"py-6",children:[e.jsx(Me,{htmlFor:"table-select",className:"text-sm font-medium mb-2 block",children:"Select Table"}),e.jsxs(rt,{value:ee,onValueChange:he,children:[e.jsx(at,{id:"table-select",className:"w-full",children:e.jsx(nt,{placeholder:"Choose a table..."})}),e.jsx(it,{children:de.map(f=>e.jsx($e,{value:f.title,children:f.title.charAt(0).toUpperCase()+f.title.slice(1)},f.title))})]})]}),e.jsxs(Qe,{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx(Z,{variant:"outline",onClick:_e,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(Z,{onClick:ue,disabled:!ee||ce,className:"w-full sm:w-auto",children:ce?"Loading...":"Load Form"})]})]}),Le=()=>e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{children:[e.jsx(Ke,{children:M==="create"?"Add New Record":"Edit Record"}),e.jsxs(Xe,{children:[M==="create"?"Fill in the details to create a new record in the database.":"Update the record details.",l&&e.jsxs("span",{className:"block mt-1 text-blue-600",children:["Note: The ",l,"_balance field will be automatically set to match the quantity value."]})]})]}),e.jsx("div",{className:"space-y-6 py-4",children:Y.map(f=>{const O=j[f.id],v=te(f.id),b=R(f.id),D=K(f);return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs(Me,{htmlFor:f.id,className:"font-medium text-sm sm:w-48 sm:text-right sm:flex-shrink-0 flex items-center gap-1 justify-start sm:justify-end",children:[O&&e.jsx(ge,{variant:"secondary",className:"text-xs h-4 px-1 mr-1",children:O}),e.jsx("span",{className:"flex-1 sm:flex-initial",children:f.name}),b&&e.jsx(ge,{variant:"default",className:"text-xs h-4 px-1 text-red-100",children:"*"}),v&&e.jsx(ge,{variant:"default",className:"text-xs h-4 px-1 bg-green-500 ml-1",children:"auto"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(gt,{column:f,value:i[f.id],onChange:d,dropdownOptions:le(f.id),isAutoFilled:v,disabled:N||V}),v&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:f.id===We.PA_ID?"Automatically filled from URL parameter":"Automatically generated unique identifier"}),D&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["This value will be used to set ",l,"_balance"]})]})]},f.id)})}),e.jsxs(Qe,{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx(Z,{variant:"outline",onClick:_e,disabled:N||V,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(Z,{onClick:je,disabled:N||V,className:"w-full sm:w-auto",children:N?M==="create"?"Creating...":"Updating...":M==="create"?"Create Record":"Update Record"}),e.jsx(Z,{onClick:Oe,disabled:N||V,variant:"secondary",className:"w-full sm:w-auto",children:V?"Creating...":"Create & Add Details"})]})]}),Ee=u.useMemo(()=>{const f=ft(t,be);return mt(f,q)},[t,be,q]),Ne=()=>e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{children:[e.jsxs(Ke,{children:["Add Details - ",ee.charAt(0).toUpperCase()+ee.slice(1)]}),e.jsxs(Xe,{children:["Adding detail record linked to parent (pa_id: ",G,")"]})]}),e.jsx("div",{className:"space-y-6 py-4",children:Ee.map(f=>{var ne;const O=q[f.id],v=f.id===We.PA_ID,b=((ne=c.find(I=>I.column_name===f.id))==null?void 0:ne.is_nullable)==="NO",D=Array.isArray(x[f.id])?x[f.id]:[];return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs(Me,{htmlFor:f.id,className:"font-medium text-sm sm:w-48 sm:text-right sm:flex-shrink-0 flex items-center gap-1 justify-start sm:justify-end",children:[O&&e.jsx(ge,{variant:"secondary",className:"text-xs h-4 px-1 mr-1",children:O}),e.jsx("span",{className:"flex-1 sm:flex-initial",children:f.name}),b&&e.jsx(ge,{variant:"default",className:"text-xs h-4 px-1 text-red-100",children:"*"}),v&&e.jsx(ge,{variant:"default",className:"text-xs h-4 px-1 bg-green-500 ml-1",children:"auto"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(gt,{column:f,value:W[f.id],onChange:ve,dropdownOptions:D,isAutoFilled:v,disabled:A}),v&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Automatically filled from parent record: ",G]})]})]},f.id)})}),e.jsxs(Qe,{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx(Z,{variant:"outline",onClick:_e,disabled:A,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(Z,{onClick:oe,disabled:A,className:"w-full sm:w-auto",children:A?"Creating...":"Create Record"}),e.jsx(Z,{onClick:xe,disabled:A,variant:"secondary",className:"w-full sm:w-auto",children:A?"Creating...":"Create & Add More Details"})]})]});return e.jsx(Dt,{open:n,onOpenChange:r,children:e.jsx(Ot,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",onInteractOutside:f=>f.preventDefault(),children:fe?Ie():t.length>0?Ne():Le()})})},Fs=({isOpen:n,onClose:r,onConfirm:a,record:i,confirmInput:d,onConfirmInputChange:m,isDeleting:h=!1})=>{const C=d.trim()===(i==null?void 0:i.us_id);return e.jsx(Dt,{open:n,onOpenChange:r,children:e.jsxs(Ot,{className:"max-w-md",children:[e.jsxs(Ge,{children:[e.jsxs(Ke,{className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5 text-red-500"}),"Confirm Deletion"]}),e.jsxs(Xe,{children:["This action cannot be undone. Please type the ",e.jsx("strong",{children:"us_id"})," to confirm deletion."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[i&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded border",children:[e.jsx("p",{className:"text-sm font-medium",children:"Record to delete:"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",i.id]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["US_ID: ",e.jsx("span",{className:"font-mono bg-yellow-100 px-1 rounded",children:i.us_id})]})]}),e.jsxs("div",{children:[e.jsx(Me,{htmlFor:"confirm-us-id",className:"text-sm font-medium",children:"Enter us_id to confirm:"}),e.jsx(Re,{id:"confirm-us-id",type:"text",placeholder:"Type us_id here",value:d,onChange:j=>m(j.target.value),className:"mt-1",autoFocus:!0,disabled:h})]})]}),e.jsxs(Qe,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(Z,{variant:"outline",onClick:r,disabled:h,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(Z,{variant:"destructive",onClick:a,disabled:h||!C,className:"w-full sm:w-auto",children:h?"Deleting...":"Delete Record"})]})]})})};function Ls({className:n,...r}){return e.jsx("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:ze("mx-auto flex w-full justify-center",n),...r})}function Ms({className:n,...r}){return e.jsx("ul",{"data-slot":"pagination-content",className:ze("flex flex-row items-center gap-1",n),...r})}function Fe({...n}){return e.jsx("li",{"data-slot":"pagination-item",...n})}function Ue({className:n,isActive:r,size:a="icon",...i}){return e.jsx("a",{"aria-current":r?"page":void 0,"data-slot":"pagination-link","data-active":r,className:ze(qt({variant:r?"outline":"ghost",size:a}),n),...i})}function Ps({className:n,...r}){return e.jsxs(Ue,{"aria-label":"Go to previous page",size:"default",className:ze("gap-1 px-2.5 sm:pl-2.5",n),...r,children:[e.jsx(ts,{}),e.jsx("span",{className:"hidden sm:block",children:"Previous"})]})}function $s({className:n,...r}){return e.jsxs(Ue,{"aria-label":"Go to next page",size:"default",className:ze("gap-1 px-2.5 sm:pr-2.5",n),...r,children:[e.jsx("span",{className:"hidden sm:block",children:"Next"}),e.jsx(Bt,{})]})}function Us(n=640){const[r,a]=u.useState(typeof window<"u"?window.innerWidth<n:!1);return u.useEffect(()=>{function i(){a(window.innerWidth<n)}return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[n]),r}function zs({currentPage:n,setCurrentPage:r,totalPages:a,records:i=[],pageSize:d=10,totalRecords:m=0}){const C=Us(640)?3:7,j=u.useMemo(()=>{if(a<=C)return[...Array(a)].map((M,o)=>o+1);const l=Math.floor(C/2);let N=Math.max(1,n-l),z=Math.min(a,n+l);n<=l?(N=1,z=C):n+l>=a&&(N=a-C+1,z=a);const H=[];for(let M=N;M<=z;M++)H.push(M);return H},[a,n,C]);return e.jsxs("div",{className:"flex items-center justify-between mt-4 w-full px-4",children:[e.jsxs("div",{className:"hidden sm:block text-sm text-slate-500",children:["Showing ",e.jsx("span",{className:"font-medium",children:Math.min(i.length,d)})," of"," ",e.jsx("span",{className:"font-medium",children:m})," records"]}),e.jsx("div",{className:"flex-1 flex justify-center sm:justify-end",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto sm:overflow-visible py-1",children:e.jsx(Ls,{children:e.jsxs(Ms,{children:[e.jsx(Fe,{children:e.jsx(Ps,{href:"#",onClick:l=>{l.preventDefault(),n>1&&r(n-1)},className:n<=1?"pointer-events-none opacity-50":""})}),j[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsx(Ue,{href:"#",onClick:l=>{l.preventDefault(),r(1)},isActive:n===1,children:"1"})}),e.jsx(Fe,{children:e.jsx("span",{className:"inline-flex items-center px-2",children:"â€¦"})})]}),j.map(l=>e.jsx(Fe,{children:e.jsx(Ue,{href:"#",onClick:N=>{N.preventDefault(),r(l)},isActive:n===l,children:l})},l)),j[j.length-1]<a&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsx("span",{className:"inline-flex items-center px-2",children:"â€¦"})}),e.jsx(Fe,{children:e.jsx(Ue,{href:"#",onClick:l=>{l.preventDefault(),r(a)},isActive:n===a,children:a})})]}),e.jsx(Fe,{children:e.jsx($s,{href:"#",onClick:l=>{l.preventDefault(),n<a&&r(n+1)},className:n>=a?"pointer-events-none opacity-50":""})})]})})})})]})}const qs=({type:n="normal"})=>{const[r,a]=St(),i=lt(b=>b.user),d=u.useMemo(()=>({pa_id:r.get("pa_id"),us_id:r.get("us_id"),show:r.get("show"),status:r.get("status"),process_name:r.get("process_name")}),[r]),{tableName1:m}=Ht(),h=u.useMemo(()=>({schemaName:i.schema_name,tableName:m,userId:i.id,userEmail:i.email}),[i.schema_name,m,i.id,i.email]),C=(i==null?void 0:i.owner_id)??(i==null?void 0:i.id),[j,l]=u.useState(!1),[N,z]=u.useState(null),[H,M]=u.useState("asc"),[o,p]=u.useState({counter:0,prefix:"",isActive:!1,recordId:null}),[w,re]=u.useState(!1),[fe,X]=u.useState(null),[ee,he]=u.useState(""),[W,_]=u.useState(!1),{setRecords:t,originalRecords:s,columns:c,metaData:g,loading:x,refreshData:k}=Cs(h,n,C),{columns:q,setColumns:pe,toggleColumnVisibility:be,resetColumnVisibility:L,hideAllColumns:G,visibleColumns:S}=js(C,h.tableName,h.schemaName,c),{searchTerm:ce,setSearchTerm:E,statusFilter:A,priorityFilter:y,filteredRecords:V,uniqueStatuses:ae,uniquePriorities:de,toggleStatusFilter:ye,togglePriorityFilter:P,clearFilters:U,hasActiveFilters:Y}=vs(s),{currentPage:R,totalPages:te,currentRecords:le,setCurrentPage:K,resetPagination:B}=Ns(V),{formData:F,isSubmitting:Ce,isOpen:T,handleFieldChange:J,submitForm:Se,openForm:ke,closeForm:je}=Ss(h,n,k),{dropdownSetup:Oe,columnOrder:ue,setupExists:ve}=ks(C,h.tableName);u.useEffect(()=>{c.length>0&&q.length===0&&pe(c)},[c]),u.useEffect(()=>{const b=r.get("search");b&&E(decodeURIComponent(b))},[r,E]),u.useEffect(()=>{d.show==="true"&&q.length>0&&Ee()},[d.show,q]);const oe=u.useCallback(b=>{p(b)},[]),xe=u.useCallback(()=>{k(),U(),B(),Q.success("Data refreshed")},[k,U,B]),_e=u.useCallback(b=>{E(b.target.value),B()},[E,B]),Ie=u.useCallback(b=>{N===b?M(ne=>ne==="asc"?"desc":"asc"):(z(b),M("asc"));const D=[...V].sort((ne,I)=>{const $=ne[b]||"",ie=I[b]||"";return typeof $=="string"&&typeof ie=="string"?H==="asc"?$.localeCompare(ie):ie.localeCompare($):H==="asc"?$-ie:ie-$});t(D)},[N,H,V,t]),Le=u.useCallback(()=>{if(!V.length){Q.error("No records to export");return}try{const b=V.map(Be=>{const Ae={};return S.forEach(ot=>{Ae[ot.name]=Be[ot.id]}),Ae}),D=ms.unparse(b,{quotes:!0,quoteChar:'"',delimiter:",",header:!0}),ne=new Blob([D],{type:"text/csv;charset=utf-8;"}),I=URL.createObjectURL(ne),$=document.createElement("a"),ie=new Date().toISOString().slice(0,10),qe=`${h.tableName}_export_${ie}.csv`;$.setAttribute("href",I),$.setAttribute("download",qe),$.style.display="none",document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(I),Q.success(`Exported ${b.length} records to CSV`)}catch(b){se.error("Error exporting CSV:",b),Q.error("Failed to export CSV")}},[V,S,h.tableName]),Ee=u.useCallback(async()=>{const b={};if(q.forEach(D=>{d[D.id]?b[D.id]=d[D.id]:D.id==="us_id"?b[D.id]=o.isActive?`${o.prefix}${o.counter}`:It():b[D.id]=""}),ke(b),d.show==="true"){const D=new URLSearchParams(r);D.delete("show"),a(D,{replace:!0})}},[q,d,o,ke,r,a]),Ne=u.useCallback(async()=>{try{let b={};if(d.process_name){const D=`${d.process_name}_balance`,ne=q.find(I=>I.id.toLowerCase().includes("quantity"));if(ne){const I=F[ne.id];I&&(b[D]=I)}}if((d.status&&d.pa_id||d.process_name&&d.pa_id)&&(b.us_id=`${d.pa_id} -S- ${F.us_id}`),await Se(b),o.isActive&&o.recordId)try{await De.updateRecord({schemaName:"public",tableName:"counter_setup"},o.recordId,C,{counter:o.counter+1}),p(D=>({...D,counter:D.counter+1}))}catch(D){se.error("Counter increment failed:",D),Q.warning("Record created but counter increment failed")}a({})}catch(b){se.error("Create record failed:",b)}},[F,q,d,o,Se,C,a]),f=u.useCallback(b=>{X(b),he(""),re(!0)},[]),O=u.useCallback(async()=>{if(!fe||ee.trim()!==fe.us_id){Q.error("Entered us_id does not match");return}try{_(!0),await De.deleteRecord(h,fe.id),Q.success("Record deleted successfully"),re(!1),X(null),he(""),k()}catch(b){se.error("Delete failed:",b),Q.error("Failed to delete record")}finally{_(!1)}},[fe,ee,h,k]),v=u.useCallback(async(b,D)=>{try{const ne=s.find($=>$.id===b),I={};if(Object.entries(D).forEach(([$,ie])=>{ie!==ne[$]&&$!=="id"&&$!=="pa_id"&&$!=="us_id"&&(I[$]=ie)}),Object.keys(I).length===0){Q.warning("No changes to save");return}await De.updateRecord(h,b,C,I),Q.success("Record updated successfully"),k()}catch(ne){se.error("Update failed:",ne),Q.error("Failed to update record")}},[s,h,C,k]);return d.show==="true"?null:e.jsxs(bt,{className:"tableCard shadow-sm border-slate-200 mx-[6rem]",children:[e.jsx(yt,{className:"pb-3",children:e.jsx(Rs,{title:"All Records",description:"View and manage all database records",searchTerm:ce,onSearchChange:_e,tableName:h.tableName,onCounterUpdate:oe,urlParams:d,dropdownSetupExists:ve,columnOrderExists:Object.keys(ue).length>0})}),e.jsxs(wt,{children:[e.jsx("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Ds,{onRefresh:xe,onAddRecord:Ee,onExportCSV:Le,onToggleEdit:()=>l(!j),editEnabled:j,canEdit:i.owner_id===null,isLoading:x}),e.jsx(Os,{uniqueStatuses:ae,uniquePriorities:de,statusFilter:A,priorityFilter:y,onToggleStatus:ye,onTogglePriority:P,onClearStatusFilter:()=>ye([]),onClearPriorityFilter:()=>P([])}),e.jsx(As,{columns:q,onToggleColumn:be,onResetVisibility:L,onHideAll:G})]})}),e.jsx(Ts,{records:le,columns:q,loading:x,editEnabled:j,canDelete:i.owner_id===null,onSort:Ie,onDeleteRecord:f,onSaveRecord:v,sortColumn:N,sortDirection:H,emptyMessage:Y?"No records match filters":"No records found",onClearFilters:Y?U:null}),e.jsx(zs,{currentPage:R,setCurrentPage:K,totalPages:te})]}),e.jsx(Is,{isOpen:T,onClose:je,onSubmit:Ne,formData:F,onFieldChange:J,columns:q,metaData:g,dropdownSetup:Oe,columnOrder:ue,processName:d.process_name,isSubmitting:Ce,counterConfig:o,setCounterConfig:p,mode:"create"}),e.jsx(Fs,{isOpen:w,onClose:()=>re(!1),onConfirm:O,record:fe,confirmInput:ee,onConfirmInputChange:he,isDeleting:W})]})},ir=n=>e.jsx(ds,{children:e.jsx(qs,{...n})});export{ir as default};
