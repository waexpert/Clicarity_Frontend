var xs=Object.defineProperty;var bs=(a,r,n)=>r in a?xs(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n;var It=(a,r,n)=>bs(a,typeof r!="symbol"?r+"":r,n);import{e as vt,R as tt,j as e,C as Bt,g as qt,h as Vt,k as Ht,B as ee,a8 as ws,c as ye,r as l,a9 as W,ac as ys,Q as Wt,W as _s,U as Cs,af as js,ag as Ss,a6 as Xe,a as wt,L as qe,I as Fe,y as Ns,i as vs,l as Se,z as ks,P as Es,A as Rs,p as pt,q as mt,t as gt,v as xt,w as Ke,ah as Gt,ai as Kt,aT as Ds,aj as Xt,ak as jt,aU as Ot,al as St,aV as Qt,aR as Ts,T as Yt,aW as Is,aM as Jt,a7 as Os,aB as As,at as Fs}from"./index-DSK3H15k.js";import{R as Zt}from"./refresh-cw-C927ELo_.js";import{A as Ls}from"./CustomTable-CwdLd0nd.js";import{D as kt,b as Et,c as st,d as rt,f as at,e as ht}from"./dialog-Dx31Pv9r.js";import{C as es}from"./checkbox-DzHwqFVk.js";import{S as Ps}from"./sliders-horizontal-BZPpNrYo.js";import{T as Ms,a as $s,b as ct,c as At,d as Us,e as dt}from"./table-BRGksd4x.js";import{T as zs}from"./textarea-Bw3e3x5_.js";import{C as Bs}from"./chevron-left-BA6ZBiqD.js";import"./index-DZA9Smda.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Vs=vt("file-spreadsheet",qs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]],Ws=vt("split",Hs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ks=vt("triangle-alert",Gs);class Xs extends tt.Component{constructor(n){super(n);It(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,i){this.setState({error:n,errorInfo:i})}render(){return this.state.hasError?e.jsxs(Bt,{className:"mx-[6rem] mt-8",children:[e.jsx(qt,{children:e.jsxs(Vt,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ks,{className:"h-5 w-5"}),"Something went wrong"]})}),e.jsxs(Ht,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"The table encountered an error. Please try refreshing the page."}),!1,e.jsx(ee,{onClick:this.handleReset,children:"Reload Page"})]})]}):this.props.children}}var ft={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var Qs=ft.exports,Ft;function Ys(){return Ft||(Ft=1,function(a,r){((n,i)=>{a.exports=i()})(Qs,function n(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},c,p=!i.document&&!!i.postMessage,h=i.IS_PAPA_WORKER||!1,S={},C=0,o={};function g(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(s){var d=te(s);d.chunkSize=parseInt(d.chunkSize),s.step||s.chunk||(d.chunkSize=null),this._handle=new m(d),(this._handle.streamer=this)._config=d}).call(this,t),this.parseChunk=function(s,d){var b=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<b){let O=this._config.newline;O||(y=this._config.quoteChar||'"',O=this._handle.guessLineEndings(s,y)),s=[...s.split(O).slice(b)].join(O)}this.isFirstChunk&&_(this._config.beforeFirstChunk)&&(y=this._config.beforeFirstChunk(s))!==void 0&&(s=y),this.isFirstChunk=!1,this._halted=!1;var b=this._partialLine+s,y=(this._partialLine="",this._handle.parse(b,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(s=y.meta.cursor,b=(this._finished||(this._partialLine=b.substring(s-this._baseIndex),this._baseIndex=s),y&&y.data&&(this._rowCount+=y.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),h)i.postMessage({results:y,workerId:o.WORKER_ID,finished:b});else if(_(this._config.chunk)&&!d){if(this._config.chunk(y,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=y=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(y.data),this._completeResults.errors=this._completeResults.errors.concat(y.errors),this._completeResults.meta=y.meta),this._completed||!b||!_(this._config.complete)||y&&y.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),b||y&&y.meta.paused||this._nextChunk(),y}this._halted=!0},this._sendError=function(s){_(this._config.error)?this._config.error(s):h&&this._config.error&&i.postMessage({workerId:o.WORKER_ID,error:s,finished:!1})}}function v(t){var s;(t=t||{}).chunkSize||(t.chunkSize=o.RemoteChunkSize),g.call(this,t),this._nextChunk=p?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(d){this._input=d,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),p||(s.onload=G(this._chunkLoaded,this),s.onerror=G(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!p),this._config.downloadRequestHeaders){var d,b=this._config.downloadRequestHeaders;for(d in b)s.setRequestHeader(d,b[d])}var y;this._config.chunkSize&&(y=this._start+this._config.chunkSize-1,s.setRequestHeader("Range","bytes="+this._start+"-"+y));try{s.send(this._config.downloadRequestBody)}catch(O){this._chunkError(O.message)}p&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize||s.responseText.length,this._finished=!this._config.chunkSize||this._start>=(d=>(d=d.getResponseHeader("Content-Range"))!==null?parseInt(d.substring(d.lastIndexOf("/")+1)):-1)(s),this.parseChunk(s.responseText)))},this._chunkError=function(d){d=s.statusText||d,this._sendError(new Error(d))}}function P(t){(t=t||{}).chunkSize||(t.chunkSize=o.LocalChunkSize),g.call(this,t);var s,d,b=typeof FileReader<"u";this.stream=function(y){this._input=y,d=y.slice||y.webkitSlice||y.mozSlice,b?((s=new FileReader).onload=G(this._chunkLoaded,this),s.onerror=G(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var y=this._input,O=(this._config.chunkSize&&(O=Math.min(this._start+this._config.chunkSize,this._input.size),y=d.call(y,this._start,O)),s.readAsText(y,this._config.encoding));b||this._chunkLoaded({target:{result:O}})},this._chunkLoaded=function(y){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(y.target.result)},this._chunkError=function(){this._sendError(s.error)}}function E(t){var s;g.call(this,t=t||{}),this.stream=function(d){return s=d,this._nextChunk()},this._nextChunk=function(){var d,b;if(!this._finished)return d=this._config.chunkSize,s=d?(b=s.substring(0,d),s.substring(d)):(b=s,""),this._finished=!s,this.parseChunk(b)}}function u(t){g.call(this,t=t||{});var s=[],d=!0,b=!1;this.pause=function(){g.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){g.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(y){this._input=y,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){b&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):d=!0},this._streamData=G(function(y){try{s.push(typeof y=="string"?y:y.toString(this._config.encoding)),d&&(d=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(O){this._streamError(O)}},this),this._streamError=G(function(y){this._streamCleanUp(),this._sendError(y)},this),this._streamEnd=G(function(){this._streamCleanUp(),b=!0,this._streamData("")},this),this._streamCleanUp=G(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(t){var s,d,b,y,O=Math.pow(2,53),ue=-O,_e=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ie=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,U=this,J=0,k=0,xe=!1,M=!1,L=[],j={data:[],errors:[],meta:{}};function oe(T){return t.skipEmptyLines==="greedy"?T.join("").trim()==="":T.length===1&&T[0].length===0}function se(){if(j&&b&&(be("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),b=!1),t.skipEmptyLines&&(j.data=j.data.filter(function(A){return!oe(A)})),pe()){let A=function(ce,fe){_(t.transformHeader)&&(ce=t.transformHeader(ce,fe)),L.push(ce)};if(j)if(Array.isArray(j.data[0])){for(var T=0;pe()&&T<j.data.length;T++)j.data[T].forEach(A);j.data.splice(0,1)}else j.data.forEach(A)}function V(A,ce){for(var fe=t.header?{}:[],Q=0;Q<A.length;Q++){var K=Q,B=A[Q],B=((ke,I)=>(ae=>(t.dynamicTypingFunction&&t.dynamicTyping[ae]===void 0&&(t.dynamicTyping[ae]=t.dynamicTypingFunction(ae)),(t.dynamicTyping[ae]||t.dynamicTyping)===!0))(ke)?I==="true"||I==="TRUE"||I!=="false"&&I!=="FALSE"&&((ae=>{if(_e.test(ae)&&(ae=parseFloat(ae),ue<ae&&ae<O))return 1})(I)?parseFloat(I):ie.test(I)?new Date(I):I===""?null:I):I)(K=t.header?Q>=L.length?"__parsed_extra":L[Q]:K,B=t.transform?t.transform(B,K):B);K==="__parsed_extra"?(fe[K]=fe[K]||[],fe[K].push(B)):fe[K]=B}return t.header&&(Q>L.length?be("FieldMismatch","TooManyFields","Too many fields: expected "+L.length+" fields but parsed "+Q,k+ce):Q<L.length&&be("FieldMismatch","TooFewFields","Too few fields: expected "+L.length+" fields but parsed "+Q,k+ce)),fe}var le;j&&(t.header||t.dynamicTyping||t.transform)&&(le=1,!j.data.length||Array.isArray(j.data[0])?(j.data=j.data.map(V),le=j.data.length):j.data=V(j.data,0),t.header&&j.meta&&(j.meta.fields=L),k+=le)}function pe(){return t.header&&L.length===0}function be(T,V,le,A){T={type:T,code:V,message:le},A!==void 0&&(T.row=A),j.errors.push(T)}_(t.step)&&(y=t.step,t.step=function(T){j=T,pe()?se():(se(),j.data.length!==0&&(J+=T.data.length,t.preview&&J>t.preview?d.abort():(j.data=j.data[0],y(j,U))))}),this.parse=function(T,V,le){var A=t.quoteChar||'"',A=(t.newline||(t.newline=this.guessLineEndings(T,A)),b=!1,t.delimiter?_(t.delimiter)&&(t.delimiter=t.delimiter(T),j.meta.delimiter=t.delimiter):((A=((ce,fe,Q,K,B)=>{var ke,I,ae,Ae;B=B||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var Pe=0;Pe<B.length;Pe++){for(var Ee,Me=B[Pe],me=0,Re=0,we=0,Ce=(ae=void 0,new z({comments:K,delimiter:Me,newline:fe,preview:10}).parse(ce)),Oe=0;Oe<Ce.data.length;Oe++)Q&&oe(Ce.data[Oe])?we++:(Ee=Ce.data[Oe].length,Re+=Ee,ae===void 0?ae=Ee:0<Ee&&(me+=Math.abs(Ee-ae),ae=Ee));0<Ce.data.length&&(Re/=Ce.data.length-we),(I===void 0||me<=I)&&(Ae===void 0||Ae<Re)&&1.99<Re&&(I=me,ke=Me,Ae=Re)}return{successful:!!(t.delimiter=ke),bestDelimiter:ke}})(T,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=A.bestDelimiter:(b=!0,t.delimiter=o.DefaultDelimiter),j.meta.delimiter=t.delimiter),te(t));return t.preview&&t.header&&A.preview++,s=T,d=new z(A),j=d.parse(s,V,le),se(),xe?{meta:{paused:!0}}:j||{meta:{paused:!1}}},this.paused=function(){return xe},this.pause=function(){xe=!0,d.abort(),s=_(t.chunk)?"":s.substring(d.getCharIndex())},this.resume=function(){U.streamer._halted?(xe=!1,U.streamer.parseChunk(s,!0)):setTimeout(U.resume,3)},this.aborted=function(){return M},this.abort=function(){M=!0,d.abort(),j.meta.aborted=!0,_(t.complete)&&t.complete(j),s=""},this.guessLineEndings=function(ce,A){ce=ce.substring(0,1048576);var A=new RegExp(x(A)+"([^]*?)"+x(A),"gm"),le=(ce=ce.replace(A,"")).split("\r"),A=ce.split(`
`),ce=1<A.length&&A[0].length<le[0].length;if(le.length===1||ce)return`
`;for(var fe=0,Q=0;Q<le.length;Q++)le[Q][0]===`
`&&fe++;return fe>=le.length/2?`\r
`:"\r"}}function x(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function z(t){var s=(t=t||{}).delimiter,d=t.newline,b=t.comments,y=t.step,O=t.preview,ue=t.fastMode,_e=null,ie=!1,U=t.quoteChar==null?'"':t.quoteChar,J=U;if(t.escapeChar!==void 0&&(J=t.escapeChar),(typeof s!="string"||-1<o.BAD_DELIMITERS.indexOf(s))&&(s=","),b===s)throw new Error("Comment character same as delimiter");b===!0?b="#":(typeof b!="string"||-1<o.BAD_DELIMITERS.indexOf(b))&&(b=!1),d!==`
`&&d!=="\r"&&d!==`\r
`&&(d=`
`);var k=0,xe=!1;this.parse=function(M,L,j){if(typeof M!="string")throw new Error("Input must be a string");var oe=M.length,se=s.length,pe=d.length,be=b.length,T=_(y),V=[],le=[],A=[],ce=k=0;if(!M)return me();if(ue||ue!==!1&&M.indexOf(U)===-1){for(var fe=M.split(d),Q=0;Q<fe.length;Q++){if(A=fe[Q],k+=A.length,Q!==fe.length-1)k+=d.length;else if(j)return me();if(!b||A.substring(0,be)!==b){if(T){if(V=[],Ae(A.split(s)),Re(),xe)return me()}else Ae(A.split(s));if(O&&O<=Q)return V=V.slice(0,O),me(!0)}}return me()}for(var K=M.indexOf(s,k),B=M.indexOf(d,k),ke=new RegExp(x(J)+x(U),"g"),I=M.indexOf(U,k);;)if(M[k]===U)for(I=k,k++;;){if((I=M.indexOf(U,I+1))===-1)return j||le.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:V.length,index:k}),Ee();if(I===oe-1)return Ee(M.substring(k,I).replace(ke,U));if(U===J&&M[I+1]===J)I++;else if(U===J||I===0||M[I-1]!==J){K!==-1&&K<I+1&&(K=M.indexOf(s,I+1));var ae=Pe((B=B!==-1&&B<I+1?M.indexOf(d,I+1):B)===-1?K:Math.min(K,B));if(M.substr(I+1+ae,se)===s){A.push(M.substring(k,I).replace(ke,U)),M[k=I+1+ae+se]!==U&&(I=M.indexOf(U,k)),K=M.indexOf(s,k),B=M.indexOf(d,k);break}if(ae=Pe(B),M.substring(I+1+ae,I+1+ae+pe)===d){if(A.push(M.substring(k,I).replace(ke,U)),Me(I+1+ae+pe),K=M.indexOf(s,k),I=M.indexOf(U,k),T&&(Re(),xe))return me();if(O&&V.length>=O)return me(!0);break}le.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:V.length,index:k}),I++}}else if(b&&A.length===0&&M.substring(k,k+be)===b){if(B===-1)return me();k=B+pe,B=M.indexOf(d,k),K=M.indexOf(s,k)}else if(K!==-1&&(K<B||B===-1))A.push(M.substring(k,K)),k=K+se,K=M.indexOf(s,k);else{if(B===-1)break;if(A.push(M.substring(k,B)),Me(B+pe),T&&(Re(),xe))return me();if(O&&V.length>=O)return me(!0)}return Ee();function Ae(we){V.push(we),ce=k}function Pe(we){var Ce=0;return Ce=we!==-1&&(we=M.substring(I+1,we))&&we.trim()===""?we.length:Ce}function Ee(we){return j||(we===void 0&&(we=M.substring(k)),A.push(we),k=oe,Ae(A),T&&Re()),me()}function Me(we){k=we,Ae(A),A=[],B=M.indexOf(d,k)}function me(we){if(t.header&&!L&&V.length&&!ie){var Ce=V[0],Oe={},Ve=new Set(Ce);let Ue=!1;for(let De=0;De<Ce.length;De++){let Te=Ce[De];if(Oe[Te=_(t.transformHeader)?t.transformHeader(Te,De):Te]){let ze,He=Oe[Te];for(;ze=Te+"_"+He,He++,Ve.has(ze););Ve.add(ze),Ce[De]=ze,Oe[Te]++,Ue=!0,(_e=_e===null?{}:_e)[ze]=Te}else Oe[Te]=1,Ce[De]=Te;Ve.add(Te)}ie=!0}return{data:V,errors:le,meta:{delimiter:s,linebreak:d,aborted:xe,truncated:!!we,cursor:ce+(L||0),renamedHeaders:_e}}}function Re(){y(me()),V=[],le=[]}},this.abort=function(){xe=!0},this.getCharIndex=function(){return k}}function re(t){var s=t.data,d=S[s.workerId],b=!1;if(s.error)d.userError(s.error,s.file);else if(s.results&&s.results.data){var y={abort:function(){b=!0,D(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:q,resume:q};if(_(d.userStep)){for(var O=0;O<s.results.data.length&&(d.userStep({data:s.results.data[O],errors:s.results.errors,meta:s.results.meta},y),!b);O++);delete s.results}else _(d.userChunk)&&(d.userChunk(s.results,y,s.file),delete s.results)}s.finished&&!b&&D(s.workerId,s.results)}function D(t,s){var d=S[t];_(d.userComplete)&&d.userComplete(s),d.terminate(),delete S[t]}function q(){throw new Error("Not implemented.")}function te(t){if(typeof t!="object"||t===null)return t;var s,d=Array.isArray(t)?[]:{};for(s in t)d[s]=te(t[s]);return d}function G(t,s){return function(){t.apply(s,arguments)}}function _(t){return typeof t=="function"}return o.parse=function(t,s){var d=(s=s||{}).dynamicTyping||!1;if(_(d)&&(s.dynamicTypingFunction=d,d={}),s.dynamicTyping=d,s.transform=!!_(s.transform)&&s.transform,!s.worker||!o.WORKERS_SUPPORTED)return d=null,o.NODE_STREAM_INPUT,typeof t=="string"?(t=(b=>b.charCodeAt(0)!==65279?b:b.slice(1))(t),d=new(s.download?v:E)(s)):t.readable===!0&&_(t.read)&&_(t.on)?d=new u(s):(i.File&&t instanceof File||t instanceof Object)&&(d=new P(s)),d.stream(t);(d=(()=>{var b;return!!o.WORKERS_SUPPORTED&&(b=(()=>{var y=i.URL||i.webkitURL||null,O=n.toString();return o.BLOB_URL||(o.BLOB_URL=y.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",O,")();"],{type:"text/javascript"})))})(),(b=new i.Worker(b)).onmessage=re,b.id=C++,S[b.id]=b)})()).userStep=s.step,d.userChunk=s.chunk,d.userComplete=s.complete,d.userError=s.error,s.step=_(s.step),s.chunk=_(s.chunk),s.complete=_(s.complete),s.error=_(s.error),delete s.worker,d.postMessage({input:t,config:s,workerId:d.id})},o.unparse=function(t,s){var d=!1,b=!0,y=",",O=`\r
`,ue='"',_e=ue+ue,ie=!1,U=null,J=!1,k=((()=>{if(typeof s=="object"){if(typeof s.delimiter!="string"||o.BAD_DELIMITERS.filter(function(L){return s.delimiter.indexOf(L)!==-1}).length||(y=s.delimiter),typeof s.quotes!="boolean"&&typeof s.quotes!="function"&&!Array.isArray(s.quotes)||(d=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(ie=s.skipEmptyLines),typeof s.newline=="string"&&(O=s.newline),typeof s.quoteChar=="string"&&(ue=s.quoteChar),typeof s.header=="boolean"&&(b=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");U=s.columns}s.escapeChar!==void 0&&(_e=s.escapeChar+ue),s.escapeFormulae instanceof RegExp?J=s.escapeFormulae:typeof s.escapeFormulae=="boolean"&&s.escapeFormulae&&(J=/^[=+\-@\t\r].*$/)}})(),new RegExp(x(ue),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return xe(null,t,ie);if(typeof t[0]=="object")return xe(U||Object.keys(t[0]),t,ie)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||U),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),xe(t.fields||[],t.data||[],ie);throw new Error("Unable to serialize unrecognized input");function xe(L,j,oe){var se="",pe=(typeof L=="string"&&(L=JSON.parse(L)),typeof j=="string"&&(j=JSON.parse(j)),Array.isArray(L)&&0<L.length),be=!Array.isArray(j[0]);if(pe&&b){for(var T=0;T<L.length;T++)0<T&&(se+=y),se+=M(L[T],T);0<j.length&&(se+=O)}for(var V=0;V<j.length;V++){var le=(pe?L:j[V]).length,A=!1,ce=pe?Object.keys(j[V]).length===0:j[V].length===0;if(oe&&!pe&&(A=oe==="greedy"?j[V].join("").trim()==="":j[V].length===1&&j[V][0].length===0),oe==="greedy"&&pe){for(var fe=[],Q=0;Q<le;Q++){var K=be?L[Q]:Q;fe.push(j[V][K])}A=fe.join("").trim()===""}if(!A){for(var B=0;B<le;B++){0<B&&!ce&&(se+=y);var ke=pe&&be?L[B]:B;se+=M(j[V][ke],B)}V<j.length-1&&(!oe||0<le&&!ce)&&(se+=O)}}return se}function M(L,j){var oe,se;return L==null?"":L.constructor===Date?JSON.stringify(L).slice(1,25):(se=!1,J&&typeof L=="string"&&J.test(L)&&(L="'"+L,se=!0),oe=L.toString().replace(k,_e),(se=se||d===!0||typeof d=="function"&&d(L,j)||Array.isArray(d)&&d[j]||((pe,be)=>{for(var T=0;T<be.length;T++)if(-1<pe.indexOf(be[T]))return!0;return!1})(oe,o.BAD_DELIMITERS)||-1<oe.indexOf(y)||oe.charAt(0)===" "||oe.charAt(oe.length-1)===" ")?ue+oe+ue:oe)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!p&&!!i.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=z,o.ParserHandle=m,o.NetworkStreamer=v,o.FileStreamer=P,o.StringStreamer=E,o.ReadableStreamStreamer=u,i.jQuery&&((c=i.jQuery).fn.parse=function(t){var s=t.config||{},d=[];return this.each(function(O){if(!(c(this).prop("tagName").toUpperCase()==="INPUT"&&c(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var ue=0;ue<this.files.length;ue++)d.push({file:this.files[ue],inputElem:this,instanceConfig:c.extend({},s)})}),b(),this;function b(){if(d.length===0)_(t.complete)&&t.complete();else{var O,ue,_e,ie,U=d[0];if(_(t.before)){var J=t.before(U.file,U.inputElem);if(typeof J=="object"){if(J.action==="abort")return O="AbortError",ue=U.file,_e=U.inputElem,ie=J.reason,void(_(t.error)&&t.error({name:O},ue,_e,ie));if(J.action==="skip")return void y();typeof J.config=="object"&&(U.instanceConfig=c.extend(U.instanceConfig,J.config))}else if(J==="skip")return void y()}var k=U.instanceConfig.complete;U.instanceConfig.complete=function(xe){_(k)&&k(xe,U.file,U.inputElem),y()},o.parse(U.file,U.instanceConfig)}}function y(){d.splice(0,1),b()}}),h&&(i.onmessage=function(t){t=t.data,o.WORKER_ID===void 0&&t&&(o.WORKER_ID=t.workerId),typeof t.input=="string"?i.postMessage({workerId:o.WORKER_ID,results:o.parse(t.input,t.config),finished:!0}):(i.File&&t.input instanceof File||t.input instanceof Object)&&(t=o.parse(t.input,t.config))&&i.postMessage({workerId:o.WORKER_ID,results:t,finished:!0})}),(v.prototype=Object.create(g.prototype)).constructor=v,(P.prototype=Object.create(g.prototype)).constructor=P,(E.prototype=Object.create(E.prototype)).constructor=E,(u.prototype=Object.create(g.prototype)).constructor=u,o})}(ft)),ft.exports}var Js=Ys();const Zs=ws(Js),de={debug:(...a)=>{},info:(...a)=>{},warn:(...a)=>{},error:(...a)=>{},group:(a,r)=>{}},Be="https://click.wa.expert/api",Le={fetchRecords:async a=>{try{de.debug("Fetching records with params:",a);const r=await ye.post(`${Be}/data/getAllData`,a);return{data:r.data.data||[],columns:r.data.columns||[],pagination:r.data.pagination||null,success:!0}}catch(r){throw de.error("Error fetching records:",r),r}},fetchPaymentRecords:async a=>{try{const r=await ye.get(`${Be}/payment-reminders/list?owner_id=${a}`);return{data:r.data.data||r.data||[],success:!0}}catch(r){throw de.error("Error fetching payment records:",r),r}},fetchRecordById:async(a,r)=>{try{const n=decodeURIComponent(r);return{data:(await ye.post(`${Be}/data/getRecordById`,{schemaName:a.schemaName,tableName:a.tableName,id:n})).data,success:!0}}catch(n){return de.error("Error fetching record by ID:",n),{data:null,success:!1,error:n.message}}},createRecord:async(a,r)=>{try{return{data:(await ye.post(`${Be}/data/createRecord`,{schemaName:a.schemaName,tableName:a.tableName,record:r})).data,success:!0}}catch(n){throw de.error("Error creating record:",n),n}},createPaymentReminder:async a=>{try{return{data:(await ye.post(`${Be}/payment-reminders/add`,a,{headers:{"Content-Type":"application/json"}})).data,success:!0}}catch(r){throw de.error("Error creating payment reminder:",r),r}},updateRecord:async(a,r,n,i)=>{try{return{data:(await ye.post(`${Be}/data/updateMultiple`,{schemaName:a.schemaName,tableName:a.tableName,recordId:r,ownerId:n,updates:i},{headers:{"Content-Type":"application/json"}})).data,success:!0}}catch(c){throw de.error("Error updating record:",c),c}},deleteRecord:async(a,r)=>{try{const n=new URLSearchParams({id:r,schemaName:a.schemaName,tableName:a.tableName});return{data:(await ye.get(`${Be}/data/deleteRecord?${n.toString()}`)).data,success:!0}}catch(n){throw de.error("Error deleting record:",n),n}},fetchDropdownSetup:async(a,r)=>{try{const n=await ye.get(`${Be}/reference/setup/check?owner_id=${a}&product_name=${r}`);return n.data.exists&&n.data.setup?{mapping:n.data.setup.mapping||{},columnOrder:n.data.setup.columnOrder||{},exists:!0,success:!0}:{mapping:{},columnOrder:{},exists:!1,success:!0}}catch(n){return de.error("Error fetching dropdown setup:",n),{mapping:{},columnOrder:{},exists:!1,success:!1}}}},_t={DEFAULT_PAGE_SIZE:20},je={TEXT:"text",NUMBER:"number",EMAIL:"email",PHONE:"tel",URL:"url",DATE:"date",TEXTAREA:"textarea",CHECKBOX:"checkbox",SELECT_STATUS:"select-status",SELECT_PRIORITY:"select-priority"},Ct={PENDING:"pending",IN_PROGRESS:"in progress",COMPLETED:"completed"},Ye={LOW:"low",MEDIUM:"medium",HIGH:"high"},ts={[Ct.PENDING]:"bg-yellow-100 text-yellow-700 border-yellow-200",[Ct.IN_PROGRESS]:"bg-blue-100 text-blue-700 border-blue-200",[Ct.COMPLETED]:"bg-green-100 text-green-700 border-green-200",default:"bg-gray-100 text-gray-700 border-gray-200"},ss={[Ye.HIGH]:"bg-red-100 text-red-700 border-red-200",[Ye.MEDIUM]:"bg-orange-100 text-orange-700 border-orange-200",[Ye.LOW]:"bg-green-100 text-green-700 border-green-200",default:"bg-gray-100 text-gray-700 border-gray-200"},er=["invoice","date","due_date","final_due_date","last_overdue_reminder_date","sent_at","created_at","updated_at"],tr=["out_webhooks","emails"],ut={PA_ID:"pa_id",US_ID:"us_id"},sr=a=>a.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),rr=(a,r)=>{const n=r.toLowerCase();return n.includes("email")?je.EMAIL:n.includes("phone")?je.PHONE:n.includes("url")||n.includes("link")||n.includes("invoice_url")?je.URL:n==="status"?je.SELECT_STATUS:n==="priority"?je.SELECT_PRIORITY:n.includes("description")||n.includes("notes")||n.includes("comment")?je.TEXTAREA:n.includes("date")||n.includes("created")||n.includes("updated")||n==="invoice"?je.DATE:typeof a=="number"?je.NUMBER:typeof a=="boolean"?je.CHECKBOX:a&&a.length>100?je.TEXTAREA:je.TEXT},Nt=()=>Date.now().toString(),bt=(a,r)=>r[a==null?void 0:a.toLowerCase()]||r.default,Lt=(a,r=null)=>a.filter(n=>{if(n.id==="id"||n.id.includes("_comment")||n.id.includes("created_at")||n.id.includes("updated_at"))return!1;if(r){const i=n.id.toLowerCase(),c=n.name.toLowerCase();if(i.includes("balance")||c.includes("balance"))return!1}return!0}),Pt=(a,r={})=>a.filter(n=>r[n.id]!==0).sort((n,i)=>{const c=r[n.id]||999,p=r[i.id]||999;return c!==p?c-p:n.name.localeCompare(i.name)}),ar=(a,r=[],n=[])=>Object.fromEntries(Object.entries(a).map(([i,c])=>r.includes(i)?[i,c===""?null:c]:n.includes(i)?c===""?[i,null]:[i,c]:[i,c===""?null:c])),nr=(a,r=[])=>Object.fromEntries(Object.entries(a).filter(([n,i])=>i!=null&&i!==""?!0:r.includes(n))),ir=(a,r="normal",n)=>{const[i,c]=l.useState([]),[p,h]=l.useState([]),[S,C]=l.useState([]),[o,g]=l.useState({}),[v,P]=l.useState(!0),[E,u]=l.useState(1),[m,x]=l.useState(_t.DEFAULT_PAGE_SIZE),[z,re]=l.useState({currentPage:1,pageSize:_t.DEFAULT_PAGE_SIZE,totalRecords:0,totalPages:0,hasNextPage:!1,hasPreviousPage:!1}),D=l.useCallback(async(_=E,t=m)=>{try{P(!0),de.debug("Fetching table data",{apiParams:a,type:r,page:_,limit:t});let s;r==="normal"?(s=await Le.fetchRecords({...a,page:_,limit:t}),g(s.columns),s.pagination&&re(s.pagination)):s=await Le.fetchPaymentRecords(n);let d=s.data||[];if(r==="payment"&&(d=d.filter(b=>b.type==="original"||b.type==="Original")),h(d),c(d),d.length>0){const b=d[0],y=Object.keys(b).map(O=>({id:O,name:sr(O),sortable:!0,visible:!0,type:rr(b[O],O)}));C(y)}else _===1&&C([])}catch(s){de.error("Error fetching table data:",s),W.error("Failed to fetch records"),h([]),c([]),C([])}finally{P(!1)}},[a.schemaName,a.tableName,r,n,E,m]);l.useEffect(()=>{D(E,m)},[E,m,a.schemaName,a.tableName,r,n]);const q=l.useCallback(_=>{const t=Math.max(1,Math.min(_,z.totalPages||1));u(t)},[z.totalPages]),te=l.useCallback(_=>{x(_),u(1)},[]),G=l.useCallback(()=>{u(1),x(_t.DEFAULT_PAGE_SIZE)},[]);return{records:i,setRecords:c,originalRecords:p,columns:S,setColumns:C,metaData:o,loading:v,fetchData:D,refreshData:()=>D(E,m),currentPage:E,pageSize:m,paginationInfo:z,goToPage:q,changePageSize:te,resetPagination:G}},Mt="https://click.wa.expert/api",$t={async fetch(a,r){var n;try{const i=`${a}_${r}`,c=await ye.post(`${Mt}/data/getRecordById`,{id:i,schemaName:"public",tableName:"column_preferences"});let p=c.data.column_visibility;if(typeof p=="string")try{p=JSON.parse(p)}catch{return null}return{...c.data,column_visibility:p}}catch(i){return((n=i.response)==null?void 0:n.status)===404,null}},async save(a,r,n,i){var p;try{const h=`${a}_${r}`,S=JSON.stringify(n),C=`${Mt}/data/createRecord`,o={schemaName:"public",tableName:"column_preferences",record:{us_id:h,owner_id:a,table_name:r,schema_name:i,column_visibility:S,updated_at:new Date().toISOString()}};return{success:!0,data:(await ye.post(C,o)).data}}catch(h){return{success:!1,error:((p=h.response)==null?void 0:p.data)||h.message}}}},or=(a,r,n,i)=>{const[c,p]=l.useState(i),[h,S]=l.useState(!1),C=l.useCallback(async()=>{try{const u=await $t.fetch(a,r);return u&&u.column_visibility?(de.debug("Loaded column preferences:",u.column_visibility),u.column_visibility):null}catch(u){return de.error("Error loading column preferences:",u),null}},[a,r]),o=l.useCallback((u,m)=>m?u.map(x=>{const z=m[x.id]!==void 0?m[x.id]:!0;return{...x,visible:z}}):u,[]),g=l.useCallback(async u=>{try{const m={};u.forEach(z=>{m[z.id]=z.visible}),(await $t.save(a,r,m,n)).success&&(de.debug("Column preferences saved successfully"),W.success("Column preferences saved"))}catch(m){de.error("Error saving column preferences:",m),W.error("Failed to save column preferences")}},[a,r,n]),v=l.useCallback(async u=>{const m=c.map(x=>x.id===u?{...x,visible:!x.visible}:x);p(m),await g(m)},[c,g]),P=l.useCallback(async()=>{const u=c.map(m=>({...m,visible:!0}));p(u),await g(u),W.success("Column visibility reset to default")},[c,g]),E=l.useCallback(async()=>{const u=c.map(m=>({...m,visible:!1}));p(u),await g(u),W.success("All columns hidden")},[c,g]);return l.useEffect(()=>{(async()=>{if(!h&&i.length>0){const m=await C(),x=o(i,m);p(x),S(!0)}})()},[i,h,C,o]),l.useEffect(()=>{i.length>0&&!h&&p(i)},[i,h]),{columns:c,setColumns:p,toggleColumnVisibility:v,resetColumnVisibility:P,hideAllColumns:E,visibleColumns:c.filter(u=>u.visible)}},lr=a=>{const[r,n]=l.useState(""),[i,c]=l.useState([]),[p,h]=l.useState([]),S=l.useMemo(()=>{if(!a.length)return[];let u=[...a];if(r.trim()!==""){const m=r.toLowerCase();u=u.filter(x=>Object.values(x).some(z=>String(z).toLowerCase().includes(m)))}return i.length>0&&(u=u.filter(m=>i.includes(m.status))),p.length>0&&(u=u.filter(m=>p.includes(m.priority))),de.debug("Filtered records:",{original:a.length,filtered:u.length,searchTerm:r,statusFilter:i,priorityFilter:p}),u},[a,r,i,p]),C=l.useMemo(()=>Array.from(new Set(a.map(u=>u.status))).filter(Boolean),[a]),o=l.useMemo(()=>Array.from(new Set(a.map(u=>u.priority))).filter(Boolean),[a]),g=l.useCallback(u=>{c(m=>m.includes(u)?m.filter(x=>x!==u):[...m,u])},[]),v=l.useCallback(u=>{h(m=>m.includes(u)?m.filter(x=>x!==u):[...m,u])},[]),P=l.useCallback(()=>{n(""),c([]),h([])},[]),E=l.useMemo(()=>r!==""||i.length>0||p.length>0,[r,i,p]);return{searchTerm:r,setSearchTerm:n,statusFilter:i,setStatusFilter:c,priorityFilter:p,setPriorityFilter:h,filteredRecords:S,uniqueStatuses:C,uniquePriorities:o,toggleStatusFilter:g,togglePriorityFilter:v,clearFilters:P,hasActiveFilters:E}},cr=(a,r,n)=>{const[i,c]=l.useState({}),[p,h]=l.useState(!1),[S,C]=l.useState(!1),o=l.useCallback((m={})=>{c(m)},[]),g=l.useCallback((m,x)=>{c(z=>({...z,[m]:x}))},[]),v=l.useCallback(()=>{c({})},[]),P=l.useCallback(async(m={})=>{try{h(!0);const x={...i,...m};de.debug("Submitting form data:",x);const z=ar(x,er,tr),D=nr(z,["status","type"]);de.debug("Cleaned record data:",D);let q;return r==="payment"?q=await Le.createPaymentReminder(D):q=await Le.createRecord(a,D),W.success("Record created successfully!"),n&&n(q.data),v(),C(!1),q}catch(x){throw de.error("Error submitting form:",x),x.response?W.error(`Failed to create record: ${x.response.data.error||x.response.data.message||"Unknown error"}`):W.error(`Failed to create record: ${x.message}`),x}finally{h(!1)}},[i,a,r,n,v]),E=l.useCallback((m={})=>{o(m),C(!0)},[o]),u=l.useCallback(()=>{C(!1),v()},[v]);return{formData:i,isSubmitting:p,isOpen:S,initializeForm:o,handleFieldChange:g,resetForm:v,submitForm:P,openForm:E,closeForm:u}},dr=(a,r)=>{const[n,i]=l.useState({}),[c,p]=l.useState({}),[h,S]=l.useState(!1),[C,o]=l.useState(!0),g=l.useCallback(async()=>{try{o(!0);const u=await Le.fetchDropdownSetup(a,r);u.exists?(i(u.mapping),p(u.columnOrder),S(!0),de.debug("Dropdown setup loaded:",{mapping:u.mapping,columnOrder:u.columnOrder})):(i({}),p({}),S(!1))}catch(u){de.error("Error fetching dropdown setup:",u),i({}),p({}),S(!1)}finally{o(!1)}},[a,r]),v=l.useCallback(u=>n[u]||[],[n]),P=l.useCallback(u=>{const m=n[u];return Array.isArray(m)&&m.length>0},[n]),E=l.useCallback(u=>c[u]||999,[c]);return l.useEffect(()=>{a&&r&&g()},[a,r,g]),{dropdownSetup:n,columnOrder:c,setupExists:h,loading:C,fetchSetup:g,getDropdownOptions:v,hasDropdown:P,getColumnOrder:E}};function ur(a,r,{checkForDefaultPrevented:n=!0}={}){return function(c){if(a==null||a(c),n===!1||!c.defaultPrevented)return r==null?void 0:r(c)}}var hr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],rs=hr.reduce((a,r)=>{const n=ys(`Primitive.${r}`),i=l.forwardRef((c,p)=>{const{asChild:h,...S}=c,C=h?n:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(C,{...S,ref:p})});return i.displayName=`Primitive.${r}`,{...a,[r]:i}},{}),yt="Switch",[fr,Wr]=Cs(yt),[pr,mr]=fr(yt),as=l.forwardRef((a,r)=>{const{__scopeSwitch:n,name:i,checked:c,defaultChecked:p,required:h,disabled:S,value:C="on",onCheckedChange:o,form:g,...v}=a,[P,E]=l.useState(null),u=Wt(r,D=>E(D)),m=l.useRef(!1),x=P?g||!!P.closest("form"):!0,[z,re]=_s({prop:c,defaultProp:p??!1,onChange:o,caller:yt});return e.jsxs(pr,{scope:n,checked:z,disabled:S,children:[e.jsx(rs.button,{type:"button",role:"switch","aria-checked":z,"aria-required":h,"data-state":ls(z),"data-disabled":S?"":void 0,disabled:S,value:C,...v,ref:u,onClick:ur(a.onClick,D=>{re(q=>!q),x&&(m.current=D.isPropagationStopped(),m.current||D.stopPropagation())})}),x&&e.jsx(os,{control:P,bubbles:!m.current,name:i,value:C,checked:z,required:h,disabled:S,form:g,style:{transform:"translateX(-100%)"}})]})});as.displayName=yt;var ns="SwitchThumb",is=l.forwardRef((a,r)=>{const{__scopeSwitch:n,...i}=a,c=mr(ns,n);return e.jsx(rs.span,{"data-state":ls(c.checked),"data-disabled":c.disabled?"":void 0,...i,ref:r})});is.displayName=ns;var gr="SwitchBubbleInput",os=l.forwardRef(({__scopeSwitch:a,control:r,checked:n,bubbles:i=!0,...c},p)=>{const h=l.useRef(null),S=Wt(h,p),C=js(n),o=Ss(r);return l.useEffect(()=>{const g=h.current;if(!g)return;const v=window.HTMLInputElement.prototype,E=Object.getOwnPropertyDescriptor(v,"checked").set;if(C!==n&&E){const u=new Event("click",{bubbles:i});E.call(g,n),g.dispatchEvent(u)}},[C,n,i]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...c,tabIndex:-1,ref:S,style:{...c.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});os.displayName=gr;function ls(a){return a?"checked":"unchecked"}var cs=as,xr=is;const ds=l.forwardRef(({className:a,...r},n)=>e.jsx(cs,{className:Xe("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:n,children:e.jsx(xr,{className:Xe("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));ds.displayName=cs.displayName;const br=({tableName:a="jobstatus",onCounterUpdate:r})=>{const[n,i]=l.useState(0),[c,p]=l.useState(""),[h,S]=l.useState(!1),[C,o]=l.useState(!1),[g,v]=l.useState(!1),[P,E]=l.useState(null),u=wt(D=>D.user),m=u.owner_id===null?u.id:u.owner_id,x=async()=>{try{v(!0);const D="https://click.wa.expert/api/data/getRecordById",te={id:`${m}_${a}`,schemaName:"public",tableName:"counter_setup"},{data:G}=await ye.post(D,te);if(G){const _=parseInt(G.counter,10)||0;i(_),p(G.prefix||""),S(G.is_active||!1),E(G.id),r&&r({counter:_,prefix:G.prefix||"",isActive:G.is_active||!1,recordId:G.id})}}catch{i(1),p(""),S(!1),E(null),await z()}finally{v(!1)}},z=async()=>{try{const D="https://click.wa.expert/api/data/createRecord",te={schemaName:"public",tableName:"counter_setup",record:{us_id:`${m}_${a}`,owner_id:m,table_name:a,prefix:"",counter:1,is_active:!1}},{data:G}=await ye.post(D,te);await x()}catch{}},re=async()=>{try{o(!0);const D=parseInt(n,10),q="https://click.wa.expert/api/data/createRecord",te=`${m}_${a}`,G={schemaName:"public",tableName:"counter_setup",record:{us_id:te,owner_id:m,table_name:a,prefix:c,counter:D,is_active:h,updated_at:new Date().toISOString()}};await ye.post(q,G),W.success("Counter settings saved successfully"),r&&r({counter:D,prefix:c,isActive:h,recordId:P||te}),await x()}catch{W.error("Failed to save counter settings")}finally{o(!1)}};return l.useEffect(()=>{x()},[a]),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(ds,{id:"counter-active",checked:h,onCheckedChange:S}),e.jsx(qe,{htmlFor:"counter-active",className:"text-sm font-medium whitespace-nowrap",children:"Auto Counter"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[120px]",children:[e.jsx(qe,{htmlFor:"prefix",className:"text-sm whitespace-nowrap",children:"Prefix:"}),e.jsx(Fe,{id:"prefix",type:"text",value:c,onChange:D=>p(D.target.value),placeholder:"INV",className:"h-9"})]}),h&&e.jsxs("div",{className:"text-sm bg-blue-50 px-2 py-1.5 rounded border border-blue-200 flex w-[10rem] items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Next : "}),e.jsxs("span",{className:"font-mono font-semibold text-blue-700",children:[c,n]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(ee,{onClick:re,disabled:C,size:"sm",variant:"default",children:e.jsx(Ns,{className:"h-3.5 w-3.5"})}),e.jsx(ee,{onClick:x,disabled:g,variant:"outline",size:"sm",children:e.jsx(Zt,{className:`h-3.5 w-3.5 ${g?"animate-spin":""}`})})]})]})})})},wr=({title:a="All Records",description:r="View and manage all database records",searchTerm:n="",onSearchChange:i,tableName:c,onCounterUpdate:p,urlParams:h={},dropdownSetupExists:S=!1,columnOrderExists:C=!1})=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:e.jsxs("div",{className:"w-[95%]",children:[e.jsxs("div",{className:"flex md:flex-row md:items-center justify-between w-full",children:[e.jsx(Vt,{className:"text-2xl font-semibold text-slate-700",children:a}),e.jsx("div",{className:"lg:flex-1 lg:max-w-[500px]",children:e.jsx(br,{tableName:c,onCounterUpdate:p})})]}),e.jsxs(vs,{className:"mt-1",children:[r,h.pa_id&&e.jsx("div",{className:"flex gap-2 mt-1",children:e.jsxs(Se,{variant:"outline",className:"text-xs bg-green-50 border-green-200",children:["PA ID: ",h.pa_id]})}),h.process_name&&e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(Se,{variant:"outline",className:"text-xs bg-purple-50 border-purple-200",children:["Process: ",h.process_name]}),e.jsxs(Se,{variant:"outline",className:"text-xs bg-blue-50 border-blue-200",children:[h.process_name,"_balance"]})]}),S&&e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Se,{variant:"outline",className:"text-xs",children:"Dropdown Configured"}),C&&e.jsxs(Se,{variant:"outline",className:"text-xs bg-blue-50 border-blue-200",children:[e.jsx(Ls,{className:"h-3 w-3 mr-1"}),"Custom Order"]})]})]})]})}),e.jsx("div",{className:"flex flex-col lg:flex-row items-stretch lg:items-end gap-3",children:e.jsxs("div",{className:"relative lg:w-[300px]",children:[e.jsx(ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(Fe,{type:"text",placeholder:"Search records...",value:n,onChange:i,className:"pl-9"})]})})]}),yr=250,_r="https://click.wa.expert/api",Cr=({value:a,onChange:r,placeholder:n="Enter the ID"})=>{const[i,c]=l.useState(!1),[p,h]=l.useState("jobstatus"),[S,C]=l.useState([]),[o,g]=l.useState(!1),v=l.useRef(!1),P=wt(x=>x.user),E=(P==null?void 0:P.schema_name)||"default_schema";l.useEffect(()=>{if(!a||!a.trim()){C([]),g(!1);return}if(v.current){v.current=!1;return}if(!o)return;const x=new AbortController,z=setTimeout(async()=>{var re;try{const{data:D}=await ye.post(`${_r}/additional/search`,{schemaName:E,tableName:p,query:a,userId:P.id,userEmail:P.email},{signal:x.signal}),q=(D==null?void 0:D.data)||[];C(q),(re=D.data)!=null&&re.table_name&&h(D.data.table_name),g(q.length>0)}catch(D){D.name!=="CanceledError"&&D.name}},yr);return()=>{clearTimeout(z),x.abort()}},[a,p,E,o,P.id,P.email]);const u=l.useCallback((x,z)=>{v.current=!0,r(x),h(z),C([]),g(!1)},[r]),m=l.useCallback(x=>{v.current=!1,r(x.target.value),g(!0)},[r]);return e.jsxs("div",{className:"relative w-full",children:[e.jsx(Fe,{type:"text",value:a,onChange:m,className:"bg-gray-50 text-gray-700",placeholder:n,"aria-label":"Search ID",disabled:i,autoComplete:"off"}),o&&S.length>0&&e.jsx("ul",{className:"absolute z-50 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-48 overflow-y-auto shadow-md",children:S.map((x,z)=>e.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 text-sm",onClick:()=>u(x.us_id,x.table_name),children:x.us_id},x.us_id||z))})]})},jr=({onRefresh:a,onAddRecord:r,onExportCSV:n,onToggleEdit:i,editEnabled:c=!1,canEdit:p=!0,isLoading:h=!1,splitOptions:S=[],onSplitLoad:C})=>{const[o,g]=tt.useState(!1),[v,P]=tt.useState(""),[E,u]=tt.useState(""),[m,x]=tt.useState(!1),z=()=>{g(!0)},re=()=>{g(!1),P(""),u("")},D=async()=>{if(v&&E.trim()&&C){x(!0);try{await C(v,E.trim()),g(!1),P(""),u("")}catch{}finally{x(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(ee,{className:"flex items-center gap-2",onClick:r,disabled:h,children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Record"})]}),e.jsxs(ee,{className:"flex items-center gap-2",onClick:z,disabled:h,children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Split"})]}),e.jsxs(ee,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:a,disabled:h,children:[e.jsx(Zt,{className:`h-4 w-4 ${h?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs(ee,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:n,disabled:h,children:[e.jsx(Vs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export CSV"})]}),p&&e.jsxs(ee,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:i,disabled:h,children:[e.jsx(Rs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:c?"Editing":"Edit"}),c&&e.jsx(Se,{className:"ml-1 bg-blue-500",children:"ON"})]})]}),e.jsx(kt,{open:o,onOpenChange:g,children:e.jsxs(Et,{className:"sm:max-w-md",children:[e.jsx(st,{children:e.jsx(rt,{children:"Add Split Record"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(qe,{className:"text-sm font-medium",children:"Parent ID (pa_id):"}),e.jsx(Cr,{value:E,onChange:u,placeholder:"Enter parent ID"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(qe,{className:"text-sm font-medium",children:"Select Table:"}),e.jsxs(pt,{value:v,onValueChange:P,disabled:m,children:[e.jsx(mt,{className:"w-full",children:e.jsx(gt,{placeholder:"Select a table"})}),e.jsx(xt,{children:S.length>0?S.map((q,te)=>e.jsx(Ke,{value:q.value||q,children:q.label||q},q.value||te)):e.jsx(Ke,{value:"no-options",disabled:!0,children:"No options available"})})]})]})]}),e.jsxs(at,{className:"gap-2 sm:gap-0",children:[e.jsx(ee,{variant:"outline",onClick:re,disabled:m,children:"Cancel"}),e.jsx(ee,{onClick:D,disabled:!v||!E.trim()||m,children:m?"Loading...":"Load Form"})]})]})})]})},Sr=({uniqueStatuses:a=[],uniquePriorities:r=[],statusFilter:n=[],priorityFilter:i=[],onToggleStatus:c,onTogglePriority:p,onClearStatusFilter:h,onClearPriorityFilter:S})=>{const C=n.length+i.length;return e.jsxs(Gt,{children:[e.jsx(Kt,{asChild:!0,children:e.jsxs(ee,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Filters"}),C>0&&e.jsx(Se,{className:"ml-1 py-0 px-1.5 h-5 min-w-5 bg-blue-500 text-white rounded-full",children:C})]})}),e.jsxs(Xt,{align:"start",className:"w-56",children:[e.jsxs(jt,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Filter by Status"}),n.length>0&&e.jsx(ee,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:h,children:"Clear"})]}),a.length>0?a.map(o=>e.jsxs(Ot,{checked:n.includes(o),onCheckedChange:()=>c(o),children:[e.jsx(Se,{className:`font-medium mr-2 ${bt(o,ts)}`,children:o}),e.jsx("span",{children:o})]},o)):e.jsx(St,{disabled:!0,children:"No statuses available"}),e.jsx(Qt,{}),e.jsxs(jt,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Filter by Priority"}),i.length>0&&e.jsx(ee,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:S,children:"Clear"})]}),r.length>0?r.map(o=>e.jsxs(Ot,{checked:i.includes(o),onCheckedChange:()=>p(o),children:[e.jsx(Se,{className:`font-medium mr-2 ${bt(o,ss)}`,children:o}),e.jsx("span",{children:o})]},o)):e.jsx(St,{disabled:!0,children:"No priorities available"})]})]})},Nr=({columns:a=[],onToggleColumn:r,onResetVisibility:n,onHideAll:i})=>e.jsxs(Gt,{children:[e.jsx(Kt,{asChild:!0,children:e.jsxs(ee,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Columns"})]})}),e.jsxs(Xt,{align:"start",className:"w-56",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[e.jsx(jt,{className:"p-0",children:"Toggle Columns"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ee,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:c=>{c.stopPropagation(),i()},children:"Hide All"}),e.jsx(ee,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:c=>{c.stopPropagation(),n()},children:"Reset"})]})]}),e.jsx(Qt,{}),a.map(c=>e.jsx(St,{onSelect:p=>{p.preventDefault(),r(c.id)},children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(es,{checked:c.visible,onCheckedChange:()=>r(c.id)}),e.jsx("span",{className:"flex-1",children:c.name}),!c.visible&&e.jsx(Se,{variant:"secondary",className:"text-xs",children:"Hidden"})]})},c.id))]})]}),vr=({records:a=[],columns:r=[],loading:n=!1,editEnabled:i=!1,canDelete:c=!1,onSort:p,onDeleteRecord:h,onEditRecord:S,onSaveRecord:C,sortColumn:o=null,sortDirection:g="asc",emptyMessage:v="No records found",onClearFilters:P})=>{const[E,u]=l.useState(null),[m,x]=l.useState({}),z=l.useCallback(_=>{i&&(u(_.id),x(_),S&&S(_))},[i,S]),re=l.useCallback(()=>{C&&C(E,m),u(null),x({})},[E,m,C]),D=l.useCallback(()=>{u(null),x({})},[]),q=l.useCallback((_,t)=>{x(s=>({...s,[_]:t}))},[]),te=(_,t)=>{const s=_[t.id];return E===_.id&&t.id!=="id"&&i?e.jsx(Fe,{type:"text",value:m[t.id]||"",onChange:d=>q(t.id,d.target.value),className:"border rounded px-2 py-1 w-full",onClick:d=>d.stopPropagation()}):t.id==="status"?e.jsx(Se,{className:`font-medium ${bt(s,ts)}`,children:s}):t.id==="priority"?e.jsx(Se,{className:`font-medium ${bt(s,ss)}`,children:s}):t.id==="task_file"&&s?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{children:s})]}):e.jsx("span",{children:s||"â€”"})},G=r.filter(_=>_.visible);return e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ms,{children:[e.jsx($s,{children:e.jsxs(ct,{className:"bg-slate-50",children:[c&&e.jsx(At,{className:"w-[60px] text-center",children:"Delete"}),G.map(_=>e.jsx(At,{className:`${_.sortable?"cursor-pointer hover:bg-slate-100":""}`,onClick:()=>_.sortable&&p&&p(_.id),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:_.name}),o===_.id&&e.jsx(Ts,{className:`h-4 w-4 transition-transform ${g==="desc"?"rotate-180":""}`})]})},_.id))]})}),e.jsx(Us,{children:n?e.jsx(ct,{children:e.jsx(dt,{colSpan:G.length+(c?1:0),className:"h-24 text-center",children:"Loading records..."})}):a.length===0?e.jsx(ct,{children:e.jsxs(dt,{colSpan:G.length+(c?1:0),className:"h-24 text-center",children:[v,P&&e.jsx(ee,{variant:"link",onClick:P,className:"ml-2",children:"Clear filters?"})]})}):a.map((_,t)=>e.jsxs(ct,{className:"hover:bg-slate-50 cursor-pointer",onClick:()=>z(_),children:[c&&e.jsx(dt,{className:"w-[60px] text-center",children:e.jsx(ee,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:s=>{s.stopPropagation(),h&&h(_)},children:e.jsx(Yt,{className:"h-4 w-4"})})}),G.map(s=>e.jsx(dt,{children:te(_,s)},s.id))]},_.id||t))})]})}),E&&i&&e.jsxs("div",{className:"flex gap-2 p-3 bg-slate-50 border-t",children:[e.jsx(ee,{size:"sm",onClick:re,children:"Save Changes"}),e.jsx(ee,{size:"sm",variant:"ghost",onClick:D,children:"Cancel"})]})]})},Ut=({column:a,value:r,onChange:n,dropdownOptions:i=[],isAutoFilled:c=!1,disabled:p=!1})=>{const{id:h,type:S,name:C}=a;if(c)return e.jsx(Fe,{id:h,type:"text",value:r||"",disabled:!0,className:"bg-gray-50 cursor-not-allowed text-gray-600",placeholder:`Auto-filled ${C.toLowerCase()}`});if(i.length>0)return e.jsxs(pt,{value:r||"",onValueChange:o=>n(h,o),disabled:p,children:[e.jsx(mt,{children:e.jsx(gt,{placeholder:`Select ${C.toLowerCase()}`})}),e.jsx(xt,{children:i.map((o,g)=>e.jsx(Ke,{value:o,children:o},g))})]});switch(S){case je.TEXTAREA:return e.jsx(zs,{id:h,value:r||"",onChange:o=>n(h,o.target.value),placeholder:`Enter ${C.toLowerCase()}`,rows:3,disabled:p});case je.SELECT_PRIORITY:return e.jsxs(pt,{value:r||"",onValueChange:o=>n(h,o),disabled:p,children:[e.jsx(mt,{children:e.jsx(gt,{placeholder:"Select priority"})}),e.jsxs(xt,{children:[e.jsx(Ke,{value:Ye.LOW,children:"Low"}),e.jsx(Ke,{value:Ye.MEDIUM,children:"Medium"}),e.jsx(Ke,{value:Ye.HIGH,children:"High"})]})]});case je.NUMBER:return e.jsx(Fe,{id:h,type:"number",value:r||"",onChange:o=>n(h,o.target.value),placeholder:`Enter ${C.toLowerCase()}`,disabled:p});case je.EMAIL:return e.jsx(Fe,{id:h,type:"email",value:r||"",onChange:o=>n(h,o.target.value),placeholder:`Enter ${C.toLowerCase()}`,disabled:p});case je.PHONE:return e.jsx(Fe,{id:h,type:"tel",value:r||"",onChange:o=>n(h,o.target.value),placeholder:`Enter ${C.toLowerCase()}`,disabled:p});case je.DATE:return e.jsx(Fe,{id:h,type:"date",value:r||"",onChange:o=>n(h,o.target.value),disabled:p});case je.URL:return e.jsx(Fe,{id:h,type:"url",value:r||"",onChange:o=>n(h,o.target.value),placeholder:`Enter ${C.toLowerCase()}`,disabled:p});case je.CHECKBOX:return e.jsx(es,{id:h,checked:r||!1,onCheckedChange:o=>n(h,o),disabled:p});default:return e.jsx(Fe,{id:h,type:"text",value:r||"",onChange:o=>n(h,o.target.value),placeholder:`Enter ${C.toLowerCase()}`,disabled:p})}},zt=({isOpen:a,onClose:r,onSubmit:n,formData:i,onFieldChange:c,columns:p,metaData:h=[],dropdownSetup:S={},columnOrder:C={},processName:o=null,isSubmitting:g=!1,counterConfig:v,setCounterConfig:P,mode:E="create",itsSplit:u})=>{const m=wt(f=>f.user),x=(m==null?void 0:m.owner_id)??(m==null?void 0:m.id),[z,re]=Jt(),[D,q]=l.useState(!1),[te,G]=l.useState(""),[_,t]=l.useState({}),[s,d]=l.useState([]),[b,y]=l.useState([]),[O,ue]=l.useState({}),[_e,ie]=l.useState({}),[U,J]=l.useState(null),[k,xe]=l.useState(null),[M,L]=l.useState(!1),[j,oe]=l.useState(!1),[se,pe]=l.useState(!1),[be,T]=l.useState([]),[V,le]=l.useState([]);l.useEffect(()=>{ce()},[]);const A=m.schema_name,ce=async()=>{const f=`https://click.wa.expert/api/data/getAllTables?schemaName=${A}`,{data:$}=await ye.get(f);le($.data)};l.useEffect(()=>{a&&E==="create"&&p.length>0&&p.some($=>$.id==="status"||$.id.toLowerCase()==="status")&&be.length>0&&(!i.status||i.status==="")&&c("status",be[0])},[a,E,p,be,i.status]);const fe=l.useMemo(()=>{const f=Lt(p,o);return Pt(f,C)},[p,o,C]),Q=f=>{const $=h.find(R=>R.column_name===f);return($==null?void 0:$.is_nullable)==="NO"},K=f=>f===ut.PA_ID,B=f=>{const $=S[f];return Array.isArray($)?$:[]},ke=f=>o&&(f.id.toLowerCase().includes("quantity")||f.name.toLowerCase().includes("quantity")),I=()=>{const f=window.location.pathname.split("/");return f[f.length-2]},ae=(f,$)=>{const R={};return Object.entries(f).forEach(([H,he])=>{if(he===""||he===null||he===void 0)return;const Ie=$.find(X=>X.column_name===H);if(Ie){const X=Ie.data_type.toLowerCase();if(X.includes("int")||X.includes("serial")){const ge=parseInt(he,10);isNaN(ge)||(R[H]=ge)}else if(X.includes("numeric")||X.includes("decimal")||X.includes("float")||X.includes("double")){const ge=parseFloat(he);isNaN(ge)||(R[H]=ge)}else X.includes("bool")?R[H]=he===!0||he==="true"||he==="1":(X.includes("date")||X.includes("time"),R[H]=he)}else R[H]=he}),R},Ae=async f=>{try{const $={schemaName:m.schema_name,tableName:f,userId:m.id,userEmail:m.email},R=await ye.post("https://click.wa.expert/api/data/getAllData",$),H=R.data.data||[],he=R.data.columns||[];let Ie=[];if(H.length>0){const lt=H[0];Ie=Object.keys(lt).map(We=>({id:We,name:Pe(We),accessor:We,sortable:!0,visible:!0,type:Ee(lt[We],We)}))}const X=`https://click.wa.expert/api/reference/setup/check?owner_id=${x}&product_name=${f}`,ge=await ye.get(X);let Ne={},ot={},Je=[];return ge.data.exists&&ge.data.setup&&(Ne=ge.data.setup.mapping||{},ot=ge.data.setup.columnOrder||{},Je=ge.data.setup.process_steps||[],T(Je)),{columns:Ie,metaData:he,dropdownSetup:Ne,columnOrder:ot,processName:null,processSteps:Je}}catch($){throw $}},Pe=f=>f.split("_").map($=>$.charAt(0).toUpperCase()+$.slice(1)).join(" "),Ee=(f,$)=>{const R=$.toLowerCase();return R.includes("email")?"email":R.includes("phone")?"tel":R.includes("url")||R.includes("link")?"url":R==="status"?"select-status":R==="priority"?"select-priority":R.includes("description")||R.includes("notes")||R.includes("comment")?"textarea":R.includes("date")||R.includes("created")||R.includes("updated")?"date":typeof f=="number"?"number":typeof f=="boolean"?"checkbox":f&&f.length>100?"textarea":"text"},Me=async f=>{try{const $=I();let R=ae(f,h);const H={process_name:z.get("process_name"),pa_id:z.get("pa_id"),status:z.get("status")};if(H.process_name){const X=`${H.process_name}_balance`,ge=p.find(Ne=>Ne.id.toLowerCase().includes("quantity"));if(ge){const Ne=R[ge.id];Ne&&(R[X]=Ne)}}(H.status&&H.pa_id||H.process_name&&H.pa_id)&&(R.us_id=`${H.pa_id} -S- ${R.us_id}`);const he={schemaName:m.schema_name,tableName:$};return await Le.createRecord(he,R)}catch($){throw $}},me=async(f,$)=>{try{const R=ae(f,b);k&&R.us_id&&(R.us_id=`${k} -S- ${R.us_id}`);const H={schemaName:m.schema_name,tableName:$};return await Le.createRecord(H,R)}catch(R){throw R}},Re=async()=>{await n()},we=async()=>{var f,$,R,H,he,Ie;pe(!0);try{const X=await Me(i);let ge=null;if(($=(f=X==null?void 0:X.data)==null?void 0:f.data)!=null&&$.us_id)ge=X.data.data.us_id;else if(i.us_id)ge=i.us_id;else if((H=(R=X==null?void 0:X.data)==null?void 0:R.data)!=null&&H.us_id&&X.data.data.us_id.includes(" -S- ")){const Ne=X.data.data.us_id.split(" -S- ");ge=Ne[Ne.length-1]}if(v.isActive&&v.recordId)try{await Le.updateRecord({schemaName:"public",tableName:"counter_setup"},v.recordId,x,{counter:v.counter+1}),P(Ne=>({...Ne,counter:Ne.counter+1}))}catch{W.warning("Record created but counter increment failed")}ge?(xe(ge),W.success("Record created successfully"),q(!0)):W.error("Could not get us_id from created record")}catch(X){W.error("Failed to create record: "+(((Ie=(he=X.response)==null?void 0:he.data)==null?void 0:Ie.details)||X.message))}finally{pe(!1)}},Ce=async()=>{if(te){L(!0);try{const f=await Ae(te);d(f.columns||[]),y(f.metaData||[]),ue(f.dropdownSetup||{}),ie(f.columnOrder||{}),J(f.processName||null);const $={[ut.PA_ID]:k,us_id:Nt()};f.columns.some(H=>H.id==="status"||H.id.toLowerCase()==="status")&&f.processSteps&&f.processSteps.length>0&&($.status=f.processSteps[0]),f.columns.forEach(H=>{$[H.id]||($[H.id]="")}),t($),q(!1)}catch{W.error("Failed to load table structure. Please try again.")}finally{L(!1)}}},Oe=(f,$)=>{t(R=>({...R,[f]:$}))},Ve=async()=>{oe(!0);try{await me(_,te)&&(W.success("Detail record created successfully"),De(),window.location.reload())}catch{W.error("Failed to create detail record. Please try again.")}finally{oe(!1)}},Ue=async()=>{oe(!0);try{await me(_,te)&&(W.success("Detail record created successfully"),t({}),d([]),y([]),ue({}),ie({}),J(null),G(""),q(!0))}catch{W.error("Failed to create detail record. Please try again.")}finally{oe(!1)}},De=()=>{q(!1),G(""),t({}),d([]),y([]),ue({}),ie({}),J(null),xe(null),T([]),r()},Te=()=>e.jsxs(e.Fragment,{children:[e.jsxs(st,{children:[e.jsx(rt,{children:"Select Table for Details"}),e.jsxs(ht,{children:["Choose a table to add detail records linked to the parent record (pa_id: ",k,")"]})]}),e.jsxs("div",{className:"py-6",children:[e.jsx(qe,{htmlFor:"table-select",className:"text-sm font-medium mb-2 block",children:"Select Table"}),e.jsxs(pt,{value:te,onValueChange:G,children:[e.jsx(mt,{id:"table-select",className:"w-full",children:e.jsx(gt,{placeholder:"Choose a table..."})}),e.jsx(xt,{children:V.map(f=>e.jsx(Ke,{value:f.title,children:f.title.charAt(0).toUpperCase()+f.title.slice(1)},f.title))})]})]}),e.jsxs(at,{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx(ee,{variant:"outline",onClick:De,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(ee,{onClick:Ce,disabled:!te||M,className:"w-full sm:w-auto",children:M?"Loading...":"Load Form"})]})]}),ze=()=>e.jsxs(e.Fragment,{children:[e.jsxs(st,{children:[e.jsx(rt,{children:E==="create"?"Add New Record":"Edit Record"}),e.jsxs(ht,{children:[E==="create"?"Fill in the details to create a new record in the database.":"Update the record details.",o&&e.jsxs("span",{className:"block mt-1 text-blue-600",children:["Note: The ",o,"_balance field will be automatically set to match the quantity value."]})]})]}),e.jsx("div",{className:"space-y-6 py-4",children:fe.map(f=>{const $=C[f.id],R=K(f.id),H=Q(f.id),he=ke(f);return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs(qe,{htmlFor:f.id,className:"font-medium text-sm sm:w-48 sm:text-right sm:flex-shrink-0 flex items-center gap-1 justify-start sm:justify-end",children:[$&&e.jsx(Se,{variant:"secondary",className:"text-xs h-4 px-1 mr-1",children:$}),e.jsx("span",{className:"flex-1 sm:flex-initial",children:f.name}),H&&e.jsx(Se,{variant:"default",className:"text-xs h-4 px-1 text-red-100",children:"*"}),R&&e.jsx(Se,{variant:"default",className:"text-xs h-4 px-1 bg-green-500 ml-1",children:"auto"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Ut,{column:f,value:i[f.id],onChange:c,dropdownOptions:B(f.id),isAutoFilled:R,disabled:g||se}),R&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:f.id===ut.PA_ID?"Automatically filled from URL parameter":"Automatically generated unique identifier"}),he&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["This value will be used to set ",o,"_balance"]})]})]},f.id)})}),e.jsxs(at,{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx(ee,{variant:"outline",onClick:De,disabled:g||se,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(ee,{onClick:Re,disabled:g||se,className:"w-full sm:w-auto",children:g?E==="create"?"Creating...":"Updating...":E==="create"?"Create Record":"Update Record"}),!u&&e.jsx(ee,{onClick:we,disabled:g||se,variant:"secondary",className:"w-full sm:w-auto",children:se?"Creating...":"Create & Add Details"})]})]}),He=l.useMemo(()=>{const f=Lt(s,U);return Pt(f,_e)},[s,U,_e]),it=()=>e.jsxs(e.Fragment,{children:[e.jsxs(st,{children:[e.jsxs(rt,{children:["Add Details - ",te.charAt(0).toUpperCase()+te.slice(1)]}),e.jsxs(ht,{children:["Adding detail record linked to parent (pa_id: ",k,")"]})]}),e.jsx("div",{className:"space-y-6 py-4",children:He.map(f=>{var Ie;const $=_e[f.id],R=f.id===ut.PA_ID,H=((Ie=b.find(X=>X.column_name===f.id))==null?void 0:Ie.is_nullable)==="NO",he=Array.isArray(O[f.id])?O[f.id]:[];return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs(qe,{htmlFor:f.id,className:"font-medium text-sm sm:w-48 sm:text-right sm:flex-shrink-0 flex items-center gap-1 justify-start sm:justify-end",children:[$&&e.jsx(Se,{variant:"secondary",className:"text-xs h-4 px-1 mr-1",children:$}),e.jsx("span",{className:"flex-1 sm:flex-initial",children:f.name}),H&&e.jsx(Se,{variant:"default",className:"text-xs h-4 px-1 text-red-100",children:"*"}),R&&e.jsx(Se,{variant:"default",className:"text-xs h-4 px-1 bg-green-500 ml-1",children:"auto"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Ut,{column:f,value:_[f.id],onChange:Oe,dropdownOptions:he,isAutoFilled:R,disabled:j}),R&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Automatically filled from parent record: ",k]})]})]},f.id)})}),e.jsxs(at,{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx(ee,{variant:"outline",onClick:De,disabled:j,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(ee,{onClick:Ve,disabled:j,className:"w-full sm:w-auto",children:j?"Creating...":"Create Record"}),e.jsx(ee,{onClick:Ue,disabled:j,variant:"secondary",className:"w-full sm:w-auto",children:j?"Creating...":"Create & Add More Details"})]})]});return e.jsx(kt,{open:a,onOpenChange:r,children:e.jsx(Et,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",onInteractOutside:f=>f.preventDefault(),children:D?Te():s.length>0?it():ze()})})},kr=({isOpen:a,onClose:r,onConfirm:n,record:i,confirmInput:c,onConfirmInputChange:p,isDeleting:h=!1})=>{const S=c.trim()===(i==null?void 0:i.us_id);return e.jsx(kt,{open:a,onOpenChange:r,children:e.jsxs(Et,{className:"max-w-md",children:[e.jsxs(st,{children:[e.jsxs(rt,{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"h-5 w-5 text-red-500"}),"Confirm Deletion"]}),e.jsxs(ht,{children:["This action cannot be undone. Please type the ",e.jsx("strong",{children:"us_id"})," to confirm deletion."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[i&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded border",children:[e.jsx("p",{className:"text-sm font-medium",children:"Record to delete:"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",i.id]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["US_ID: ",e.jsx("span",{className:"font-mono bg-yellow-100 px-1 rounded",children:i.us_id})]})]}),e.jsxs("div",{children:[e.jsx(qe,{htmlFor:"confirm-us-id",className:"text-sm font-medium",children:"Enter us_id to confirm:"}),e.jsx(Fe,{id:"confirm-us-id",type:"text",placeholder:"Type us_id here",value:c,onChange:C=>p(C.target.value),className:"mt-1",autoFocus:!0,disabled:h})]})]}),e.jsxs(at,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(ee,{variant:"outline",onClick:r,disabled:h,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(ee,{variant:"destructive",onClick:n,disabled:h||!S,className:"w-full sm:w-auto",children:h?"Deleting...":"Delete Record"})]})]})})};function Er({className:a,...r}){return e.jsx("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:Xe("mx-auto flex w-full justify-center",a),...r})}function Rr({className:a,...r}){return e.jsx("ul",{"data-slot":"pagination-content",className:Xe("flex flex-row items-center gap-1",a),...r})}function Ge({...a}){return e.jsx("li",{"data-slot":"pagination-item",...a})}function nt({className:a,isActive:r,size:n="icon",...i}){return e.jsx("a",{"aria-current":r?"page":void 0,"data-slot":"pagination-link","data-active":r,className:Xe(Os({variant:r?"outline":"ghost",size:n}),a),...i})}function Dr({className:a,...r}){return e.jsxs(nt,{"aria-label":"Go to previous page",size:"default",className:Xe("gap-1 px-2.5 sm:pl-2.5",a),...r,children:[e.jsx(Bs,{}),e.jsx("span",{className:"hidden sm:block",children:"Previous"})]})}function Tr({className:a,...r}){return e.jsxs(nt,{"aria-label":"Go to next page",size:"default",className:Xe("gap-1 px-2.5 sm:pr-2.5",a),...r,children:[e.jsx("span",{className:"hidden sm:block",children:"Next"}),e.jsx(As,{})]})}function Ir(a=640){const[r,n]=l.useState(typeof window<"u"?window.innerWidth<a:!1);return l.useEffect(()=>{function i(){n(window.innerWidth<a)}return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[a]),r}function Or({currentPage:a,setCurrentPage:r,totalPages:n,records:i=[],pageSize:c=10,totalRecords:p=0}){const S=Ir(640)?3:7,C=l.useMemo(()=>{if(n<=S)return[...Array(n)].map((E,u)=>u+1);const o=Math.floor(S/2);let g=Math.max(1,a-o),v=Math.min(n,a+o);a<=o?(g=1,v=S):a+o>=n&&(g=n-S+1,v=n);const P=[];for(let E=g;E<=v;E++)P.push(E);return P},[n,a,S]);return e.jsxs("div",{className:"flex items-center justify-between mt-4 w-full px-4",children:[e.jsxs("div",{className:"hidden sm:block text-sm text-slate-500",children:["Showing ",e.jsx("span",{className:"font-medium",children:Math.min(i.length,c)})," of"," ",e.jsx("span",{className:"font-medium",children:p})," records"]}),e.jsx("div",{className:"flex-1 flex justify-center sm:justify-end",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto sm:overflow-visible py-1",children:e.jsx(Er,{children:e.jsxs(Rr,{children:[e.jsx(Ge,{children:e.jsx(Dr,{href:"#",onClick:o=>{o.preventDefault(),a>1&&r(a-1)},className:a<=1?"pointer-events-none opacity-50":""})}),C[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{children:e.jsx(nt,{href:"#",onClick:o=>{o.preventDefault(),r(1)},isActive:a===1,children:"1"})}),e.jsx(Ge,{children:e.jsx("span",{className:"inline-flex items-center px-2",children:"â€¦"})})]}),C.map(o=>e.jsx(Ge,{children:e.jsx(nt,{href:"#",onClick:g=>{g.preventDefault(),r(o)},isActive:a===o,children:o})},o)),C[C.length-1]<n&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{children:e.jsx("span",{className:"inline-flex items-center px-2",children:"â€¦"})}),e.jsx(Ge,{children:e.jsx(nt,{href:"#",onClick:o=>{o.preventDefault(),r(n)},isActive:a===n,children:n})})]}),e.jsx(Ge,{children:e.jsx(Tr,{href:"#",onClick:o=>{o.preventDefault(),a<n&&r(a+1)},className:a>=n?"pointer-events-none opacity-50":""})})]})})})})]})}const Ar=({type:a="normal"})=>{const[r,n]=Jt(),i=wt(N=>N.user),c=l.useMemo(()=>({pa_id:r.get("pa_id"),us_id:r.get("us_id"),show:r.get("show"),status:r.get("status"),process_name:r.get("process_name")}),[r]),[p,h]=l.useState([]);l.useEffect(()=>{C()},[]);const S=i.schema_name,C=async()=>{const N=`https://click.wa.expert/api/data/getAllTables?schemaName=${S}`,{data:F}=await ye.get(N),Y=F.data.map(Z=>Z.title);h(Y)},{tableName1:o}=Fs(),g=l.useMemo(()=>({schemaName:i.schema_name,tableName:o,userId:i.id,userEmail:i.email}),[i.schema_name,o,i.id,i.email]),v=(i==null?void 0:i.owner_id)??(i==null?void 0:i.id),[P,E]=l.useState(!1),[u,m]=l.useState(null),[x,z]=l.useState("asc"),[re,D]=l.useState({counter:0,prefix:"",isActive:!1,recordId:null}),[q,te]=l.useState([]),[G,_]=l.useState(!1),[t,s]=l.useState(null),[d,b]=l.useState(""),[y,O]=l.useState(!1),[ue,_e]=l.useState(!1),[ie,U]=l.useState({tableName:"",paId:"",columns:[],metaData:[],dropdownSetup:{},columnOrder:{},formData:{},processSteps:[]}),{originalRecords:J,columns:k,metaData:xe,loading:M,refreshData:L,currentPage:j,pageSize:oe,paginationInfo:se,goToPage:pe,resetPagination:be}=ir(g,a,v),{columns:T,setColumns:V,toggleColumnVisibility:le,resetColumnVisibility:A,hideAllColumns:ce,visibleColumns:fe}=or(v,g.tableName,g.schemaName,k),{searchTerm:Q,setSearchTerm:K,statusFilter:B,priorityFilter:ke,filteredRecords:I,uniqueStatuses:ae,uniquePriorities:Ae,toggleStatusFilter:Pe,togglePriorityFilter:Ee,clearFilters:Me,hasActiveFilters:me}=lr(J),Re=l.useCallback(N=>{u===N?z(F=>F==="asc"?"desc":"asc"):(m(N),z("asc"))},[u]),Ce=l.useMemo(()=>u?[...I].sort((N,F)=>{const w=N[u],Y=F[u];if(w&&Y&&typeof w=="string"){const Z=Date.parse(w),ne=Date.parse(Y);if(!isNaN(Z)&&!isNaN(ne))return x==="asc"?Z-ne:ne-Z}return typeof w=="string"&&typeof Y=="string"?x==="asc"?w.localeCompare(Y):Y.localeCompare(w):x==="asc"?(w??0)-(Y??0):(Y??0)-(w??0)}):I,[I,u,x]),Oe=se.totalPages,Ve=se.totalRecords,{formData:Ue,isSubmitting:De,isOpen:Te,handleFieldChange:ze,submitForm:He,openForm:it,closeForm:f}=cr(g,a,L),{dropdownSetup:$,columnOrder:R,setupExists:H}=dr(v,g.tableName);l.useEffect(()=>{const N=async()=>{try{const F=`https://click.wa.expert/api/reference/setup/check?owner_id=${v}&product_name=${g.tableName}`,{data:w}=await ye.get(F);w.exists&&w.setup&&w.setup.process_steps?te(w.setup.process_steps):te([])}catch{te([])}};v&&g.tableName&&N()},[v,g.tableName]);const he=async N=>{try{const F={schemaName:i.schema_name,tableName:N,userId:i.id,userEmail:i.email},w=await ye.post("https://click.wa.expert/api/data/getAllData",F),Y=w.data.data||[],Z=w.data.columns||[];let ne=[];if(Y.length>0){const Tt=Y[0];ne=Object.keys(Tt).map(et=>({id:et,name:Ie(et),accessor:et,sortable:!0,visible:!0,type:X(Tt[et],et)}))}const Qe=`https://click.wa.expert/api/reference/setup/check?owner_id=${v}&product_name=${N}`,ve=await ye.get(Qe);let $e={},Ze={},Dt=[];return ve.data.exists&&ve.data.setup&&($e=ve.data.setup.mapping||{},Ze=ve.data.setup.columnOrder||{},Dt=ve.data.setup.process_steps||[]),{columns:ne,metaData:Z,dropdownSetup:$e,columnOrder:Ze,processName:null,processSteps:Dt}}catch(F){throw F}},Ie=N=>N.split("_").map(F=>F.charAt(0).toUpperCase()+F.slice(1)).join(" "),X=(N,F)=>{const w=F.toLowerCase();return w.includes("email")?"email":w.includes("phone")?"tel":w.includes("url")||w.includes("link")?"url":w==="status"?"select-status":w==="priority"?"select-priority":w.includes("description")||w.includes("notes")||w.includes("comment")?"textarea":w.includes("date")||w.includes("created")||w.includes("updated")?"date":typeof N=="number"?"number":typeof N=="boolean"?"checkbox":N&&N.length>100?"textarea":"text"},ge=async(N,F)=>{try{const w=await he(N),Y={pa_id:F,us_id:Nt()};w.columns.some(ne=>ne.id==="status"||ne.id.toLowerCase()==="status")&&w.processSteps&&w.processSteps.length>0&&(Y.status=w.processSteps[0]),w.columns.forEach(ne=>{Y[ne.id]||(Y[ne.id]="")}),U({tableName:N,paId:F,columns:w.columns,metaData:w.metaData,dropdownSetup:w.dropdownSetup,columnOrder:w.columnOrder,formData:Y,processSteps:w.processSteps||[]}),_e(!0),W.success("Form loaded successfully")}catch(w){throw W.error("Failed to load form"),w}},Ne=(N,F)=>{U(w=>({...w,formData:{...w.formData,[N]:F}}))},ot=async()=>{var N,F;try{const w={};Object.entries(ie.formData).forEach(([Z,ne])=>{if(ne!==""&&ne!==null&&ne!==void 0){const Qe=ie.metaData.find(ve=>ve.column_name===Z);if(Qe){const ve=Qe.data_type.toLowerCase();if(ve.includes("int")||ve.includes("serial")){const $e=parseInt(ne,10);isNaN($e)||(w[Z]=$e)}else if(ve.includes("numeric")||ve.includes("decimal")||ve.includes("float")){const $e=parseFloat(ne);isNaN($e)||(w[Z]=$e)}else ve.includes("bool")?w[Z]=ne===!0||ne==="true"||ne==="1":w[Z]=ne}else w[Z]=ne}}),w.us_id&&w.pa_id&&(w.us_id=`${w.pa_id} -S- ${w.us_id}`);const Y={schemaName:i.schema_name,tableName:ie.tableName};await Le.createRecord(Y,w),W.success("Split record created successfully"),_e(!1),U({tableName:"",paId:"",columns:[],metaData:[],dropdownSetup:{},columnOrder:{},formData:{},processSteps:[]}),L()}catch(w){throw W.error("Failed to create split record: "+(((F=(N=w.response)==null?void 0:N.data)==null?void 0:F.details)||w.message)),w}},Je=()=>{_e(!1),U({tableName:"",paId:"",columns:[],metaData:[],dropdownSetup:{},columnOrder:{},formData:{},processSteps:[]})};l.useEffect(()=>{k.length>0&&T.length===0&&V(k)},[k]),l.useEffect(()=>{const N=r.get("search");N&&K(decodeURIComponent(N))},[r,K]),l.useEffect(()=>{c.show==="true"&&T.length>0&&Rt()},[c.show,T]);const lt=l.useCallback(N=>{D(N)},[]),We=l.useCallback(()=>{L(),Me(),be(),W.success("Data refreshed")},[L,Me,be]),us=l.useCallback(N=>{K(N.target.value),be()},[K,be]),hs=l.useCallback(()=>{if(!I.length){W.error("No records to export");return}try{const N=I.map(ve=>{const $e={};return fe.forEach(Ze=>{$e[Ze.name]=ve[Ze.id]}),$e}),F=Zs.unparse(N,{quotes:!0,quoteChar:'"',delimiter:",",header:!0}),w=new Blob([F],{type:"text/csv;charset=utf-8;"}),Y=URL.createObjectURL(w),Z=document.createElement("a"),ne=new Date().toISOString().slice(0,10),Qe=`${g.tableName}_export_${ne}.csv`;Z.setAttribute("href",Y),Z.setAttribute("download",Qe),Z.style.display="none",document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(Y),W.success(`Exported ${N.length} records to CSV`)}catch(N){de.error("Error exporting CSV:",N),W.error("Failed to export CSV")}},[I,fe,g.tableName]),Rt=l.useCallback(async()=>{const N={};if(T.forEach(F=>{c[F.id]?N[F.id]=c[F.id]:F.id==="us_id"?N[F.id]=re.isActive?`${re.prefix}${re.counter}`:Nt():F.id==="status"&&q.length>0?N[F.id]=q[0]:N[F.id]=""}),it(N),c.show==="true"){const F=new URLSearchParams(r);F.delete("show"),n(F,{replace:!0})}},[T,c,re,it,r,n,q]),fs=l.useCallback(async()=>{try{let N={};if(c.process_name){const F=`${c.process_name}_balance`,w=T.find(Y=>Y.id.toLowerCase().includes("quantity"));if(w){const Y=Ue[w.id];Y&&(N[F]=Y)}}if((c.status&&c.pa_id||c.process_name&&c.pa_id)&&(N.us_id=`${c.pa_id} -S- ${Ue.us_id}`),await He(N),re.isActive&&re.recordId)try{await Le.updateRecord({schemaName:"public",tableName:"counter_setup"},re.recordId,v,{counter:re.counter+1}),D(F=>({...F,counter:F.counter+1}))}catch(F){de.error("Counter increment failed:",F),W.warning("Record created but counter increment failed")}n({})}catch(N){de.error("Create record failed:",N)}},[Ue,T,c,re,He,v,n]),ps=l.useCallback(N=>{s(N),b(""),_(!0)},[]),ms=l.useCallback(async()=>{if(!t||d.trim()!==t.us_id){W.error("Entered us_id does not match");return}try{O(!0),await Le.deleteRecord(g,t.id),W.success("Record deleted successfully"),_(!1),s(null),b(""),L()}catch(N){de.error("Delete failed:",N),W.error("Failed to delete record")}finally{O(!1)}},[t,d,g,L]),gs=l.useCallback(async(N,F)=>{try{const w=J.find(Z=>Z.id===N),Y={};if(Object.entries(F).forEach(([Z,ne])=>{ne!==w[Z]&&Z!=="id"&&Z!=="pa_id"&&Z!=="us_id"&&(Y[Z]=ne)}),Object.keys(Y).length===0){W.warning("No changes to save");return}await Le.updateRecord(g,N,v,Y),W.success("Record updated successfully"),L()}catch(w){de.error("Update failed:",w),W.error("Failed to update record")}},[J,g,v,L]);return c.show==="true"?null:e.jsxs(Bt,{className:"tableCard shadow-sm border-slate-200 mx-[6rem]",children:[e.jsx(qt,{className:"pb-3",children:e.jsx(wr,{title:"All Records - "+g.tableName,description:"View and manage all database records",searchTerm:Q,onSearchChange:us,tableName:g.tableName,onCounterUpdate:lt,urlParams:c,dropdownSetupExists:H,columnOrderExists:Object.keys(R).length>0})}),e.jsxs(Ht,{children:[e.jsx("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(jr,{onRefresh:We,onAddRecord:Rt,onExportCSV:hs,onToggleEdit:()=>E(!P),editEnabled:P,canEdit:i.owner_id===null,isLoading:M,splitOptions:p,onSplitLoad:ge}),e.jsx(Sr,{uniqueStatuses:ae,uniquePriorities:Ae,statusFilter:B,priorityFilter:ke,onToggleStatus:Pe,onTogglePriority:Ee,onClearStatusFilter:()=>Pe([]),onClearPriorityFilter:()=>Ee([])}),e.jsx(Nr,{columns:T,onToggleColumn:le,onResetVisibility:A,onHideAll:ce})]})}),e.jsx(vr,{records:Ce,columns:T,loading:M,editEnabled:P,canDelete:i.owner_id===null,onSort:Re,onDeleteRecord:ps,onSaveRecord:gs,sortColumn:u,sortDirection:x,emptyMessage:me?"No records match filters":"No records found",onClearFilters:me?Me:null}),e.jsx(Or,{currentPage:j,setCurrentPage:pe,totalPages:Oe,records:Ce,pageSize:oe,totalRecords:Ve})]}),e.jsx(zt,{isOpen:Te,onClose:f,onSubmit:fs,formData:Ue,onFieldChange:ze,columns:T,metaData:xe,dropdownSetup:$,columnOrder:R,processName:c.process_name,isSubmitting:De,counterConfig:re,setCounterConfig:D,mode:"create",processSteps:q}),e.jsx(zt,{isOpen:ue,onClose:Je,onSubmit:ot,formData:ie.formData,onFieldChange:Ne,columns:ie.columns,metaData:ie.metaData,dropdownSetup:ie.dropdownSetup,columnOrder:ie.columnOrder,processName:null,isSubmitting:De,counterConfig:re,setCounterConfig:D,mode:"create",itsSplit:!0,processSteps:ie.processSteps||[]}),e.jsx(kr,{isOpen:G,onClose:()=>_(!1),onConfirm:ms,record:t,confirmInput:d,onConfirmInputChange:b,isDeleting:y})]})},Gr=a=>e.jsx(Xs,{children:e.jsx(Ar,{...a})});export{Gr as default};
