const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DynamicUpdateForm-Bw5iY8Wy.js","assets/index-BECPHSeM.js","assets/index-ChjFitzT.css","assets/RecordDetails-DehU3_bL.js","assets/alert-hpzouw7C.js","assets/RecordDetails-xoLY8ACE.css","assets/FixedUpdateForm-BwmhLTx4.css","assets/FixedUpdateForm-Cc96HowC.js","assets/WastageUpdateForm-C_O0Wgy8.js","assets/Filter-Ikn61SwZ.js","assets/checkbox-CraTRF2W.js","assets/index-DphnJHhj.js","assets/x-WtqlxTpi.js","assets/Filter-D9_QZeC6.css"])))=>i.map(i=>d[i]);
import{r as t,a as te,b as ae,c as p,j as a,B as z,I as le,al as re,ax as _}from"./index-BECPHSeM.js";/* empty css                       */import{S as ne}from"./sliders-horizontal-BJXosotJ.js";const M=t.lazy(()=>_(()=>import("./DynamicUpdateForm-Bw5iY8Wy.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),oe=t.lazy(()=>_(()=>import("./FixedUpdateForm-Cc96HowC.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),ce=t.lazy(()=>_(()=>import("./WastageUpdateForm-C_O0Wgy8.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),ie=t.lazy(()=>_(()=>import("./Filter-Ikn61SwZ.js"),__vite__mapDeps([9,1,2,10,11,12,13]))),de=new Set(["contact","team_member","vendor","schema_migrations","reminders"]),ue=300,g="https://click.wa.expert/api",me=()=>a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-12 bg-gray-200 rounded"}),a.jsx("div",{className:"h-12 bg-gray-200 rounded"}),a.jsx("div",{className:"h-12 bg-gray-200 rounded"})]}),fe=()=>{const[c,j]=t.useState(""),[u,A]=t.useState(!1),[F,V]=t.useState([]),[h,f]=t.useState(null),[i,v]=t.useState(null),[n,W]=t.useState("jobstatus"),[K,Y]=t.useState(!1),[x,D]=t.useState([]),[d,C]=t.useState([]),[I,N]=t.useState(null),[w,y]=t.useState([]),[L,q]=t.useState({}),[R,E]=t.useState([]),[O,b]=t.useState([]),[H,S]=t.useState(!1),r=te(e=>e.user),P=ae(),o=(r==null?void 0:r.schema_name)||"default_schema",k=(r==null?void 0:r.owner_id)??(r==null?void 0:r.id),G=t.useMemo(()=>F.filter(e=>{const s=(e==null?void 0:e.title)||e;return s&&!de.has(s)}),[F]),B=t.useCallback(async(e,s)=>{const{data:l}=await p.post(`${g}/data/getRecordByTarget`,{schemaName:o,tableName:n,targetColumn:e,targetValue:s,userId:r.id,userEmail:r.email});return l},[o,n]),$=t.useCallback(async e=>{const{data:s}=await p.post(`${g}/data/getRecordByTargetAll`,{schemaName:o,tableName:n,targetColumn:"pa_id",targetValue:e,userId:r.id,userEmail:r.email});return Array.isArray(s)?s:[s]},[o,n,r.id,r.email]),T=t.useCallback(async()=>{if(!c.trim()){f("Please enter an ID");return}A(!0),f(null),v(null),E([]);try{const[e,s]=await Promise.allSettled([B("us_id",c),$(c)]);if(e.status==="fulfilled"){const l=e.value;v(l);const m=Array.isArray(l)&&l.length>0?Object.keys(l[0]):l&&typeof l=="object"?Object.keys(l):[];m.length>0&&(D(m),C(m))}else throw new Error("Failed to fetch parent record");s.status==="fulfilled"&&E(s.value)}catch(e){f(e.message||"Failed to fetch data")}finally{A(!1)}},[c,B,$]);t.useEffect(()=>{(async()=>{try{const{data:s}=await p.get(`${g}/data/getAllTables?schemaName=${o}`);V(s.data||[]),P(re({tables:s.data||[]}))}catch{}})()},[o,P]),t.useEffect(()=>{if(!c.trim()){b([]),S(!1);return}const e=new AbortController,s=setTimeout(async()=>{try{const{data:l}=await p.post(`${g}/additional/search`,{schemaName:o,tableName:n,query:c,userId:r.id,userEmail:r.email},{signal:e.signal}),m=(l==null?void 0:l.data)||[];b(m),S(m.length>0)}catch(l){l.name!=="CanceledError"&&l.name}},ue);return()=>{clearTimeout(s),e.abort()}},[c,n,o]),t.useEffect(()=>{n&&k&&(async()=>{try{const{data:s}=await p.get(`${g}/reference/setup/check?owner_id=${k}&product_name=${n}`);s.exists&&s.setup?(N(s.setup),y(s.setup.filter_form_columns||[]),q(s.setup.process_type_mapping||{})):(N(null),y(d.length>0?d:x))}catch{N(null),y(d.length>0?d:x)}})()},[k,n]);const J=t.useCallback(e=>{e.key==="Enter"&&T()},[T]),Q=t.useCallback(e=>{const s=e.target.value;W(s),D([]),C([]),v(null),E([]),j(""),b([]),S(!1)},[]),X=t.useCallback(e=>{j(e),S(!1),b([])},[]),Z=t.useCallback(e=>{j(e.target.value),h&&f(null)},[h]),ee=t.useCallback(e=>{C(e)},[]),U=t.useCallback(()=>{Y(e=>!e)},[]),se=t.useMemo(()=>{if(!i)return null;const e=i==null?void 0:i.status,s=L[e],l={data:i,loading:u,visibleColumns:d,setupData:I,tableName:n,schemaName:o,selectedColumns:w};switch(s){case"Dynamic":return a.jsx(M,{...l});case"Fixed":return a.jsx(oe,{...l});case"Wastage":return a.jsx(ce,{...l,childRecords:R});default:return a.jsx(M,{...l})}},[i,u,d,I,n,o,w,L,R]);return a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"form-group-1",children:[a.jsxs("div",{className:"top-section",children:[a.jsx("h2",{className:"heading",children:"Update Status"}),a.jsxs(z,{className:"filter-section",onClick:U,disabled:!i||x.length===0,children:[a.jsx("p",{children:"Filter"}),a.jsx(ne,{className:"icon-md"})]})]}),a.jsxs("div",{className:"select-wrapper",children:[a.jsxs("select",{id:"table-select",value:n,onChange:Q,className:`select ${h&&!n?"select-error":""}`,disabled:u,children:[a.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"- Select Table -"}),G.map(e=>{const s=(e==null?void 0:e.title)||e;return a.jsx("option",{value:s,className:"option",children:s.charAt(0).toUpperCase()+s.slice(1).replace(/_/g," ")},s)})]}),a.jsx("div",{className:"select-arrow",children:a.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:a.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),a.jsxs("div",{className:"relative w-full",children:[a.jsx(le,{type:"text",value:c,onChange:Z,onKeyDown:J,className:"bg-gray-50 text-gray-700 mb-2",placeholder:"Enter the ID","aria-label":"Search ID",disabled:u,autoComplete:"off"}),H&&O.length>0&&a.jsx("ul",{className:"absolute z-50 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-48 overflow-y-auto shadow-md",children:O.map((e,s)=>a.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 text-sm",onClick:()=>X(e.us_id),children:e.us_id},e.us_id||s))})]}),a.jsx(z,{className:"button",onClick:T,"aria-label":"Search for record",disabled:u||!n||!c.trim(),children:u?"Searching...":"Search"}),h&&a.jsx("div",{className:"error-message",style:{color:"red",marginTop:"0.5rem"},children:h})]}),a.jsx("div",{className:"form-group-2",children:a.jsx(t.Suspense,{fallback:a.jsx(me,{}),children:se})}),a.jsx(t.Suspense,{fallback:a.jsx("div",{children:"Loading filter..."}),children:a.jsx(ie,{isOpen:K,onClose:U,columns:x,visibleColumns:d,onApplyFilter:ee,tableName:n,setSelectedColumns:y,selectedColumns:w})})]})};export{fe as default};
