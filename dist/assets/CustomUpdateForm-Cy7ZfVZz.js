const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DynamicUpdateForm-tQc0ZIP5.js","assets/index-DSK3H15k.js","assets/index-C7gx9t1_.css","assets/RecordDetails-BQoKt83C.js","assets/alert-DRnNDHab.js","assets/RecordDetails-xoLY8ACE.css","assets/FixedUpdateForm-BwmhLTx4.css","assets/FixedUpdateForm-Pbr-0c-7.js","assets/WastageUpdateForm-CDAtuFp1.js","assets/Filter-C3ahdsq-.js","assets/checkbox-DzHwqFVk.js","assets/index-DZA9Smda.js","assets/Filter-D9_QZeC6.css"])))=>i.map(i=>d[i]);
import{r as t,a as se,b as ae,c as g,j as a,B as W,I as re,au as le,aI as j}from"./index-DSK3H15k.js";/* empty css                       */import{S as ne}from"./sliders-horizontal-BZPpNrYo.js";const Y=t.lazy(()=>j(()=>import("./DynamicUpdateForm-tQc0ZIP5.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),oe=t.lazy(()=>j(()=>import("./FixedUpdateForm-Pbr-0c-7.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),ce=t.lazy(()=>j(()=>import("./WastageUpdateForm-CDAtuFp1.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),ie=t.lazy(()=>j(()=>import("./Filter-C3ahdsq-.js"),__vite__mapDeps([9,1,2,10,11,12]))),ue=new Set(["contact","team_member","vendor","schema_migrations","reminders"]),de=250,f="https://click.wa.expert/api",me=()=>a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-12 bg-gray-200 rounded"}),a.jsx("div",{className:"h-12 bg-gray-200 rounded"}),a.jsx("div",{className:"h-12 bg-gray-200 rounded"})]}),fe=()=>{const[i,C]=t.useState(""),[m,D]=t.useState(!1),[R,q]=t.useState([]),[b,y]=t.useState(null),[d,E]=t.useState(null),[n,N]=t.useState("jobstatus"),[H,G]=t.useState(!1),[p,O]=t.useState([]),[u,v]=t.useState([]),[P,w]=t.useState(null),[T,S]=t.useState([]),[L,J]=t.useState({}),[B,k]=t.useState([]),[$,_]=t.useState([]),[A,h]=t.useState(!1),x=t.useRef(!1),r=se(e=>e.user),U=ae(),c=(r==null?void 0:r.schema_name)||"default_schema",F=(r==null?void 0:r.owner_id)??(r==null?void 0:r.id);t.useMemo(()=>R.filter(e=>{const s=(e==null?void 0:e.title)||e;return s&&!ue.has(s)}),[R]);const z=t.useCallback(async(e,s)=>{const{data:l}=await g.post(`${f}/data/getRecordByTarget`,{schemaName:c,tableName:n,targetColumn:e,targetValue:s,userId:r.id,userEmail:r.email});return l},[c,n,r.id,r.email]),M=t.useCallback(async e=>{const{data:s}=await g.post(`${f}/data/getRecordByTargetAll`,{schemaName:c,tableName:n,targetColumn:"pa_id",targetValue:e,userId:r.id,userEmail:r.email});return Array.isArray(s)?s:[s]},[c,n,r.id,r.email]),I=t.useCallback(async()=>{if(!i.trim()){y("Please enter an ID");return}D(!0),y(null),E(null),k([]);try{const[e,s]=await Promise.allSettled([z("us_id",i),M(i)]);if(e.status==="fulfilled"){const l=e.value;E(l);const o=Array.isArray(l)&&l.length>0?Object.keys(l[0]):l&&typeof l=="object"?Object.keys(l):[];o.length>0&&(O(o),v(o))}else throw new Error("Failed to fetch parent record");s.status==="fulfilled"&&k(s.value)}catch(e){y(e.message||"Failed to fetch data")}finally{D(!1)}},[i,z,M]);t.useEffect(()=>{(async()=>{try{const{data:s}=await g.get(`${f}/data/getAllTables?schemaName=${c}`);q(s.data||[]),U(le({tables:s.data||[]}))}catch{}})()},[c,U]),t.useEffect(()=>{if(!i.trim()){_([]),h(!1);return}if(x.current||!A)return;const e=new AbortController,s=setTimeout(async()=>{var l;try{const{data:o}=await g.post(`${f}/additional/search`,{schemaName:c,tableName:n,query:i,userId:r.id,userEmail:r.email},{signal:e.signal}),K=(o==null?void 0:o.data)||[];_(K),(l=o.data)!=null&&l.table_name&&N(o.data.table_name),h(K.length>0)}catch(o){o.name!=="CanceledError"&&o.name}},de);return()=>{clearTimeout(s),e.abort()}},[i,n,c,A,r.id,r.email]),t.useEffect(()=>{n&&F&&(async()=>{try{const{data:s}=await g.get(`${f}/reference/setup/check?owner_id=${F}&product_name=${n}`);s.exists&&s.setup?(w(s.setup),S(s.setup.filter_form_columns||[]),J(s.setup.process_type_mapping||{})):(w(null),S(u.length>0?u:p))}catch{w(null),S(u.length>0?u:p)}})()},[F,n,u,p]);const Q=t.useCallback(e=>{e.key==="Enter"&&I()},[I]);t.useCallback(e=>{const s=e.target.value;N(s),O([]),v([]),E(null),k([]),C(""),_([]),h(!1),x.current=!1},[]);const X=t.useCallback((e,s)=>{x.current=!0,C(e),N(s),_([]),h(!1)},[]),Z=t.useCallback(e=>{x.current=!1,C(e.target.value),h(!0),b&&y(null)},[b]),ee=t.useCallback(e=>{v(e)},[]),V=t.useCallback(()=>{G(e=>!e)},[]),te=t.useMemo(()=>{if(!d)return null;const e=d==null?void 0:d.status,s=L[e],l={data:d,loading:m,visibleColumns:u,setupData:P,tableName:n,schemaName:c,selectedColumns:T};switch(s){case"Dynamic":return a.jsx(Y,{...l});case"Fixed":return a.jsx(oe,{...l});case"Wastage":return a.jsx(ce,{...l,childRecords:B});default:return a.jsx(Y,{...l})}},[d,m,u,P,n,c,T,L,B]);return a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"form-group-1",children:[a.jsxs("div",{className:"top-section",children:[a.jsx("h2",{className:"heading",children:"Update Status"}),a.jsxs(W,{className:"filter-section",onClick:V,disabled:!d||p.length===0,children:[a.jsx("p",{children:"Filter"}),a.jsx(ne,{className:"icon-md"})]})]}),a.jsxs("div",{className:"relative w-full",children:[a.jsx(re,{type:"text",value:i,onChange:Z,onKeyDown:Q,className:"bg-gray-50 text-gray-700 mb-2",placeholder:"Enter the ID","aria-label":"Search ID",disabled:m,autoComplete:"off"}),A&&$.length>0&&a.jsx("ul",{className:"absolute z-50 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-48 overflow-y-auto shadow-md",children:$.map((e,s)=>a.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 text-sm",onClick:()=>X(e.us_id,e.table_name),children:e.us_id},e.us_id||s))})]}),a.jsx(W,{className:"button",onClick:I,"aria-label":"Search for record",disabled:m||!n||!i.trim(),children:m?"Searching...":"Search"}),b&&a.jsx("div",{className:"error-message",style:{color:"red",marginTop:"0.5rem"},children:b})]}),a.jsx("div",{className:"form-group-2",children:a.jsx(t.Suspense,{fallback:a.jsx(me,{}),children:te})}),a.jsx(t.Suspense,{fallback:a.jsx("div",{children:"Loading filter..."}),children:a.jsx(ie,{isOpen:H,onClose:V,columns:p,visibleColumns:u,onApplyFilter:ee,tableName:n,setSelectedColumns:S,selectedColumns:T})})]})};export{fe as default};
