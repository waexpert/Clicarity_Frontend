const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DynamicUpdateForm-CVvscg89.js","assets/index-C8rB76ST.js","assets/index-ChjFitzT.css","assets/RecordDetails-BkP31MSR.js","assets/alert-K6zVH5tD.js","assets/RecordDetails-xoLY8ACE.css","assets/FixedUpdateForm-BwmhLTx4.css","assets/FixedUpdateForm-CR_9j-l_.js","assets/WastageUpdateForm-C550kgQT.js","assets/Filter-CPMpNWYq.js","assets/checkbox-CxGRb7L9.js","assets/index-D0w04Fa-.js","assets/x-CD_kuMe-.js","assets/Filter-D9_QZeC6.css"])))=>i.map(i=>d[i]);
import{r as t,a as ae,c as le,b as p,j as a,B as M,I as re,ak as ne,aq as _}from"./index-C8rB76ST.js";/* empty css                       */import{S as oe}from"./sliders-horizontal-DKAlJ4op.js";const V=t.lazy(()=>_(()=>import("./DynamicUpdateForm-CVvscg89.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),ce=t.lazy(()=>_(()=>import("./FixedUpdateForm-CR_9j-l_.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),ie=t.lazy(()=>_(()=>import("./WastageUpdateForm-C550kgQT.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),de=t.lazy(()=>_(()=>import("./Filter-CPMpNWYq.js"),__vite__mapDeps([9,1,2,10,11,12,13]))),ue=new Set(["contact","team_member","vendor","schema_migrations","reminders"]),me=300,g="https://click.wa.expert/api",he=()=>a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-12 bg-gray-200 rounded"}),a.jsx("div",{className:"h-12 bg-gray-200 rounded"}),a.jsx("div",{className:"h-12 bg-gray-200 rounded"})]}),ye=()=>{const[c,j]=t.useState(""),[m,A]=t.useState(!1),[F,W]=t.useState([]),[h,f]=t.useState(null),[d,v]=t.useState(null),[r,q]=t.useState("jobstatus"),[K,Y]=t.useState(!1),[y,D]=t.useState([]),[u,C]=t.useState([]),[I,N]=t.useState(null),[w,x]=t.useState([]),[L,H]=t.useState({}),[R,k]=t.useState([]),[$,b]=t.useState([]),[G,S]=t.useState(!1),n=ae(e=>e.user),O=le(),o=(n==null?void 0:n.schema_name)||"default_schema",E=(n==null?void 0:n.owner_id)??(n==null?void 0:n.id),J=t.useMemo(()=>F.filter(e=>{const s=(e==null?void 0:e.title)||e;return s&&!ue.has(s)}),[F]),P=t.useCallback(async(e,s)=>{const{data:l}=await p.post(`${g}/data/getRecordByTarget`,{schemaName:o,tableName:r,targetColumn:e,targetValue:s});return l},[o,r]),B=t.useCallback(async e=>{const{data:s}=await p.post(`${g}/data/getRecordByTargetAll`,{schemaName:o,tableName:r,targetColumn:"pa_id",targetValue:e,userId:n.id,userEmail:n.email});return Array.isArray(s)?s:[s]},[o,r,n.id,n.email]),T=t.useCallback(async()=>{if(!c.trim()){f("Please enter an ID");return}A(!0),f(null),v(null),k([]);try{const[e,s]=await Promise.allSettled([P("us_id",c),B(c)]);if(e.status==="fulfilled"){const l=e.value;v(l);const i=Array.isArray(l)&&l.length>0?Object.keys(l[0]):l&&typeof l=="object"?Object.keys(l):[];i.length>0&&(D(i),C(i))}else throw new Error("Failed to fetch parent record");s.status==="fulfilled"&&k(s.value)}catch(e){f(e.message||"Failed to fetch data")}finally{A(!1)}},[c,P,B]);t.useEffect(()=>{(async()=>{try{const{data:s}=await p.get(`${g}/data/getAllTables?schemaName=${o}`);W(s.data||[]),O(ne({tables:s.data||[]}))}catch{}})()},[o,O]),t.useEffect(()=>{if(!c.trim()){b([]),S(!1);return}const e=new AbortController,s=setTimeout(async()=>{var l;try{const{data:i}=await p.get(`${g}/additional/search?schemaName=${o}&tableName=${r}&query=${c}`,{signal:e.signal}),z=((l=i==null?void 0:i.data)==null?void 0:l.rows)||[];b(z),S(z.length>0)}catch(i){i.name}},me);return()=>{clearTimeout(s),e.abort()}},[c,r,o]),t.useEffect(()=>{r&&E&&(async()=>{try{const{data:s}=await p.get(`${g}/reference/setup/check?owner_id=${E}&product_name=${r}`);s.exists&&s.setup?(N(s.setup),x(s.setup.filter_form_columns||[]),H(s.setup.process_type_mapping||{})):(N(null),x(u.length>0?u:y))}catch{N(null),x(u.length>0?u:y)}})()},[E,r]);const Q=t.useCallback(e=>{e.key==="Enter"&&T()},[T]),X=t.useCallback(e=>{const s=e.target.value;q(s),D([]),C([]),v(null),k([]),j(""),b([]),S(!1)},[]),Z=t.useCallback(e=>{j(e),S(!1),b([])},[]),ee=t.useCallback(e=>{j(e.target.value),h&&f(null)},[h]),se=t.useCallback(e=>{C(e)},[]),U=t.useCallback(()=>{Y(e=>!e)},[]),te=t.useMemo(()=>{if(!d)return null;const e=d==null?void 0:d.status,s=L[e],l={data:d,loading:m,visibleColumns:u,setupData:I,tableName:r,schemaName:o,selectedColumns:w};switch(s){case"Dynamic":return a.jsx(V,{...l});case"Fixed":return a.jsx(ce,{...l});case"Wastage":return a.jsx(ie,{...l,childRecords:R});default:return a.jsx(V,{...l})}},[d,m,u,I,r,o,w,L,R]);return a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"form-group-1",children:[a.jsxs("div",{className:"top-section",children:[a.jsx("h2",{className:"heading",children:"Update Status"}),a.jsxs(M,{className:"filter-section",onClick:U,disabled:!d||y.length===0,children:[a.jsx("p",{children:"Filter"}),a.jsx(oe,{className:"icon-md"})]})]}),a.jsxs("div",{className:"select-wrapper",children:[a.jsxs("select",{id:"table-select",value:r,onChange:X,className:`select ${h&&!r?"select-error":""}`,disabled:m,children:[a.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"- Select Table -"}),J.map(e=>{const s=(e==null?void 0:e.title)||e;return a.jsx("option",{value:s,className:"option",children:s.charAt(0).toUpperCase()+s.slice(1).replace(/_/g," ")},s)})]}),a.jsx("div",{className:"select-arrow",children:a.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:a.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),a.jsxs("div",{className:"relative w-full",children:[a.jsx(re,{type:"text",value:c,onChange:ee,onKeyDown:Q,className:"bg-gray-50 text-gray-700 mb-2",placeholder:"Enter the ID","aria-label":"Search ID",disabled:m,autoComplete:"off"}),G&&$.length>0&&a.jsx("ul",{className:"absolute z-50 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-48 overflow-y-auto shadow-md",children:$.map((e,s)=>a.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 text-sm",onClick:()=>Z(e.us_id),children:e.us_id},e.us_id||s))})]}),a.jsx(M,{className:"button",onClick:T,"aria-label":"Search for record",disabled:m||!r||!c.trim(),children:m?"Searching...":"Search"}),h&&a.jsx("div",{className:"error-message",style:{color:"red",marginTop:"0.5rem"},children:h})]}),a.jsx("div",{className:"form-group-2",children:a.jsx(t.Suspense,{fallback:a.jsx(he,{}),children:te})}),a.jsx(t.Suspense,{fallback:a.jsx("div",{children:"Loading filter..."}),children:a.jsx(de,{isOpen:K,onClose:U,columns:y,visibleColumns:u,onApplyFilter:se,tableName:r,setSelectedColumns:x,selectedColumns:w})})]})};export{ye as default};
