const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WastageUpdateForm-C_O0Wgy8.js","assets/index-BECPHSeM.js","assets/index-ChjFitzT.css","assets/RecordDetails-DehU3_bL.js","assets/alert-hpzouw7C.js","assets/RecordDetails-xoLY8ACE.css","assets/FixedUpdateForm-BwmhLTx4.css"])))=>i.map(i=>d[i]);
import{r as c,a as ie,b as de,u as ue,aB as he,c as M,j as s,B as b,ax as pe}from"./index-BECPHSeM.js";import{R as me}from"./RecordDetails-DehU3_bL.js";import ge from"./Filter-Ikn61SwZ.js";/* empty css                       */import{S as xe}from"./sliders-horizontal-BJXosotJ.js";import{X as W}from"./x-WtqlxTpi.js";import"./alert-hpzouw7C.js";import"./checkbox-CraTRF2W.js";import"./index-DphnJHhj.js";const fe=c.lazy(()=>pe(()=>import("./WastageUpdateForm-C_O0Wgy8.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),$e=()=>{const[n,L]=c.useState("jobstatus"),[_,g]=c.useState(null),[z,H]=c.useState([]),[p,O]=c.useState(!1),[C,$]=c.useState({}),[d,E]=c.useState(""),[J,k]=c.useState([]),[x,v]=c.useState([]),[r,f]=c.useState(null),[i,j]=c.useState([]),[V,I]=c.useState({}),[G,N]=c.useState([]),[X,F]=c.useState(!1),[R,q]=c.useState([]),[l,T]=c.useState([]),o=ie(e=>e.user);de();const S=(o==null?void 0:o.schema_name)||"default_schema",B=ue(),K=["contact","team_member","vendor","schema_migrations","reminders"],Q=new Set(K),[Y]=he(),A=Y.get("search"),D=o.owner_id===null?o.id:o.owner_id;c.useEffect(()=>{Z(),A&&L(A)},[A]),c.useEffect(()=>{const e=async()=>{try{const t=`https://click.wa.expert/api/reference/setup/check?owner_id=${D}&product_name=${n}`,{data:a}=await M.get(t);if(a.exists&&a.setup){I(a.setup),j(a.setup.filter_form_columns||[]),$(a.setup.process_type_mapping||{});const u=(a.setup.process_steps||[]).filter(h=>h&&(h.title||typeof h=="string"));k(u)}else j([]),k([]),$({})}catch{k([]),$({})}};n&&(o!=null&&o.id)&&e()},[o==null?void 0:o.id,n,D]);const Z=async()=>{try{const e=`https://click.wa.expert/api/data/getAllTables?schemaName=${S}`,{data:t}=await M.get(e);H(t.data||[])}catch{g("Failed to fetch tables")}},ee=async()=>{if(!n){g("Please select a table");return}if(!d){g("Please select a process");return}O(!0),g(null),v([]),f(null);try{const e="https://click.wa.expert/api",t=C[d],m=(t==null?void 0:t.toLowerCase())==="wastage"?`${d}_balance > 0 AND NOT (us_id ~ '^[0-9]+$' AND LENGTH(us_id::text) >= 10)`:`status = '${d}' AND NOT (us_id ~ '^[0-9]+$' AND LENGTH(us_id::text) >= 10)`,u=await fetch(`${e}/data/getRecordByCondition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:S,tableName:n,targetWithCondition:m.trim()})});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const h=await u.json(),w=Array.isArray(h)?h:[h];if(v(w),w.length>0&&w[0]){const P=Object.keys(w[0]);q(P),i.length===0?(j(P),T(P)):T(i)}}catch(e){g(e.message||"Failed to fetch records")}finally{O(!1)}},se=async e=>{try{const a=await fetch("https://click.wa.expert/api/data/getRecordByTargetAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:S,tableName:n,targetColumn:"pa_id",targetValue:e})});if(a.ok){const m=await a.json(),u=Array.isArray(m)?m:[m];N(u)}}catch{N([])}},te=e=>{const t=e.target.value;L(t),E(""),v([]),f(null),N([])},ae=e=>{const t=e.target.value;E(t),v([]),f(null),N([])},re=async e=>{f(e),e.us_id&&await se(e.us_id)},U=()=>{f(null),N([])},ce=e=>{T(e),j(e)},y=d,ne=()=>{B(`/${n}/record?pa_id=${r==null?void 0:r.us_id}&status=${y}&show=true`)},le=c.useMemo(()=>{if(!C||!y)return"dynamic";const e=C[y];return e?e.toLowerCase():"dynamic"},[C,y]),oe=c.useMemo(()=>{if(!r)return r;const e=l.length>0?l:i.length>0?i:Object.keys(r);return e.length===0?r:Object.keys(r).filter(t=>e.includes(t)).reduce((t,a)=>(t[a]=r[a],t),{})},[r,i,l]);return s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"form-group-1",children:[s.jsxs("div",{className:"top-section",children:[s.jsx("h2",{className:"heading",children:"Check Process Status"}),s.jsxs(b,{className:"filter-section",onClick:()=>F(!0),disabled:!r||R.length===0,children:[s.jsx("p",{children:"Filter"}),s.jsx(xe,{className:"icon-md"})]})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"table-select",value:n||"",onChange:te,className:`select ${_&&!n?"select-error":""}`,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Table"}),z.filter(e=>{const t=(e==null?void 0:e.title)||e;return!Q.has(t)}).map((e,t)=>{const a=(e==null?void 0:e.title)||e;return a?s.jsx("option",{value:a,className:"option",children:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ")},`table-${a}-${t}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"process-name",value:d||"",onChange:ae,className:`select ${_&&!d?"select-error":""}`,disabled:!n,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Process"}),J.map((e,t)=>{const a=(e==null?void 0:e.title)||e;return a?s.jsx("option",{value:a,className:"option",children:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ")},`process-${a}-${t}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsx(b,{className:`button ${p?"loading":""}`,onClick:ee,"aria-label":"Search for process status",disabled:p||!n||!d,children:p?"Searching...":"Search"}),_&&s.jsx("div",{className:"error-message",children:_})]}),x.length>0&&s.jsxs("div",{className:"records-section",children:[s.jsxs("h3",{className:"heading",children:[x.length," Record",x.length!==1?"s":""," Found"]}),s.jsx("div",{className:"records-grid",children:x.map((e,t)=>s.jsx(b,{onClick:()=>re(e),className:`record-button ${(r==null?void 0:r.us_id)===e.us_id?"active":""}`,style:{whiteSpace:"normal",wordBreak:"break-word"},children:s.jsx("div",{children:e.us_id||`Record ${t+1}`})},e.us_id||`record-${t}`))})]}),r&&le==="wastage"?s.jsxs("div",{className:"",children:[s.jsx("button",{onClick:U,"aria-label":"Close details",children:s.jsx(W,{size:20})}),s.jsx(fe,{data:r,loading:p,visibleColumns:l.length>0?l:i,setupData:V,tableName:n,schemaName:S,childRecords:G,selectedColumns:l.length>0?l:i})]}):r?s.jsxs("div",{className:"",children:[s.jsx("button",{onClick:U,"aria-label":"Close details",children:s.jsx(W,{size:20})}),s.jsxs("h3",{className:"heading",children:["Record Details - ",r.us_id]}),s.jsx(me,{data:oe,loading:p,selectedColumns:l.length>0?l:i,visibleColumns:l.length>0?l:i}),s.jsxs("div",{children:[s.jsx(b,{onClick:()=>{B(`/status-update?schemaName=${S}&current_process=${r==null?void 0:r.status}&tableName=${n}&recordId=${r==null?void 0:r.id}`)},className:"button",children:"Update Status"}),s.jsx(b,{onClick:ne,className:"button",children:"Split Job"})]})]}):null,!p&&x.length===0&&d&&s.jsx("div",{className:"no-records-message",children:"No records found for the selected process."}),s.jsx(ge,{isOpen:X,onClose:()=>F(!1),columns:R,visibleColumns:l,onApplyFilter:ce,tableName:n,setSelectedColumns:j,selectedColumns:i})]})};export{$e as default};
