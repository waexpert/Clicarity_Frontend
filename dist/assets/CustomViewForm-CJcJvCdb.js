const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WastageUpdateForm-C550kgQT.js","assets/index-C8rB76ST.js","assets/index-ChjFitzT.css","assets/RecordDetails-BkP31MSR.js","assets/alert-K6zVH5tD.js","assets/RecordDetails-xoLY8ACE.css","assets/FixedUpdateForm-BwmhLTx4.css"])))=>i.map(i=>d[i]);
import{r as c,a as ne,c as oe,u as le,au as ie,b as E,j as s,B as b,aq as de}from"./index-C8rB76ST.js";import{R as ue}from"./RecordDetails-BkP31MSR.js";import he from"./Filter-CPMpNWYq.js";/* empty css                       */import{S as pe}from"./sliders-horizontal-DKAlJ4op.js";import{X as me}from"./x-CD_kuMe-.js";import"./alert-K6zVH5tD.js";import"./checkbox-CxGRb7L9.js";import"./index-D0w04Fa-.js";const ge=c.lazy(()=>de(()=>import("./WastageUpdateForm-C550kgQT.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ce=()=>{const[n,k]=c.useState("jobstatus"),[y,g]=c.useState(null),[D,B]=c.useState([]),[m,P]=c.useState(!1),[_,U]=c.useState({}),[d,A]=c.useState(""),[M,C]=c.useState([]),[f,v]=c.useState([]),[a,x]=c.useState(null),[i,j]=c.useState([]),[W,J]=c.useState({}),[V,N]=c.useState([]),[z,O]=c.useState(!1),[F,H]=c.useState([]),[o,w]=c.useState([]),l=ne(e=>e.user);oe();const S=(l==null?void 0:l.schema_name)||"default_schema",L=le(),I=["contact","team_member","vendor","schema_migrations","reminders"],q=new Set(I),[G]=ie(),T=G.get("search");c.useEffect(()=>{X(),T&&k(T)},[T]);const R=l.owner_id===null?l.id:l.owner_id;c.useEffect(()=>{const e=async()=>{try{const r=`https://click.wa.expert/api/reference/setup/check?owner_id=${R}&product_name=${n}`,{data:t}=await E.get(r);if(t.exists&&t.setup){J(t.setup),j(t.setup.filter_form_columns||[]),U(t.setup.process_type_mapping||{});const h=(t.setup.process_steps||[]).filter(p=>p&&(p.title||typeof p=="string"));C(h)}else j([]),C([])}catch{C([])}};n&&(l!=null&&l.id)&&e()},[l==null?void 0:l.id,n,R]);const X=async()=>{try{const e=`https://click.wa.expert/api/data/getAllTables?schemaName=${S}`,{data:r}=await E.get(e);B(r.data||[])}catch{g("Failed to fetch tables")}},K=async()=>{if(!n){g("Please select a table");return}if(!d){g("Please select a process");return}P(!0),g(null),v([]),x(null);try{const e="https://click.wa.expert/api",r=`
      (
        status = '${d}'
        OR ${d}_balance > 0
      )
      AND NOT (
        us_id ~ '^[0-9]+$'
        AND LENGTH(us_id::text) >= 10
      )
    `,t=await fetch(`${e}/data/getRecordByCondition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:S,tableName:n,targetWithCondition:r})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const u=await t.json(),h=Array.isArray(u)?u:[u];if(v(h),h.length>0){const p=Object.keys(h[0]);H(p),i.length===0?(j(p),w(p)):w(i)}}catch(e){g(e.message||"Failed to fetch records")}finally{P(!1)}},Q=async e=>{try{const t=await fetch("https://click.wa.expert/api/data/getRecordByTargetAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:S,tableName:n,targetColumn:"pa_id",targetValue:e})});if(t.ok){const u=await t.json(),h=Array.isArray(u)?u:[u];N(h)}}catch{N([])}},Y=e=>{const r=e.target.value;k(r),A(""),v([]),x(null),N([])},Z=e=>{const r=e.target.value;A(r),v([]),x(null),N([])},ee=async e=>{x(e),e.us_id&&await Q(e.us_id)},se=()=>{x(null),N([])},te=e=>{w(e),j(e)},$=d,ae=()=>{L(`/${n}/record?pa_id=${a==null?void 0:a.us_id}&status=${$}&show=true`)},re=c.useMemo(()=>!a||!_?"Dynamic":_[$]||"Dynamic",[a,_,$]),ce=c.useMemo(()=>{if(!a)return a;const e=o.length>0?o:i.length>0?i:Object.keys(a);return e.length===0?a:Object.keys(a).filter(r=>e.includes(r)).reduce((r,t)=>(r[t]=a[t],r),{})},[a,i,o]);return s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"form-group-1",children:[s.jsxs("div",{className:"top-section",children:[s.jsx("h2",{className:"heading",children:"Check Process Status"}),s.jsxs(b,{className:"filter-section",onClick:()=>O(!0),disabled:!a||F.length===0,children:[s.jsx("p",{children:"Filter"}),s.jsx(pe,{className:"icon-md"})]})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"table-select",value:n||"",onChange:Y,className:`select ${y&&!n?"select-error":""}`,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Table"}),D.filter(e=>{const r=(e==null?void 0:e.title)||e;return!q.has(r)}).map((e,r)=>{const t=(e==null?void 0:e.title)||e;return t?s.jsx("option",{value:t,className:"option",children:t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ")},`table-${t}-${r}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"process-name",value:d||"",onChange:Z,className:`select ${y&&!d?"select-error":""}`,disabled:!n,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Process"}),M.map((e,r)=>{const t=(e==null?void 0:e.title)||e;return t?s.jsx("option",{value:t,className:"option",children:t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ")},`process-${t}-${r}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsx(b,{className:`button ${m?"loading":""}`,onClick:K,"aria-label":"Search for process status",disabled:m||!n||!d,children:m?"Searching...":"Search"}),y&&s.jsx("div",{className:"error-message",children:y})]}),f.length>0&&s.jsxs("div",{className:"records-section",children:[s.jsxs("h3",{className:"heading",children:[f.length," Record",f.length!==1?"s":""," Found"]}),s.jsx("div",{className:"records-grid",children:f.map((e,r)=>s.jsx(b,{onClick:()=>ee(e),className:`record-button ${(a==null?void 0:a.us_id)===e.us_id?"active":""}`,style:{whiteSpace:"normal",wordBreak:"break-word"},children:s.jsx("div",{children:e.us_id||`Record ${r+1}`})},e.us_id||`record-${r}`))})]}),a&&re==="Wastage"?s.jsx("div",{className:"form-group-2",children:s.jsx(ge,{data:a,loading:m,visibleColumns:o.length>0?o:i,setupData:W,tableName:n,schemaName:S,childRecords:V,selectedColumns:o.length>0?o:i})}):a&&s.jsxs("div",{className:"record-details-card",children:[s.jsx("button",{onClick:se,children:s.jsx(me,{size:20})}),s.jsxs("h3",{className:"heading",children:["Record Details - ",a.us_id]}),s.jsx(ue,{data:ce,loading:m,selectedColumns:o.length>0?o:i,visibleColumns:o.length>0?o:i}),s.jsxs("div",{children:[s.jsx(b,{onClick:()=>{L(`/status-update?schemaName=${S}&current_process=${a==null?void 0:a.status}&tableName=${n}&recordId=${a==null?void 0:a.id}`)},className:"button",children:"Update Status"}),s.jsx(b,{onClick:ae,className:"button",children:"Split Job"})]})]}),!m&&f.length===0&&d&&s.jsx("div",{className:"no-records-message",children:"No records found for the selected process."}),s.jsx(he,{isOpen:z,onClose:()=>O(!1),columns:F,visibleColumns:o,onApplyFilter:te,tableName:n,setSelectedColumns:j,selectedColumns:i})]})};export{Ce as default};
