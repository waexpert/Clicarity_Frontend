import{r as c,a as le,c as ne,u as oe,au as ie,b as U,j as s,B as N}from"./index-DhckfCQI.js";import{R as de}from"./FixedUpdateForm-DyrQAImK.js";import ue from"./WastageUpdateForm-BO7G7FXt.js";import he from"./Filter-zj1otlA9.js";import{S as pe}from"./sliders-horizontal-dWZj3Gfb.js";import{X as me}from"./x-DyEF0ZNQ.js";import"./alert-BQkvN4u6.js";import"./checkbox-CV37Vin5.js";import"./index-WVyrlFhH.js";const Ce=()=>{const[l,$]=c.useState("jobstatus"),[b,m]=c.useState(null),[E,B]=c.useState([]),[p,P]=c.useState(!1),[v,M]=c.useState({}),[h,A]=c.useState(""),[D,C]=c.useState([]),[g,y]=c.useState([]),[r,f]=c.useState(null),[i,j]=c.useState([]),[J,V]=c.useState({}),[W,x]=c.useState([]),[z,F]=c.useState(!1),[O,H]=c.useState([]),[n,w]=c.useState([]),o=le(e=>e.user);ne();const S=(o==null?void 0:o.schema_name)||"default_schema",L=oe(),I=["contact","team_member","vendor","schema_migrations","reminders"],X=new Set(I),[q]=ie(),_=q.get("search");c.useEffect(()=>{G(),_&&$(_)},[_]);const R=o.owner_id===null?o.id:o.owner_id;c.useEffect(()=>{const e=async()=>{try{const t=`https://click.wa.expert/api/reference/setup/check?owner_id=${R}&product_name=${l}`,{data:a}=await U.get(t);if(a.exists&&a.setup){V(a.setup),j(a.setup.filter_form_columns||[]),M(a.setup.process_type_mapping||{});const u=(a.setup.process_steps||[]).filter(k=>k&&(k.title||typeof k=="string"));C(u)}else j([]),C([])}catch{C([])}};l&&(o!=null&&o.id)&&e()},[o==null?void 0:o.id,l,R]);const G=async()=>{try{const e=`https://click.wa.expert/api/data/getAllTables?schemaName=${S}`,{data:t}=await U.get(e);B(t.data||[])}catch{m("Failed to fetch tables")}},K=async()=>{if(!l){m("Please select a table");return}if(!h){m("Please select a process");return}P(!0),m(null),y([]),f(null);try{const t=await fetch("https://click.wa.expert/api/data/getRecordByTargetAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:S,tableName:l,targetColumn:"status",targetValue:h})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json(),d=Array.isArray(a)?a:[a];y(d);let u=[];d.length>0&&(u=Object.keys(d[0]),H(u),i.length===0?(w(u),j(u)):w(i))}catch(e){m(e.message||"Failed to fetch records")}finally{P(!1)}},Q=async e=>{try{const a=await fetch("https://click.wa.expert/api/data/getRecordByTargetAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:S,tableName:l,targetColumn:"pa_id",targetValue:e})});if(a.ok){const d=await a.json(),u=Array.isArray(d)?d:[d];x(u)}}catch{x([])}},Y=e=>{const t=e.target.value;$(t),A(""),y([]),f(null),x([])},Z=e=>{const t=e.target.value;A(t),y([]),f(null),x([])},ee=async e=>{f(e),e.us_id&&await Q(e.us_id)},se=()=>{f(null),x([])},te=e=>{w(e),j(e)},T=h,ae=()=>{L(`/${l}/record?pa_id=${r==null?void 0:r.us_id}&status=${T}&show=true`)},re=c.useMemo(()=>!r||!v?"Dynamic":v[T]||"Dynamic",[r,v,T]),ce=c.useMemo(()=>{if(!r)return r;const e=n.length>0?n:i.length>0?i:Object.keys(r);return e.length===0?r:Object.keys(r).filter(t=>e.includes(t)).reduce((t,a)=>(t[a]=r[a],t),{})},[r,i,n]);return s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"form-group-1",children:[s.jsxs("div",{className:"top-section",children:[s.jsx("h2",{className:"heading",children:"Check Process Status"}),s.jsxs(N,{className:"filter-section",onClick:()=>F(!0),disabled:!r||O.length===0,children:[s.jsx("p",{children:"Filter"}),s.jsx(pe,{className:"icon-md"})]})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"table-select",value:l||"",onChange:Y,className:`select ${b&&!l?"select-error":""}`,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Table"}),E.filter(e=>{const t=(e==null?void 0:e.title)||e;return!X.has(t)}).map((e,t)=>{const a=(e==null?void 0:e.title)||e;return a?s.jsx("option",{value:a,className:"option",children:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ")},`table-${a}-${t}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"process-name",value:h||"",onChange:Z,className:`select ${b&&!h?"select-error":""}`,disabled:!l,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Process"}),D.map((e,t)=>{const a=(e==null?void 0:e.title)||e;return a?s.jsx("option",{value:a,className:"option",children:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ")},`process-${a}-${t}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsx(N,{className:`button ${p?"loading":""}`,onClick:K,"aria-label":"Search for process status",disabled:p||!l||!h,children:p?"Searching...":"Search"}),b&&s.jsx("div",{className:"error-message",children:b})]}),g.length>0&&s.jsxs("div",{className:"records-section",children:[s.jsxs("h3",{className:"heading",children:[g.length," Record",g.length!==1?"s":""," Found"]}),s.jsx("div",{className:"records-grid",children:g.map((e,t)=>s.jsx(N,{onClick:()=>ee(e),className:`record-button ${(r==null?void 0:r.us_id)===e.us_id?"active":""}`,children:s.jsx("div",{children:e.us_id||`Record ${t+1}`})},e.us_id||`record-${t}`))})]}),r&&s.jsxs("div",{className:"record-details-card",children:[s.jsx("button",{onClick:se,"aria-label":"Close details",children:s.jsx(me,{size:20})}),re==="Wastage"?s.jsx(ue,{data:r,loading:p,visibleColumns:n.length>0?n:i,setupData:J,tableName:l,schemaName:S,childRecords:W,selectedColumns:n.length>0?n:i}):s.jsxs(s.Fragment,{children:[s.jsxs("h3",{className:"heading",children:["Record Details - ",r.us_id]}),s.jsx(de,{data:ce,loading:p,selectedColumns:n.length>0?n:i,visibleColumns:n.length>0?n:i}),s.jsxs("div",{children:[s.jsx(N,{onClick:()=>{L(`/status-update?schemaName=${S}&current_process=${r==null?void 0:r.status}&tableName=${l}&recordId=${r==null?void 0:r.id}`)},className:"button",children:"Update Status"}),s.jsx(N,{onClick:ae,className:"button",children:"Split Job"})]})]})]}),!p&&g.length===0&&h&&s.jsx("div",{className:"no-records-message",children:"No records found for the selected process."}),s.jsx(he,{isOpen:z,onClose:()=>F(!1),columns:O,visibleColumns:n,onApplyFilter:te,tableName:l,setSelectedColumns:j,selectedColumns:i})]})};export{Ce as default};
