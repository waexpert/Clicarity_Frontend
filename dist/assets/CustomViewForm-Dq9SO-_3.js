const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WastageUpdateForm-YxBvfMoQ.js","assets/index-DppSODb2.js","assets/index-ChjFitzT.css","assets/RecordDetails-EuGTiqmO.js","assets/alert-CqS-O9aX.js","assets/RecordDetails-xoLY8ACE.css","assets/FixedUpdateForm-BwmhLTx4.css"])))=>i.map(i=>d[i]);
import{r as o,a as le,c as ie,u as de,au as ue,b as B,j as s,B as y,aq as he}from"./index-DppSODb2.js";import{R as pe}from"./RecordDetails-EuGTiqmO.js";import me from"./Filter-FsHbE0Lj.js";/* empty css                       */import{S as ge}from"./sliders-horizontal-BY48TxZr.js";import{X as fe}from"./x-C9_bEGcx.js";import"./alert-CqS-O9aX.js";import"./checkbox-WMIuUhj3.js";import"./index-Df7kxejl.js";const Ne=o.lazy(()=>he(()=>import("./WastageUpdateForm-YxBvfMoQ.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Te=()=>{const[c,P]=o.useState("jobstatus"),[b,m]=o.useState(null),[U,M]=o.useState([]),[h,O]=o.useState(!1),[v,W]=o.useState({}),[d,R]=o.useState(""),[J,C]=o.useState([]),[g,_]=o.useState([]),[r,f]=o.useState(null),[i,N]=o.useState([]),[H,V]=o.useState({}),[z,j]=o.useState([]),[I,L]=o.useState(!1),[D,G]=o.useState([]),[n,T]=o.useState([]),l=le(e=>e.user);ie();const p=(l==null?void 0:l.schema_name)||"default_schema",E=de(),q=["contact","team_member","vendor","schema_migrations","reminders"],X=new Set(q),[K]=ue(),$=K.get("search");o.useEffect(()=>{Q(),$&&P($)},[$]);const F=l.owner_id===null?l.id:l.owner_id;o.useEffect(()=>{const e=async()=>{try{const t=`https://click.wa.expert/api/reference/setup/check?owner_id=${F}&product_name=${c}`,{data:a}=await B.get(t);if(a.exists&&a.setup){V(a.setup),N(a.setup.filter_form_columns||[]),W(a.setup.process_type_mapping||{});const u=(a.setup.process_steps||[]).filter(S=>S&&(S.title||typeof S=="string"));C(u)}else N([]),C([])}catch{C([])}};c&&(l!=null&&l.id)&&e()},[l==null?void 0:l.id,c,F]);const Q=async()=>{try{const e=`https://click.wa.expert/api/data/getAllTables?schemaName=${p}`,{data:t}=await B.get(e);M(t.data||[])}catch{m("Failed to fetch tables")}},Y=async()=>{if(!c){m("Please select a table");return}if(!d){m("Please select a process");return}O(!0),m(null),_([]),f(null);try{const e="https://click.wa.expert/api",t=await fetch(`${e}/data/getRecordByCondition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:p,tableName:c,targetWithCondition:`status = ${d} AND NOT (us_id ~ '^[0-9]+$' AND LENGTH(us_id::text) >= 10)`})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json(),u=await(await fetch(`${e}/data/getRecordByCondition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:p,tableName:c,targetWithCondition:`${d}_balance > 0 AND NOT (us_id ~ '^[0-9]+$' AND LENGTH(us_id::text) >= 10)`})})).json(),S=Array.isArray(u)?u:[u],A=Array.isArray(a)?a:[a];_(A.concat(S));let w=[];A.length>0&&(w=Object.keys(A[0]),G(w),i.length===0?(T(w),N(w)):T(i))}catch(e){m(e.message||"Failed to fetch records")}finally{O(!1)}},Z=async e=>{try{const a=await fetch("https://click.wa.expert/api/data/getRecordByTargetAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schemaName:p,tableName:c,targetColumn:"pa_id",targetValue:e})});if(a.ok){const x=await a.json(),u=Array.isArray(x)?x:[x];j(u)}}catch{j([])}},ee=e=>{const t=e.target.value;P(t),R(""),_([]),f(null),j([])},se=e=>{const t=e.target.value;R(t),_([]),f(null),j([])},te=async e=>{f(e),e.us_id&&await Z(e.us_id)},ae=()=>{f(null),j([])},re=e=>{T(e),N(e)},k=d,oe=()=>{E(`/${c}/record?pa_id=${r==null?void 0:r.us_id}&status=${k}&show=true`)},ce=o.useMemo(()=>!r||!v?"Dynamic":v[k]||"Dynamic",[r,v,k]),ne=o.useMemo(()=>{if(!r)return r;const e=n.length>0?n:i.length>0?i:Object.keys(r);return e.length===0?r:Object.keys(r).filter(t=>e.includes(t)).reduce((t,a)=>(t[a]=r[a],t),{})},[r,i,n]);return s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"form-group-1",children:[s.jsxs("div",{className:"top-section",children:[s.jsx("h2",{className:"heading",children:"Check Process Status"}),s.jsxs(y,{className:"filter-section",onClick:()=>L(!0),disabled:!r||D.length===0,children:[s.jsx("p",{children:"Filter"}),s.jsx(ge,{className:"icon-md"})]})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"table-select",value:c||"",onChange:ee,className:`select ${b&&!c?"select-error":""}`,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Table"}),U.filter(e=>{const t=(e==null?void 0:e.title)||e;return!X.has(t)}).map((e,t)=>{const a=(e==null?void 0:e.title)||e;return a?s.jsx("option",{value:a,className:"option",children:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ")},`table-${a}-${t}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsxs("div",{className:"select-wrapper",children:[s.jsxs("select",{id:"process-name",value:d||"",onChange:se,className:`select ${b&&!d?"select-error":""}`,disabled:!c,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"Select Process"}),J.map((e,t)=>{const a=(e==null?void 0:e.title)||e;return a?s.jsx("option",{value:a,className:"option",children:a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ")},`process-${a}-${t}`):null})]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsx(y,{className:`button ${h?"loading":""}`,onClick:Y,"aria-label":"Search for process status",disabled:h||!c||!d,children:h?"Searching...":"Search"}),b&&s.jsx("div",{className:"error-message",children:b})]}),g.length>0&&s.jsxs("div",{className:"records-section",children:[s.jsxs("h3",{className:"heading",children:[g.length," Record",g.length!==1?"s":""," Found"]}),s.jsx("div",{className:"records-grid",children:g.map((e,t)=>s.jsx(y,{onClick:()=>te(e),className:`record-button ${(r==null?void 0:r.us_id)===e.us_id?"active":""}`,style:{whiteSpace:"normal",wordBreak:"break-word"},children:s.jsx("div",{children:e.us_id||`Record ${t+1}`})},e.us_id||`record-${t}`))})]}),r&&ce==="Wastage"?s.jsx("div",{className:"form-group-2",children:s.jsx(Ne,{data:r,loading:h,visibleColumns:n.length>0?n:i,setupData:H,tableName:c,schemaName:p,childRecords:z,selectedColumns:n.length>0?n:i})}):r&&s.jsxs("div",{className:"record-details-card",children:[s.jsx("button",{onClick:ae,children:s.jsx(fe,{size:20})}),s.jsxs("h3",{className:"heading",children:["Record Details - ",r.us_id]}),s.jsx(pe,{data:ne,loading:h,selectedColumns:n.length>0?n:i,visibleColumns:n.length>0?n:i}),s.jsxs("div",{children:[s.jsx(y,{onClick:()=>{E(`/status-update?schemaName=${p}&current_process=${r==null?void 0:r.status}&tableName=${c}&recordId=${r==null?void 0:r.id}`)},className:"button",children:"Update Status"}),s.jsx(y,{onClick:oe,className:"button",children:"Split Job"})]})]}),!h&&g.length===0&&d&&s.jsx("div",{className:"no-records-message",children:"No records found for the selected process."}),s.jsx(me,{isOpen:I,onClose:()=>L(!1),columns:D,visibleColumns:n,onApplyFilter:re,tableName:c,setSelectedColumns:N,selectedColumns:i})]})};export{Te as default};
