import{d as Ne,r as n,j as e,k as T,B as v,I as U,a as je,c as be,aj as we,S as ve,C as O,i as I,b as j,f as Se,g as Ce,D as Z,h as _e,ak as ke}from"./index-DhckfCQI.js";import{X as Pe}from"./x-DyEF0ZNQ.js";import{A as Te}from"./CustomTable-Do-NBsca.js";import{L as P}from"./loader-circle-B34pz383.js";import{R as ee}from"./refresh-cw-CXTdvhzl.js";import{S as se}from"./settings-1Ipzlr76.js";import{S as F}from"./save-PzArIgqH.js";import{P as $e}from"./plus-PChCD7tc.js";/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ae=Ne("info",De);function te({webhooks:f,setWebhooks:y,disabled:p=!1}){const[x,m]=n.useState(""),S=i=>{(i.key==="Enter"||i.key===",")&&x.trim()!==""?(i.preventDefault(),f.includes(x.trim())||y([...f,x.trim()]),m("")):i.key==="Backspace"&&x===""&&y(f.slice(0,-1))},E=i=>{y(f.filter((g,$)=>$!==i))};return e.jsxs("div",{className:"space-y-2 mb-8",children:[e.jsxs("div",{className:"flex flex-wrap items-center border border-input rounded-md p-2 gap-2 min-h-[42px] focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2",children:[f.map((i,g)=>e.jsxs(T,{variant:"secondary",className:"bg-primary/10 text-primary hover:bg-primary/20 px-2 py-1 flex items-center gap-1",children:[i,!p&&e.jsx(v,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>E(g),children:e.jsx(Pe,{className:"h-3 w-3"})})]},g)),!p&&e.jsx(U,{id:"webhook-input",type:"text",className:"flex-grow border-0 outline-none min-w-[120px] p-0 h-6 focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Type Values and Press Enter",value:x,onChange:i=>m(i.target.value),onKeyDown:S})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p?"Webhooks are read-only in view mode":"Press Enter or comma to add multiple values"})]})}const Me=()=>{const[f,y]=n.useState({}),[p,x]=n.useState({}),[m,S]=n.useState(!1),[E,i]=n.useState(!0),[g,$]=n.useState(!1),[u,b]=n.useState(!1),[J,L]=n.useState(!1),[d,R]=n.useState([]),[Oe,z]=n.useState([]),ae=["Fixed","Dynamic","Wastage"],[Ie,Ee]=n.useState(!1),[h,D]=n.useState({}),[re,ne]=n.useState(""),[ce,A]=n.useState({}),[C,M]=n.useState(!1),[V,K]=n.useState(""),N=je(t=>t.user),le=be(),ie=N.schema_name,{tableName:o}=we(),[oe,me]=n.useState([]),[w,H]=n.useState({}),_=N.owner_id===null?N.id:N.owner_id,de=(t,a)=>{D(s=>({...s,[t]:a})),re&&ne("")};n.useEffect(()=>{(async()=>{var a,s,r;try{const c=`https://click.wa.expert/api/reference/setup/check?owner_id=${_}&product_name=${o}`,{data:l}=await j.get(c);if(K(((a=l.setup)==null?void 0:a.webhook)||""),l.exists&&l.setup){S(!0),H(l.setup);const Q=Array.isArray((s=l.setup)==null?void 0:s.process_steps)?l.setup.process_steps:[];z(Q),R(Q);const Y=((r=l.setup)==null?void 0:r.process_type_mapping)||{};D(Y),A(Y),l.setup.mapping&&y(l.setup.mapping),l.setup.columnOrder&&x(l.setup.columnOrder)}else S(!1)}catch{S(!1)}})()},[_,o]);const X=async()=>{const t=`https://click.wa.expert/api/data/getTableColumns?schemaName=${ie}&tableName=${o}`;try{const{data:a}=await j.get(t);if(le(ke({table:o,columns:a.data})),me(a.data),!m){const s={},r={};a.data.forEach(c=>{s[c.name]=[],r[c.name]=0}),y(c=>({...s,...c})),x(c=>({...r,...c}))}}catch{}},pe=async()=>{$(!0);try{const t={owner_id:_,product_name:o,mapping:f,columnOrder:p,webhook_input:V,us_id:`${_}_${o}`},r=await j({method:m?"PUT":"POST",url:m?"https://click.wa.expert/api/reference/setup/update":"https://click.wa.expert/api/reference/setup/create",data:t,headers:{"Content-Type":"application/json"}});alert(m?"Setup updated successfully!":"Setup created successfully!")}catch{alert("Error saving setup. Please try again.")}finally{$(!1)}},xe=async()=>{var t,a;b(!0);try{if(Object.keys(h).length===0){alert("Please select at least one process type"),b(!1);return}const s=await j.get("https://click.wa.expert/api/data/updateRecord",{params:{schemaName:"public",tableName:"dropdown_setup",recordId:w.id,ownerId:w.owner_id,columnName:"process_type_mapping",userSchemaName:N.schema_name,userTableName:o,value:JSON.stringify(h)}});alert("Process type mapping saved successfully!"),A({...h})}catch(s){alert(`Error: ${((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to save process type mapping"}`)}finally{b(!1)}},ue=async()=>{var a,s;if(window.confirm("⚠️ Are you sure you want to reset all process type mappings? This action cannot be undone.")){M(!0);try{const r=await j.get("https://click.wa.expert/api/data/updateRecord",{params:{schemaName:"public",tableName:"dropdown_setup",recordId:w.id,ownerId:w.owner_id,columnName:"process_type_mapping",userSchemaName:N.schema_name,userTableName:o,value:JSON.stringify({})}});D({}),A({}),alert("Process type mapping reset successfully!")}catch(r){alert(`Error: ${((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.error)||"Failed to reset process type mapping"}`)}finally{M(!1)}}},he=async()=>{var t,a;b(!0);try{if(!Array.isArray(d)||d.length===0){alert("Please enter at least one process step"),b(!1);return}const s=await j.get("https://click.wa.expert/api/data/updateRecord",{params:{schemaName:"public",tableName:"dropdown_setup",recordId:w.id,ownerId:w.owner_id,columnName:"process_steps",userSchemaName:N.schema_name,userTableName:o,value:JSON.stringify(d)}});alert("Process steps updated successfully!"),z([...d])}catch(s){alert(`Error: ${((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to save process steps"}`)}finally{b(!1)}},fe=async()=>{var t,a;L(!0);try{await X();const s=`https://click.wa.expert/api/reference/setup/check?owner_id=${_}&product_name=${o}`,{data:r}=await j.get(s);if(r.exists&&r.setup){H(r.setup);const c=Array.isArray((t=r.setup)==null?void 0:t.process_steps)?r.setup.process_steps:[];z(c),R(c);const l=((a=r.setup)==null?void 0:a.process_type_mapping)||{};D(l),A(l)}}catch{}finally{L(!1)}},ge=(t,a)=>{const s=a===""?0:parseInt(a)||0;x(r=>({...r,[t]:s}))},k=oe.filter(t=>t.name!=="id"&&!t.name.endsWith("_date")&&!t.name.endsWith("_comment")),W=[...k].sort((t,a)=>{const s=p[t.name]||0,r=p[a.name]||0;return s===0&&r===0?t.name.localeCompare(a.name):s===0?1:r===0?-1:s!==r?s-r:t.name.localeCompare(a.name)}),q=Math.ceil(W.length/2),B=W.slice(0,q),ye=W.slice(q);if(n.useEffect(()=>{(async()=>{i(!0),await X(),i(!1)})()},[o]),E)return e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(P,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-base",children:"Loading setup..."})]});const G=({columns:t,title:a})=>e.jsxs(O,{className:"h-fit",children:[e.jsxs(Se,{className:"pb-4 px-3 md:px-6",children:[e.jsxs(Ce,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Z,{className:"h-5 w-5 text-blue-600"}),a]}),e.jsx(_e,{className:"text-xs md:text-sm",children:"Configure dropdown values and display order for these columns"})]}),e.jsx(I,{className:"space-y-4 px-3 md:px-6",children:t.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No columns in this section"})]}):t.map(s=>e.jsxs("div",{className:"space-y-3 p-3 md:p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-700 capitalize text-sm md:text-base",children:s.name.replace(/_/g," ")}),e.jsx(T,{variant:"outline",className:"text-xs h-5",children:s.type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-gray-400"}),e.jsx(U,{type:"number",min:"0",max:"999",placeholder:"0",value:p[s.name]===0?"":p[s.name]||"",onChange:r=>ge(s.name,r.target.value),className:"w-16 h-8 text-xs text-center",title:"Set display order (0 = no order, 1 = first, 2 = second, etc.)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs md:text-sm font-medium text-gray-600",children:"Dropdown Values:"}),e.jsx(te,{webhooks:f[s.name]||[],setWebhooks:r=>y(c=>({...c,[s.name]:r})),disabled:g,placeholder:`Add values for ${s.name}..`})]})]},s.name))})]});return e.jsxs("div",{className:"mx-4 md:mx-24",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-3 ",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-700 ",children:"Dropdown Setup"}),e.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:["Configure dropdown values and display order for"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:o})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx(T,{variant:m?"default":"secondary",className:"text-xs md:text-sm px-3 py-1",children:m?"✓ Configured":"Not Configured"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:fe,disabled:J,className:"flex items-center gap-2 text-sm",children:[e.jsx(ee,{className:`h-4 w-4 ${J?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]})}),e.jsx(ve,{className:"mb-6"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-700 mb-2",children:"Add Outgoing Webhook"}),e.jsx(U,{type:"text",value:V,placeholder:"Webhook Url",onChange:t=>K(t.target.value)})]}),k.length===0?e.jsx(O,{children:e.jsxs(I,{className:"text-center py-12 px-3 md:px-6",children:[e.jsx(se,{className:"h-16 w-16 mx-auto mb-4 opacity-30"}),e.jsx("h3",{className:"text-base md:text-lg font-medium text-gray-700 mb-2",children:"No configurable columns found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This table doesn't have any columns that can be configured for dropdowns."})]})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(G,{columns:B,title:`Columns 1-${B.length} (Ordered)`}),e.jsx(G,{columns:ye,title:`Columns ${B.length+1}-${k.length} (Ordered)`})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs md:text-sm text-gray-600",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsxs("span",{children:["Total configurable columns: ",e.jsx("strong",{children:k.length})]})]})}),e.jsxs(v,{onClick:pe,disabled:g||k.length===0,className:"flex items-center gap-2 min-w-32 h-10 text-sm md:text-base",size:"lg",children:[g?e.jsx(P,{className:"h-4 w-4 animate-spin"}):m?e.jsx(F,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"}),g?"Saving...":m?"Update Setup":"Create Setup"]})]}),e.jsx(O,{className:"mb-6 bg-gray-50 border-gray-200",children:e.jsx(I,{className:"pt-6 px-3 md:px-6",children:e.jsxs("div",{className:"text-sm md:text-base",children:[e.jsx("h4",{className:"text-base md:text-lg font-semibold mb-3 text-gray-700",children:"Configure Process Steps:"}),e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsx("label",{className:"text-xs md:text-sm font-medium text-gray-600",children:"Process Steps:"}),e.jsx(te,{webhooks:d,setWebhooks:R,disabled:u,placeholder:"Add process steps (e.g., artwork, printing, lamination)..."}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Current steps: ",Array.isArray(d)?d.join(", "):"None"]})]}),e.jsxs(v,{onClick:he,disabled:u,className:"flex items-center gap-2 min-w-32 h-10 mt-4 text-sm md:text-base",size:"lg",children:[u?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(F,{className:"h-4 w-4"}),u?"Saving...":"Update Process Steps"]})]})})}),e.jsx(O,{className:"mb-6 bg-gray-50 border-gray-200",children:e.jsx(I,{className:"pt-6 px-3 md:px-6",children:e.jsxs("div",{className:"text-sm md:text-base",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx("h4",{className:"text-base md:text-lg font-semibold text-gray-700",children:"Define Process Type:"}),Object.keys(h).length>0&&e.jsxs(v,{variant:"destructive",size:"sm",onClick:ue,disabled:C||u,className:"flex items-center gap-2 text-sm w-full sm:w-auto",children:[C?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(ee,{className:"h-4 w-4"}),C?"Resetting...":"Reset All"]})]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded border",children:[e.jsx(se,{className:"h-12 w-12 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm md:text-base",children:"No process steps defined yet."}),e.jsx("p",{className:"text-xs md:text-sm mt-1",children:"Add process steps in the section above first."})]}):e.jsx("div",{className:"space-y-3",children:d.map((t,a)=>e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4 items-start md:items-center p-3 md:p-4 bg-white rounded-lg border hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"md:min-w-[200px] w-full md:w-auto",children:e.jsx("p",{className:"text-sm md:text-base font-medium text-gray-700 capitalize",children:t.replace(/_/g," ")})}),e.jsx("div",{className:"flex-1 w-full",children:e.jsxs("select",{id:`process-type-${a}`,value:h[t]||"",onChange:s=>de(t,s.target.value),disabled:u||C,className:"w-full px-3 md:px-4 py-2 text-sm md:text-base border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select Process Type --"}),ae.map(s=>e.jsx("option",{value:s,children:s},s))]})}),h[t]&&e.jsx(T,{variant:"default",className:"md:ml-2 self-start md:self-center text-xs md:text-sm",children:h[t]})]},a))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsxs(v,{onClick:xe,disabled:u||C||d.length===0||Object.keys(h).length===0,className:"flex items-center gap-2 min-w-32 h-10 text-sm md:text-base",size:"lg",children:[u?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(F,{className:"h-4 w-4"}),u?"Saving...":"Save Process Types"]}),JSON.stringify(h)!==JSON.stringify(ce)&&e.jsx(T,{variant:"outline",className:"self-center text-xs md:text-sm",children:"Unsaved changes"})]})]})})})]})};export{Me as default};
