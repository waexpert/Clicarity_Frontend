import{u as J,a as Q,r as d,j as e,C as A,k as _,g as Z,F as V,h as ee,i as se,B as y,A as ae,y as te,X as G,ao as re,c as B,a9 as k,L as D,p as L,q as O,t as Y,v as K,w as a,I as R,l as ne,ap as ie,E as le}from"./index-DSK3H15k.js";import{T as ce,a as oe,b as $,c as de,d as me,e as ue}from"./table-BRGksd4x.js";import{A as z,b as H,a as U}from"./alert-DRnNDHab.js";import{R as q}from"./refresh-cw-C927ELo_.js";import{C as xe}from"./circle-alert-DUbAD7eI.js";function he({webhooks:l,setWebhooks:j,disabled:r=!1}){const[c,n]=d.useState(""),u=s=>{(s.key==="Enter"||s.key===",")&&c.trim()!==""?(s.preventDefault(),l.includes(c.trim())||j([...l,c.trim()]),n("")):s.key==="Backspace"&&c===""&&j(l.slice(0,-1))},t=s=>{j(l.filter((p,N)=>N!==s))};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"webhook-input",className:"text-sm font-medium",children:"Outgoing Webhooks"}),e.jsxs("div",{className:"flex flex-wrap items-center border border-input rounded-md p-2 gap-2 min-h-[42px] focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2",children:[l.map((s,p)=>e.jsxs(ne,{variant:"secondary",className:"bg-primary/10 text-primary hover:bg-primary/20 px-2 py-1 flex items-center gap-1",children:[s,!r&&e.jsx(y,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>t(p),children:e.jsx(G,{className:"h-3 w-3"})})]},p)),!r&&e.jsx(R,{id:"webhook-input",type:"text",className:"flex-grow border-0 outline-none min-w-[120px] p-0 h-6 focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Type webhook URL and press Enter",value:c,onChange:s=>n(s.target.value),onKeyDown:u})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?"Webhooks are read-only in view mode":"Press Enter or comma to add multiple webhook URLs"})]})}function pe({apiKey:l,disabled:j=!1}){const[r,c]=d.useState(!1),n=()=>{c(u=>!u)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"api-key",className:"text-sm font-medium",children:"API Key"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{id:"api-key",type:r?"text":"password",value:l||"No API key configured",readOnly:!0,className:"pr-10"}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",onClick:n,className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",children:r?e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Your API key is masked for security":"No API key found in setup"})]})}const fe=({selectedOption:l,setSelectedOption:j,paymentTerms:r,setPaymentTerms:c,inputs:n,setInputs:u,disabled:t=!1})=>{const s=o=>{if(t)return;j(o);const i=parseInt(o,10);if(isNaN(i))u([]);else{const f=[...n],I=Array(i).fill("").map((P,m)=>f[m]||"");u(I)}},p=o=>{t||c(o)},N=(o,i)=>{if(t)return;const f=[...n];f[o]=i,u(f)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"reminder-count",className:"text-sm font-medium",children:"Number of Payment Reminders"}),e.jsxs(L,{value:l,onValueChange:s,disabled:t,children:[e.jsx(O,{className:"w-full max-w-xs",children:e.jsx(Y,{placeholder:"Choose number of reminders"})}),e.jsxs(K,{children:[e.jsx(a,{value:"1",children:"1 Reminder"}),e.jsx(a,{value:"2",children:"2 Reminders"}),e.jsx(a,{value:"3",children:"3 Reminders"}),e.jsx(a,{value:"4",children:"4 Reminders"}),e.jsx(a,{value:"5",children:"5 Reminders"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?"Number of reminders (read-only)":"Select how many reminder notifications to send"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Payment Terms"}),e.jsxs(L,{value:r,onValueChange:p,disabled:t,children:[e.jsx(O,{className:"w-full max-w-xs",children:e.jsx(Y,{placeholder:"Choose Payment terms"})}),e.jsxs(K,{children:[e.jsx(a,{value:"15",children:"15 Days"}),e.jsx(a,{value:"30",children:"30 Days"}),e.jsx(a,{value:"45",children:"45 Days"}),e.jsx(a,{value:"60",children:"60 Days"}),e.jsx(a,{value:"75",children:"75 Days"}),e.jsx(a,{value:"90",children:"90 Days"}),e.jsx(a,{value:"105",children:"105 Days"}),e.jsx(a,{value:"120",children:"120 Days"}),e.jsx(a,{value:"150",children:"150 Days"}),e.jsx(a,{value:"180",children:"180 Days"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?"Payment terms (read-only)":"Choose payment terms for invoices"})]}),n.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Days Before Due Date"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:t?"Configured reminder schedule (read-only)":"Configure when each reminder should be sent (days before the due date)"})]}),e.jsx(A,{className:"border border-border mx-[6rem] ",children:e.jsx(_,{className:"p-4",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsx($,{children:n.map((o,i)=>e.jsxs(de,{className:"text-center",children:["Reminder ",i+1]},i))})}),e.jsx(me,{children:e.jsx($,{children:n.map((o,i)=>e.jsx(ue,{className:"p-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{type:"number",min:"0",className:"text-center",value:o,onChange:f=>N(i,f.target.value),placeholder:"Days",disabled:t}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"days before"})]})},i))})})]})})})]})]})},be=()=>{const l=J(),r=Q(g=>g.user).id,[c,n]=d.useState(""),[u,t]=d.useState(""),[s,p]=d.useState([]),[N,o]=d.useState([]),[i,f]=d.useState(""),[I,P]=d.useState(!0),[m,w]=d.useState(!1),[x,v]=d.useState(!1),[E,F]=d.useState(!1),C=async()=>{var g,S,T;try{P(!0);const h=await B.get(`https://click.wa.expert/api/reference/getSetup?owner_id=${r}`);if(h.status===200&&h.data.data){const b=h.data.data;n(((g=b.number_of_reminders)==null?void 0:g.toString())||""),t(((S=b.payment_terms)==null?void 0:S.toString())||""),o(b.output_webhooks||[]),f(b.api_key||""),p(b.days_diff),w(!0),v(!1)}}catch(h){((T=h.response)==null?void 0:T.status)===500?(w(!1),v(!0),k.info("No payment setup found. Please create your configuration.")):(k.error("Failed to fetch payment setup"),w(!1),v(!0))}finally{P(!1)}},M=async()=>{try{F(!0);const g={owner_id:r,number_of_reminders:parseInt(c,10),payment_terms:parseInt(u,10),days_diff:s.map(h=>parseInt(h,10)).filter(h=>!isNaN(h)),output_webhooks:N,api_key:i},S=m?"https://click.wa.expert/api/reference/updateSetup":"https://click.wa.expert/api/reference/createSetup";(await B.post(S,g)).status===200&&(k.success(m?"Setup updated successfully!":"Setup created successfully!"),w(!0),v(!1),await C())}catch{k.error("Failed to save setup. Please try again.")}finally{F(!1)}},W=()=>{v(!0)},X=()=>{m&&(v(!1),C())};return d.useEffect(()=>{r&&C()},[r]),I?e.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:e.jsx(A,{className:"border border-border shadow-sm",children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx(q,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading payment setup..."})]})})})}):e.jsx("div",{className:"w-full px-6 py-6",children:e.jsxs(A,{className:"border border-border shadow-sm mx-[6rem]",children:[e.jsx(Z,{className:"pb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx(ee,{className:"text-2xl font-semibold text-foreground",children:"Payment Configuration"}),e.jsx(se,{className:"text-muted-foreground",children:m?x?"Edit your payment configuration":"View and manage payment reminders, webhooks, and API settings":"Create your payment reminder configuration"})]})]}),m&&!x&&e.jsxs(y,{onClick:W,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Edit Setup"]})]})}),e.jsxs(_,{className:"space-y-8",children:[!m&&e.jsxs(z,{className:"border-orange-200 bg-orange-50",children:[e.jsx(xe,{className:"h-4 w-4 text-orange-600"}),e.jsx(H,{className:"text-orange-700",children:"No Configuration Found"}),e.jsx(U,{className:"text-orange-700",children:"No payment setup exists for your account. Please create your configuration below to get started."})]}),m&&!x&&e.jsxs(z,{className:"border-green-200 bg-green-50",children:[e.jsx(V,{className:"h-4 w-4 text-green-600"}),e.jsx(H,{className:"text-green-700",children:"Configuration Active"}),e.jsx(U,{className:"text-green-700",children:'Your payment reminder system is configured and active. Click "Edit Setup" to make changes.'})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-[#4285B4] pl-4",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"Reminder Schedule"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Configure automated payment reminder notifications":"Your current reminder schedule"})]}),e.jsx(fe,{selectedOption:c,setSelectedOption:n,paymentTerms:u,setPaymentTerms:t,inputs:s,setInputs:p,disabled:!x})]}),e.jsx("div",{className:"border-t border-border"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-[#4285B4] pl-4",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"Output Triggers"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Configure webhook endpoints for payment notifications":"Your configured webhook endpoints"})]}),e.jsx(he,{webhooks:N,setWebhooks:o,disabled:!x})]}),e.jsx("div",{className:"border-t border-border"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-[#4285B4] pl-4",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"API Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Manage your API keys and authentication":"Your API configuration"})]}),e.jsx(pe,{apiKey:i,disabled:!x})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 pt-6 border-t border-border",children:x?e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:M,disabled:E,className:"flex items-center gap-2",size:"default",children:[e.jsx(te,{className:"h-4 w-4"}),E?"Saving...":m?"Update Configuration":"Create Configuration"]}),m&&e.jsxs(y,{variant:"outline",onClick:X,disabled:E,className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Cancel"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"outline",className:"flex items-center gap-2",onClick:()=>l("/paymentstatus/record"),children:[e.jsx(re,{className:"h-4 w-4"}),"View Records"]}),e.jsxs(y,{variant:"outline",onClick:()=>C(),className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Refresh"]})]})})]})]})})};export{be as default};
