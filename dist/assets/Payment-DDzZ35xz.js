import{e as J,u as Q,a as Z,r as d,j as e,C as T,k as A,g as ee,h as se,i as ae,B as y,c as B,a1 as k,L as D,o as F,p as L,q as O,t as M,v as a,I as R,l as te,ag as re,E as ne}from"./index-CJvvkf2A.js";import{T as ie,a as le,b as Y,c as ce,d as oe,e as de}from"./table-Bea0y_Jq.js";import{A as K,b as $,a as q}from"./alert-DsJkKDpD.js";import{R as z}from"./refresh-cw-BAEJARc9.js";import{S as H}from"./settings-Dy9g5Y7e.js";import{S as me}from"./square-pen-BctqfOHf.js";import{C as ue}from"./circle-alert-C8gX0RZ5.js";import{S as xe}from"./save-CSe-j1V3.js";import{X as U}from"./x-fK_8g-tg.js";/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],pe=J("grid-3x3",he);function fe({webhooks:l,setWebhooks:g,disabled:r=!1}){const[c,n]=d.useState(""),u=s=>{(s.key==="Enter"||s.key===",")&&c.trim()!==""?(s.preventDefault(),l.includes(c.trim())||g([...l,c.trim()]),n("")):s.key==="Backspace"&&c===""&&g(l.slice(0,-1))},t=s=>{g(l.filter((p,N)=>N!==s))};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"webhook-input",className:"text-sm font-medium",children:"Outgoing Webhooks"}),e.jsxs("div",{className:"flex flex-wrap items-center border border-input rounded-md p-2 gap-2 min-h-[42px] focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2",children:[l.map((s,p)=>e.jsxs(te,{variant:"secondary",className:"bg-primary/10 text-primary hover:bg-primary/20 px-2 py-1 flex items-center gap-1",children:[s,!r&&e.jsx(y,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>t(p),children:e.jsx(U,{className:"h-3 w-3"})})]},p)),!r&&e.jsx(R,{id:"webhook-input",type:"text",className:"flex-grow border-0 outline-none min-w-[120px] p-0 h-6 focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Type webhook URL and press Enter",value:c,onChange:s=>n(s.target.value),onKeyDown:u})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?"Webhooks are read-only in view mode":"Press Enter or comma to add multiple webhook URLs"})]})}function ge({apiKey:l,disabled:g=!1}){const[r,c]=d.useState(!1),n=()=>{c(u=>!u)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"api-key",className:"text-sm font-medium",children:"API Key"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{id:"api-key",type:r?"text":"password",value:l||"No API key configured",readOnly:!0,className:"pr-10"}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",onClick:n,className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",children:r?e.jsx(re,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Your API key is masked for security":"No API key found in setup"})]})}const je=({selectedOption:l,setSelectedOption:g,paymentTerms:r,setPaymentTerms:c,inputs:n,setInputs:u,disabled:t=!1})=>{const s=o=>{if(t)return;g(o);const i=parseInt(o,10);if(isNaN(i))u([]);else{const f=[...n],I=Array(i).fill("").map((P,m)=>f[m]||"");u(I)}},p=o=>{t||c(o)},N=(o,i)=>{if(t)return;const f=[...n];f[o]=i,u(f)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"reminder-count",className:"text-sm font-medium",children:"Number of Payment Reminders"}),e.jsxs(F,{value:l,onValueChange:s,disabled:t,children:[e.jsx(L,{className:"w-full max-w-xs",children:e.jsx(O,{placeholder:"Choose number of reminders"})}),e.jsxs(M,{children:[e.jsx(a,{value:"1",children:"1 Reminder"}),e.jsx(a,{value:"2",children:"2 Reminders"}),e.jsx(a,{value:"3",children:"3 Reminders"}),e.jsx(a,{value:"4",children:"4 Reminders"}),e.jsx(a,{value:"5",children:"5 Reminders"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?"Number of reminders (read-only)":"Select how many reminder notifications to send"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Payment Terms"}),e.jsxs(F,{value:r,onValueChange:p,disabled:t,children:[e.jsx(L,{className:"w-full max-w-xs",children:e.jsx(O,{placeholder:"Choose Payment terms"})}),e.jsxs(M,{children:[e.jsx(a,{value:"15",children:"15 Days"}),e.jsx(a,{value:"30",children:"30 Days"}),e.jsx(a,{value:"45",children:"45 Days"}),e.jsx(a,{value:"60",children:"60 Days"}),e.jsx(a,{value:"75",children:"75 Days"}),e.jsx(a,{value:"90",children:"90 Days"}),e.jsx(a,{value:"105",children:"105 Days"}),e.jsx(a,{value:"120",children:"120 Days"}),e.jsx(a,{value:"150",children:"150 Days"}),e.jsx(a,{value:"180",children:"180 Days"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?"Payment terms (read-only)":"Choose payment terms for invoices"})]}),n.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Days Before Due Date"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:t?"Configured reminder schedule (read-only)":"Configure when each reminder should be sent (days before the due date)"})]}),e.jsx(T,{className:"border border-border mx-[6rem] ",children:e.jsx(A,{className:"p-4",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsx(Y,{children:n.map((o,i)=>e.jsxs(ce,{className:"text-center",children:["Reminder ",i+1]},i))})}),e.jsx(oe,{children:e.jsx(Y,{children:n.map((o,i)=>e.jsx(de,{className:"p-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{type:"number",min:"0",className:"text-center",value:o,onChange:f=>N(i,f.target.value),placeholder:"Days",disabled:t}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"days before"})]})},i))})})]})})})]})]})},Ie=()=>{const l=Q(),r=Z(j=>j.user).id,[c,n]=d.useState(""),[u,t]=d.useState(""),[s,p]=d.useState([]),[N,o]=d.useState([]),[i,f]=d.useState(""),[I,P]=d.useState(!0),[m,w]=d.useState(!1),[x,v]=d.useState(!1),[_,V]=d.useState(!1),C=async()=>{var j,S,E;try{P(!0);const h=await B.get(`https://click.wa.expert/api/reference/getSetup?owner_id=${r}`);if(h.status===200&&h.data.data){const b=h.data.data;n(((j=b.number_of_reminders)==null?void 0:j.toString())||""),t(((S=b.payment_terms)==null?void 0:S.toString())||""),o(b.output_webhooks||[]),f(b.api_key||""),p(b.days_diff),w(!0),v(!1)}}catch(h){((E=h.response)==null?void 0:E.status)===500?(w(!1),v(!0),k.info("No payment setup found. Please create your configuration.")):(k.error("Failed to fetch payment setup"),w(!1),v(!0))}finally{P(!1)}},G=async()=>{try{V(!0);const j={owner_id:r,number_of_reminders:parseInt(c,10),payment_terms:parseInt(u,10),days_diff:s.map(h=>parseInt(h,10)).filter(h=>!isNaN(h)),output_webhooks:N,api_key:i},S=m?"https://click.wa.expert/api/reference/updateSetup":"https://click.wa.expert/api/reference/createSetup";(await B.post(S,j)).status===200&&(k.success(m?"Setup updated successfully!":"Setup created successfully!"),w(!0),v(!1),await C())}catch{k.error("Failed to save setup. Please try again.")}finally{V(!1)}},W=()=>{v(!0)},X=()=>{m&&(v(!1),C())};return d.useEffect(()=>{r&&C()},[r]),I?e.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:e.jsx(T,{className:"border border-border shadow-sm",children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx(z,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading payment setup..."})]})})})}):e.jsx("div",{className:"w-full px-6 py-6",children:e.jsxs(T,{className:"border border-border shadow-sm mx-[6rem]",children:[e.jsx(ee,{className:"pb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx(se,{className:"text-2xl font-semibold text-foreground",children:"Payment Configuration"}),e.jsx(ae,{className:"text-muted-foreground",children:m?x?"Edit your payment configuration":"View and manage payment reminders, webhooks, and API settings":"Create your payment reminder configuration"})]})]}),m&&!x&&e.jsxs(y,{onClick:W,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Edit Setup"]})]})}),e.jsxs(A,{className:"space-y-8",children:[!m&&e.jsxs(K,{className:"border-orange-200 bg-orange-50",children:[e.jsx(ue,{className:"h-4 w-4 text-orange-600"}),e.jsx($,{className:"text-orange-700",children:"No Configuration Found"}),e.jsx(q,{className:"text-orange-700",children:"No payment setup exists for your account. Please create your configuration below to get started."})]}),m&&!x&&e.jsxs(K,{className:"border-green-200 bg-green-50",children:[e.jsx(H,{className:"h-4 w-4 text-green-600"}),e.jsx($,{className:"text-green-700",children:"Configuration Active"}),e.jsx(q,{className:"text-green-700",children:'Your payment reminder system is configured and active. Click "Edit Setup" to make changes.'})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-[#4285B4] pl-4",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"Reminder Schedule"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Configure automated payment reminder notifications":"Your current reminder schedule"})]}),e.jsx(je,{selectedOption:c,setSelectedOption:n,paymentTerms:u,setPaymentTerms:t,inputs:s,setInputs:p,disabled:!x})]}),e.jsx("div",{className:"border-t border-border"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-[#4285B4] pl-4",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"Output Triggers"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Configure webhook endpoints for payment notifications":"Your configured webhook endpoints"})]}),e.jsx(fe,{webhooks:N,setWebhooks:o,disabled:!x})]}),e.jsx("div",{className:"border-t border-border"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-[#4285B4] pl-4",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"API Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Manage your API keys and authentication":"Your API configuration"})]}),e.jsx(ge,{apiKey:i,disabled:!x})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 pt-6 border-t border-border",children:x?e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:G,disabled:_,className:"flex items-center gap-2",size:"default",children:[e.jsx(xe,{className:"h-4 w-4"}),_?"Saving...":m?"Update Configuration":"Create Configuration"]}),m&&e.jsxs(y,{variant:"outline",onClick:X,disabled:_,className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Cancel"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"outline",className:"flex items-center gap-2",onClick:()=>l("/paymentstatus/record"),children:[e.jsx(pe,{className:"h-4 w-4"}),"View Records"]}),e.jsxs(y,{variant:"outline",onClick:()=>C(),className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Refresh"]})]})})]})]})})};export{Ie as default};
