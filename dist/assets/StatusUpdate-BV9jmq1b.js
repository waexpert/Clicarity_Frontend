import{u as se,a as te,r as a,b as C,a0 as f,j as e,L as D,a2 as ae}from"./index-C8rB76ST.js";import{S as re}from"./send-BeMFGx0S.js";const y="https://click.wa.expert/api",oe={id:Date.now(),name:"In House"};function ne(){const x=ae();return a.useMemo(()=>{const t=new URLSearchParams(x.search),r={};for(const[o,_]of t.entries())r[o]=_;return r},[x.search])}function ie(){const x=se(),t=ne(),r=te(s=>s.user),[o,_]=a.useState(t.next_process||""),[v,F]=a.useState(""),[L,W]=a.useState(!1),[u,E]=a.useState(!1),[c,m]=a.useState(""),[g,Q]=a.useState(""),[Y,R]=a.useState([]),[j,G]=a.useState([]),[P,J]=a.useState(""),w=t.tableName,p=t.current_process||"",V=(r==null?void 0:r.owner_id)??(r==null?void 0:r.id),I=a.useMemo(()=>!o||j.length===0?[]:j.filter(s=>{var i;if(s.name==="In House")return!0;const l=((i=s.process_name)==null?void 0:i.toLowerCase())||"",n=o.toLowerCase();return l===n}),[o,j]),z=a.useCallback(async s=>{const{data:l}=await C.post(`${y}/data/getAllData`,{schemaName:r.schema_name,tableName:s,userId:r.id,userEmail:r.email});return l.data||[]},[r.schema_name,r.id,r.email]),U=a.useCallback(async()=>{const{data:s}=await C.get(`${y}/reference/setup/check?owner_id=${V}&product_name=${w}`);return s},[V,w]),T=a.useCallback(async()=>{const{data:s}=await C.post(`${y}/data/getRecordByTarget`,{schemaName:t.schemaName,tableName:t.tableName,targetColumn:t.targetColumn||"id",targetValue:t.recordId});return s},[t.schemaName,t.tableName,t.targetColumn,t.recordId]);a.useEffect(()=>{if(!r.id||!w)return;const s=new AbortController;return(async()=>{var n,i;try{const[$,q,H]=await Promise.allSettled([U(),z("vendor"),T()]);if($.status==="fulfilled"){const S=$.value,b=((n=S.setup)==null?void 0:n.process_steps)||[];J(((i=S.setup)==null?void 0:i.webhook)||"");const M=b.indexOf(p),B=H.status==="fulfilled"?H.value:{};if(r.owner_id===null){const h=[];for(let d=M+1;d<b.length;d++){const N=b[d];B[N]!=="Not Required"&&h.push(N)}R(h)}else{let h=null;for(let d=M+1;d<b.length;d++){const N=b[d];if(B[N]!=="Not Required"){h=N;break}}R(h?[h]:[])}}else f.error("Failed to load process steps");if(q.status==="fulfilled"){const S=q.value;G([oe,...S])}else f.error("Failed to load vendors")}catch{f.error("Failed to load data")}})(),()=>s.abort()},[r.id,r.owner_id,w,p,U,z,T]);const X=a.useCallback(s=>{Q(s.target.value),c&&m("")},[c]),Z=a.useCallback(s=>{_(s.target.value),F(""),c&&m("")},[c]),ee=a.useCallback(s=>{F(s.target.value)},[]),A=a.useCallback(s=>{s.key==="Enter"&&(s.preventDefault(),O())},[o,v,g]),O=a.useCallback(async()=>{if(!o){m("Please select a process");return}if(!t.schemaName||!t.tableName||!t.recordId){m("Missing required query parameters");return}try{E(!0),m("");const s=t.columnName||t.column||"status",l=P?P.split("/").pop():null,n=new URLSearchParams({schemaName:t.schemaName.toLowerCase(),tableName:t.tableName.toLowerCase(),recordId:t.recordId,col1:s.toLowerCase(),val1:o.toLowerCase(),col2:`${p.toLowerCase()}_date`,val2:new Date().toISOString()});n.append("col3",`${p.toLowerCase()}_vendor`),n.append("val3",v||""),n.append("col4",`${p.toLowerCase()}_comment`),n.append("val4",g||""),l&&n.append("wid",l);const i=`${y}/data/updateMultiple?${n.toString()}`;await C.get(i),W(!0),f.success("Status updated successfully!")}catch{m("Failed to submit. Please try again."),f.error("Failed to update status")}finally{E(!1)}},[o,v,g,P,p,t.schemaName,t.tableName,t.recordId,t.columnName,t.column]);return a.useEffect(()=>{if(L){const s=setTimeout(()=>x(-1),2e3);return()=>clearTimeout(s)}},[L,x]),L?e.jsxs("div",{className:"status-update-container",children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",className:"logo"}),e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:"âœ“"}),e.jsx("h2",{className:"success-heading",children:"Success!"}),e.jsx("p",{className:"success-message",children:"Your status has been updated successfully."}),e.jsx("p",{className:"redirect-message",children:"Redirecting back..."})]})]}):e.jsxs("div",{className:"status-update-container",children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",className:"logo"}),e.jsx("div",{className:"header-section",children:e.jsx("p",{className:"subheading",children:"Select the next process"})}),e.jsxs("div",{className:"form",children:[e.jsxs("div",{className:"input-group",children:[e.jsx(D,{htmlFor:"next-process",className:"input-label",children:"Next Process"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{id:"next-process",value:o,onChange:Z,onKeyDown:A,className:`select ${c&&!o?"select-error":""}`,disabled:u,children:[e.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"-- Select Next Process --"}),Y.map(s=>e.jsx("option",{value:s,className:"option",children:s.charAt(0).toUpperCase()+s.slice(1).replace(/_/g," ")},s))]}),e.jsx(K,{})]}),o&&I.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{htmlFor:"vendor",className:"input-label",style:{marginTop:"16px"},children:"Select Vendor"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{id:"vendor",value:v,onChange:ee,onKeyDown:A,className:"select",disabled:u,children:[e.jsx("option",{value:"",className:"placeholder-option",children:"-- Select Vendor --"}),I.map(s=>e.jsx("option",{value:s.name||s.vendor_name||s.id,className:"option",children:s.name||s.vendor_name||`Vendor ${s.id}`},s.id))]}),e.jsx(K,{})]})]}),o&&I.length===0&&j.length>0&&e.jsxs("div",{className:"warning-message",children:['No vendors available for the selected process "',o,'"']}),e.jsx(D,{htmlFor:"comment",className:"input-label",style:{marginTop:"16px"},children:"Comment (Optional)"}),e.jsxs("div",{style:k.textareaContainer,children:[e.jsx("textarea",{id:"comment",value:g,onChange:X,placeholder:"Type your comment or notes here...",style:{...k.textarea,...c?k.textareaError:{}},rows:4,disabled:u}),e.jsxs("div",{style:k.characterCount,children:[g.length," characters"]})]}),c&&e.jsx("div",{className:"error-message",children:c})]}),e.jsx("button",{onClick:O,className:`submit-button ${o?"active":""} ${u?"disabled":""}`,disabled:u||!o,children:e.jsx("div",{className:"button-content",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{size:16}),"Update Status"]})})})]})]})}const K=()=>e.jsx("div",{className:"select-arrow",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),k={textareaContainer:{position:"relative",width:"100%"},textarea:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",resize:"vertical",minHeight:"120px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},textareaError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},characterCount:{position:"absolute",bottom:"8px",right:"12px",fontSize:"12px",color:"#a0aec0",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px"}};export{ie as default};
