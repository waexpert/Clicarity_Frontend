import{u as se,a as te,r as a,b as v,a0 as x,j as e,L as $,a2 as ae}from"./index-DhckfCQI.js";import{S as re}from"./send-DbSz74xc.js";const j="https://click.wa.expert/api",oe={id:Date.now(),name:"In House"};function ne(){const p=ae();return a.useMemo(()=>{const t=new URLSearchParams(p.search),r={};for(const[o,S]of t.entries())r[o]=S;return r},[p.search])}function ie(){const p=se(),t=ne(),r=te(s=>s.user),[o,S]=a.useState(t.next_process||""),[g,D]=a.useState(""),[C,M]=a.useState(!1),[d,F]=a.useState(!1),[c,u]=a.useState(""),[h,B]=a.useState(""),[K,W]=a.useState([]),[b,Q]=a.useState([]),[y,Y]=a.useState(""),N=t.tableName,m=t.current_process||"",E=(r==null?void 0:r.owner_id)??(r==null?void 0:r.id),k=a.useMemo(()=>!o||b.length===0?[]:b.filter(s=>{var i;if(s.name==="In House")return!0;const l=((i=s.process_name)==null?void 0:i.toLowerCase())||"",n=o.toLowerCase();return l===n}),[o,b]),V=a.useCallback(async s=>{const{data:l}=await v.post(`${j}/data/getAllData`,{schemaName:r.schema_name,tableName:s,userId:r.id,userEmail:r.email});return l.data||[]},[r.schema_name,r.id,r.email]),R=a.useCallback(async()=>{const{data:s}=await v.get(`${j}/reference/setup/check?owner_id=${E}&product_name=${N}`);return s},[E,N]),z=a.useCallback(async()=>{const{data:s}=await v.post(`${j}/data/getRecordByTarget`,{schemaName:t.schemaName,tableName:t.tableName,targetColumn:t.targetColumn||"id",targetValue:t.recordId});return s},[t.schemaName,t.tableName,t.targetColumn,t.recordId]);a.useEffect(()=>{if(!r.id||!N)return;const s=new AbortController;return(async()=>{var n,i;try{const[L,A,O]=await Promise.allSettled([R(),V("vendor"),z()]);if(L.status==="fulfilled"){const f=L.value,_=((n=f.setup)==null?void 0:n.process_steps)||[];Y(((i=f.setup)==null?void 0:i.webhook)||"");const Z=_.indexOf(m),ee=O.status==="fulfilled"?O.value:{};let P=null;for(let I=Z+1;I<_.length;I++){const q=_[I];if(ee[q]!=="Not Required"){P=q;break}}W(P?[P]:[])}else x.error("Failed to load process steps");if(A.status==="fulfilled"){const f=A.value;Q([oe,...f])}else x.error("Failed to load vendors")}catch{x.error("Failed to load data")}})(),()=>s.abort()},[r.id,N,m,R,V,z]);const G=a.useCallback(s=>{B(s.target.value),c&&u("")},[c]),J=a.useCallback(s=>{S(s.target.value),D(""),c&&u("")},[c]),X=a.useCallback(s=>{D(s.target.value)},[]),U=a.useCallback(s=>{s.key==="Enter"&&(s.preventDefault(),T())},[o,g,h]),T=a.useCallback(async()=>{if(!o){u("Please select a process");return}if(!t.schemaName||!t.tableName||!t.recordId){u("Missing required query parameters");return}try{F(!0),u("");const s=t.columnName||t.column||"status",l=y?y.split("/").pop():null,n=new URLSearchParams({schemaName:t.schemaName.toLowerCase(),tableName:t.tableName.toLowerCase(),recordId:t.recordId,col1:s.toLowerCase(),val1:o.toLowerCase(),col2:`${m.toLowerCase()}_date`,val2:new Date().toISOString()});n.append("col3",`${m.toLowerCase()}_vendor`),n.append("val3",g||""),n.append("col4",`${m.toLowerCase()}_comment`),n.append("val4",h||""),l&&n.append("wid",l);const i=`${j}/data/updateMultiple?${n.toString()}`;await v.get(i),M(!0),x.success("Status updated successfully!")}catch{u("Failed to submit. Please try again."),x.error("Failed to update status")}finally{F(!1)}},[o,g,h,y,m,t.schemaName,t.tableName,t.recordId,t.columnName,t.column]);return a.useEffect(()=>{if(C){const s=setTimeout(()=>p(-1),2e3);return()=>clearTimeout(s)}},[C,p]),C?e.jsxs("div",{className:"status-update-container",children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",className:"logo"}),e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:"âœ“"}),e.jsx("h2",{className:"success-heading",children:"Success!"}),e.jsx("p",{className:"success-message",children:"Your status has been updated successfully."}),e.jsx("p",{className:"redirect-message",children:"Redirecting back..."})]})]}):e.jsxs("div",{className:"status-update-container",children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",className:"logo"}),e.jsx("div",{className:"header-section",children:e.jsx("p",{className:"subheading",children:"Select the next process"})}),e.jsxs("div",{className:"form",children:[e.jsxs("div",{className:"input-group",children:[e.jsx($,{htmlFor:"next-process",className:"input-label",children:"Next Process"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{id:"next-process",value:o,onChange:J,onKeyDown:U,className:`select ${c&&!o?"select-error":""}`,disabled:d,children:[e.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"-- Select Next Process --"}),K.map(s=>e.jsx("option",{value:s,className:"option",children:s.charAt(0).toUpperCase()+s.slice(1).replace(/_/g," ")},s))]}),e.jsx(H,{})]}),o&&k.length>0&&e.jsxs(e.Fragment,{children:[e.jsx($,{htmlFor:"vendor",className:"input-label",style:{marginTop:"16px"},children:"Select Vendor"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{id:"vendor",value:g,onChange:X,onKeyDown:U,className:"select",disabled:d,children:[e.jsx("option",{value:"",className:"placeholder-option",children:"-- Select Vendor --"}),k.map(s=>e.jsx("option",{value:s.name||s.vendor_name||s.id,className:"option",children:s.name||s.vendor_name||`Vendor ${s.id}`},s.id))]}),e.jsx(H,{})]})]}),o&&k.length===0&&b.length>0&&e.jsxs("div",{className:"warning-message",children:['No vendors available for the selected process "',o,'"']}),e.jsx($,{htmlFor:"comment",className:"input-label",style:{marginTop:"16px"},children:"Comment (Optional)"}),e.jsxs("div",{style:w.textareaContainer,children:[e.jsx("textarea",{id:"comment",value:h,onChange:G,placeholder:"Type your comment or notes here...",style:{...w.textarea,...c?w.textareaError:{}},rows:4,disabled:d}),e.jsxs("div",{style:w.characterCount,children:[h.length," characters"]})]}),c&&e.jsx("div",{className:"error-message",children:c})]}),e.jsx("button",{onClick:T,className:`submit-button ${o?"active":""} ${d?"disabled":""}`,disabled:d||!o,children:e.jsx("div",{className:"button-content",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{size:16}),"Update Status"]})})})]})]})}const H=()=>e.jsx("div",{className:"select-arrow",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),w={textareaContainer:{position:"relative",width:"100%"},textarea:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",resize:"vertical",minHeight:"120px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},textareaError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},characterCount:{position:"absolute",bottom:"8px",right:"12px",fontSize:"12px",color:"#a0aec0",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px"}};export{ie as default};
