import{u as ce,a as le,r as a,c as y,a0 as f,j as e,aD as ie,L as $,a2 as de}from"./index-CxXEh7ic.js";import{u as ue}from"./useCrypto-CAueoyiV.js";import{S as me}from"./send-DPrtQO-k.js";const k="https://click.wa.expert/api",pe={id:Date.now(),name:"In House"};function he(){const g=de();return a.useMemo(()=>{const t=new URLSearchParams(g.search),r={};for(const[L,o]of t.entries())r[L]=o;return r},[g.search])}function fe(){const g=ce(),t=he(),r=le(s=>s.user),{encrypt:L}=ue(),[o,J]=a.useState(t.next_process||""),[N,V]=a.useState(""),[I,X]=a.useState(!1),[m,E]=a.useState(!1),[c,p]=a.useState(""),[b,Z]=a.useState(""),[ee,R]=a.useState([]),[v,se]=a.useState([]),[z,te]=a.useState(""),[U,T]=a.useState(null),[ae,A]=a.useState(!1),j=t.tableName,w=t.current_process||"",O=(r==null?void 0:r.owner_id)??(r==null?void 0:r.id),P=a.useMemo(()=>!o||v.length===0?[]:v.filter(s=>{var i;if(s.name==="In House")return!0;const l=((i=s.process_name)==null?void 0:i.toLowerCase())||"",n=o.toLowerCase();return l===n}),[o,v]),q=a.useCallback(async s=>{const{data:l}=await y.post(`${k}/data/getAllData`,{schemaName:r.schema_name,tableName:s,userId:r.id,userEmail:r.email});return l.data||[]},[r.schema_name,r.id,r.email]),H=a.useCallback(async()=>{const{data:s}=await y.get(`${k}/reference/setup/check?owner_id=${O}&product_name=${j}`);return s},[O,j]),M=a.useCallback(async()=>{const{data:s}=await y.post(`${k}/data/getRecordByTarget`,{schemaName:t.schemaName,tableName:t.tableName,targetColumn:t.targetColumn||"id",targetValue:t.recordId});return s},[t.schemaName,t.tableName,t.targetColumn,t.recordId]);a.useEffect(()=>{if(!r.id||!j)return;const s=new AbortController;return(async()=>{var n,i;try{const[F,K,Q]=await Promise.allSettled([H(),q("vendor"),M()]);if(F.status==="fulfilled"){const S=F.value,h=((n=S.setup)==null?void 0:n.process_steps)||[];te(((i=S.setup)==null?void 0:i.webhook)||"");const D=h.indexOf(w),Y=Q.status==="fulfilled"?Q.value:{},C=h[D+1];if(C!=null&&C.startsWith("form_")?T(C):T(null),r.owner_id===null){const x=[];for(let d=D+1;d<h.length;d++){const u=h[d];!u.startsWith("form_")&&Y[u]!=="Not Required"&&x.push(u)}R(x)}else{let x=null;for(let d=D+1;d<h.length;d++){const u=h[d];if(!u.startsWith("form_")&&Y[u]!=="Not Required"){x=u;break}}R(x?[x]:[])}}else f.error("Failed to load process steps");if(K.status==="fulfilled"){const S=K.value;se([pe,...S])}else f.error("Failed to load vendors")}catch{f.error("Failed to load data")}})(),()=>s.abort()},[r.id,r.owner_id,j,w,H,q,M]);const re=a.useCallback(s=>{Z(s.target.value),c&&p("")},[c]),oe=a.useCallback(s=>{J(s.target.value),V(""),c&&p("")},[c]),ne=a.useCallback(s=>{V(s.target.value)},[]),W=a.useCallback(s=>{s.key==="Enter"&&(s.preventDefault(),B())},[o,N,b]),B=a.useCallback(async()=>{if(!o){p("Please select a process");return}if(!t.schemaName||!t.tableName||!t.recordId){p("Missing required query parameters");return}try{E(!0),A(!0),p("");const s=t.columnName||t.column||"status",l=L(z),n=new URLSearchParams({schemaName:t.schemaName.toLowerCase(),tableName:t.tableName.toLowerCase(),recordId:t.recordId,col1:s.toLowerCase(),val1:o.toLowerCase(),col2:`${w.toLowerCase()}_date`,val2:new Date().toISOString()});n.append("col3",`${o.toLowerCase()}_vendor`),n.append("val3",N||""),n.append("col4",`${o.toLowerCase()}_comment`),n.append("val4",b||""),l&&n.append("wid",l);const i=`${k}/data/updateMultiple?${n.toString()}`;await y.get(i),X(!0),f.success("Status updated successfully!")}catch{A(!1),p("Failed to submit. Please try again."),f.error("Failed to update status")}finally{E(!1)}},[o,N,b,z,w,t.schemaName,t.tableName,t.recordId,t.columnName,t.column]);return a.useEffect(()=>{if(I){const s=setTimeout(()=>g(-1),2e3);return()=>clearTimeout(s)}},[I,g]),I?e.jsxs("div",{className:"status-update-container",children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",className:"logo"}),e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:"âœ“"}),e.jsx("h2",{className:"success-heading",children:"Success!"}),e.jsx("p",{className:"success-message",children:"Your status has been updated successfully."}),e.jsx("p",{className:"redirect-message",children:"Redirecting back..."})]})]}):e.jsxs("div",{className:"status-update-container",children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",className:"logo"}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"subheading",children:"Select the next process"})}),e.jsxs("div",{className:"form",children:[U&&e.jsx(ie,{prop_form_id:U,submit:ae}),e.jsxs("div",{className:"input-group",children:[e.jsx($,{htmlFor:"next-process",className:"input-label",children:"Next Process"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{id:"next-process",value:o,onChange:oe,onKeyDown:W,className:`select ${c&&!o?"select-error":""}`,disabled:m,children:[e.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"-- Select Next Process --"}),ee.map(s=>e.jsx("option",{value:s,className:"option",children:s.charAt(0).toUpperCase()+s.slice(1).replace(/_/g," ")},s))]}),e.jsx(G,{})]}),o&&P.length>0&&e.jsxs(e.Fragment,{children:[e.jsx($,{htmlFor:"vendor",className:"input-label",style:{marginTop:"16px"},children:"Select Vendor"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{id:"vendor",value:N,onChange:ne,onKeyDown:W,className:"select",disabled:m,children:[e.jsx("option",{value:"",className:"placeholder-option",children:"-- Select Vendor --"}),P.map(s=>e.jsx("option",{value:s.name||s.vendor_name||s.id,className:"option",children:s.name||s.vendor_name||`Vendor ${s.id}`},s.id))]}),e.jsx(G,{})]})]}),o&&P.length===0&&v.length>0&&e.jsxs("div",{className:"warning-message",children:['No vendors available for the selected process "',o,'"']}),e.jsx($,{htmlFor:"comment",className:"input-label",style:{marginTop:"16px"},children:"Comment (Optional)"}),e.jsxs("div",{style:_.textareaContainer,children:[e.jsx("textarea",{id:"comment",value:b,onChange:re,placeholder:"Type your comment or notes here...",style:{..._.textarea,...c?_.textareaError:{}},rows:4,disabled:m}),e.jsxs("div",{style:_.characterCount,children:[b.length," characters"]})]}),c&&e.jsx("div",{className:"error-message",children:c})]}),e.jsx("button",{onClick:B,className:`submit-button ${o?"active":""} ${m?"disabled":""}`,disabled:m||!o,children:e.jsx("div",{className:"button-content",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:16}),"Update Status"]})})})]})]})}const G=()=>e.jsx("div",{className:"select-arrow",children:e.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:e.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),_={textareaContainer:{position:"relative",width:"100%"},textarea:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",resize:"vertical",minHeight:"120px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},textareaError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},characterCount:{position:"absolute",bottom:"8px",right:"12px",fontSize:"12px",color:"#a0aec0",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px"}};export{fe as default};
