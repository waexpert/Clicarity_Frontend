import{r as a,a as $,j as e,L as b,I as A,B as N,c as p,a1 as y}from"./index-B9v0YaNK.js";import{S as B}from"./switch-BiSU51Yw.js";import{S as E}from"./save-gfJedgK3.js";import{R as F}from"./refresh-cw-DQRFPtDX.js";const V=({tableName:c="jobstatus",onCounterUpdate:n})=>{const[h,v]=a.useState(0),[o,u]=a.useState(""),[l,x]=a.useState(!1),[S,w]=a.useState(!1),[j,I]=a.useState(!1),[R,g]=a.useState(null),m=$(s=>s.user),i=m.owner_id===null?m.id:m.owner_id,d=async()=>{try{I(!0);const s="https://click.wa.expert/api/data/getRecordById",r={id:`${i}_${c}`,schemaName:"public",tableName:"counter_setup"},{data:t}=await p.post(s,r);if(t){const _=parseInt(t.counter,10)||0;v(_),u(t.prefix||""),x(t.is_active||!1),g(t.id),n&&n({counter:_,prefix:t.prefix||"",isActive:t.is_active||!1,recordId:t.id})}}catch{v(1),u(""),x(!1),g(null),await k()}finally{I(!1)}},k=async()=>{try{const s="https://click.wa.expert/api/data/createRecord",r={schemaName:"public",tableName:"counter_setup",record:{us_id:`${i}_${c}`,owner_id:i,table_name:c,prefix:"",counter:1,is_active:!1}},{data:t}=await p.post(s,r);await d()}catch{}},C=async()=>{try{w(!0);const s=parseInt(h,10),f="https://click.wa.expert/api/data/createRecord",r=`${i}_${c}`,t={schemaName:"public",tableName:"counter_setup",record:{us_id:r,owner_id:i,table_name:c,prefix:o,counter:s,is_active:l,updated_at:new Date().toISOString()}};await p.post(f,t),y.success("Counter settings saved successfully"),n&&n({counter:s,prefix:o,isActive:l,recordId:R||r}),await d()}catch{y.error("Failed to save counter settings")}finally{w(!1)}};return a.useEffect(()=>{d()},[c]),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(B,{id:"counter-active",checked:l,onCheckedChange:x}),e.jsx(b,{htmlFor:"counter-active",className:"text-sm font-medium whitespace-nowrap",children:"Auto Counter"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[120px]",children:[e.jsx(b,{htmlFor:"prefix",className:"text-sm whitespace-nowrap",children:"Prefix:"}),e.jsx(A,{id:"prefix",type:"text",value:o,onChange:s=>u(s.target.value),placeholder:"INV",className:"h-9"})]}),l&&e.jsxs("div",{className:"text-sm bg-blue-50 px-2 py-1.5 rounded border border-blue-200 flex w-[10rem] items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Next : "}),e.jsxs("span",{className:"font-mono font-semibold text-blue-700",children:[o,h]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(N,{onClick:C,disabled:S,size:"sm",variant:"default",children:e.jsx(E,{className:"h-3.5 w-3.5"})}),e.jsx(N,{onClick:d,disabled:j,variant:"outline",size:"sm",children:e.jsx(F,{className:`h-3.5 w-3.5 ${j?"animate-spin":""}`})})]})]})})})},O=()=>e.jsx(V,{});export{O as default};
