import{u as g,r as c,j as e,D as w,E as k,T as y}from"./index-BM71wYC_.js";const v="https://click.wa.expert/api",$=()=>{const t=g(),[n,x]=c.useState("JobStatus Views"),[d,j]=c.useState([]),[N,r]=c.useState(!0);c.useEffect(()=>{o()},[]);const o=async()=>{try{const l=await(await fetch(`${v}/views/folders?schemaName=public`)).json();j(l),r(!1)}catch{r(!1)}},a=d.find(s=>s.name===n),p=s=>{t(`/views/create-view/${s}`)},m=()=>{t(`/views/create-view/new?folder=${n}`)},u=async(s,i,l)=>{if(l.stopPropagation(),window.confirm(`Are you sure you want to delete "${i}"? This will drop the PostgreSQL view.`))try{const h=await fetch(`${v}/views/${s}?schemaName=public`,{method:"DELETE"});if(h.ok)o();else{const b=await h.json();alert("Failed to delete view: "+(b.message||"Unknown error"))}}catch{alert("Failed to delete view. Please try again.")}};return N?e.jsx("div",{className:"loading",children:"Loading views..."}):e.jsxs("div",{className:"view-builder-container",children:[e.jsxs("div",{className:"view-builder-header",children:[e.jsx("h1",{className:"view-builder-title",children:"View Builder"}),e.jsxs("button",{className:"new-view-btn",onClick:m,children:["+",e.jsx("br",{}),e.jsx("span",{children:"New View"})]})]}),e.jsxs("div",{className:"view-builder-content",children:[e.jsxs("div",{className:"folders-section",children:[e.jsx("div",{className:"section-title",children:e.jsx("h2",{children:"Folders"})}),e.jsx("div",{className:"folders-list",children:d.map(s=>{var i;return e.jsxs("div",{className:`folder-item ${n===s.name?"active":""}`,onClick:()=>x(s.name),children:[e.jsx("span",{className:"folder-checkbox",children:"☐"}),e.jsxs("div",{className:"folder-details",children:[e.jsx("span",{className:"folder-name",children:s.name}),e.jsxs("span",{className:"folder-count",children:[((i=s.views)==null?void 0:i.length)||0," views"]})]}),e.jsx("span",{className:"folder-arrow",children:"›"})]},s.id)})})]}),e.jsxs("div",{className:"views-section",children:[e.jsx("div",{className:"section-title",children:e.jsx("h2",{children:n})}),e.jsx("div",{className:"views-list",children:a!=null&&a.views&&a.views.length>0?a.views.map(s=>e.jsxs("div",{className:"view-item",children:[e.jsxs("div",{className:"view-main-content",children:[e.jsx("div",{className:"view-header",children:e.jsxs("div",{className:"view-title-section",children:[e.jsx("span",{className:"view-name",children:s.name}),e.jsxs("span",{className:"sql-view-name",children:[e.jsx(w,{size:12}),s.sql_view_name]})]})}),s.description&&e.jsx("p",{className:"view-description",children:s.description}),e.jsxs("div",{className:"view-meta",children:[e.jsxs("span",{className:"view-time",children:["Modified ",s.last_modified]}),e.jsxs("span",{className:"view-columns",children:[s.column_count," columns"]})]})]}),e.jsxs("div",{className:"view-actions",children:[e.jsx("button",{className:"action-btn",onClick:()=>p(s.id),title:"Edit view",children:e.jsx(k,{size:16})}),e.jsx("button",{className:"action-btn action-btn-danger",onClick:i=>u(s.id,s.name,i),title:"Delete view",children:e.jsx(y,{size:16})})]})]},s.id)):e.jsxs("div",{className:"empty-views",children:[e.jsx(w,{size:48,className:"empty-icon"}),e.jsx("p",{children:"No views in this folder"}),e.jsx("button",{className:"new-view-btn-small",onClick:m,children:"Create First View"})]})})]})]})]})};export{$ as default};
