import{u as Se,r,a as Ce,j as e,l as Ne,L as j,c as w,a0 as R,aA as je,aB as Re,a2 as _e}from"./index-CxXEh7ic.js";import{u as $e}from"./useCrypto-CAueoyiV.js";import{S as Ie}from"./send-DPrtQO-k.js";function ke(){const m=_e(),F=new URLSearchParams(m.search),s={};for(const[_,i]of F.entries())s[_]=i;return s}function Ve(){const m=Se(),{encrypt:F}=$e(),[s,_]=r.useState(""),[i,q]=r.useState(""),[W,J]=r.useState(!1),[x,M]=r.useState(!1),[u,p]=r.useState(""),t=ke(),[c,$]=r.useState(t.next_process||""),[n,X]=r.useState(null),[h,O]=r.useState(""),Z="https://click.wa.expert/api/data/updateMultiple?",[S,V]=r.useState(""),[I,ee]=r.useState([]),[T,Q]=r.useState([]),L=t.tableName,b=!!t.next_process,k=Ce(a=>a.user),[Be,te]=r.useState([]),[B,ae]=r.useState(0),[Pe,oe]=r.useState(null),[P,re]=r.useState([]),[K,se]=r.useState(""),Y=k.owner_id===null?k.id:k.owner_id,ne=async()=>{try{const a={schemaName:k.schema_name,tableName:"vendor"},l=(await w.post("https://click.wa.expert/api/data/getAllData",a)).data.data||[];l.unshift({id:Date.now(),name:"In House"}),ee(l)}catch{R.error("Failed to load vendors")}};r.useEffect(()=>{if(c&&I.length>0){const a=I.filter(d=>{var f;if(d.name==="In House")return!0;const l=((f=d.process_name)==null?void 0:f.toLowerCase())||"",g=c.toLowerCase();return l===g});Q(a)}else Q([]);V("")},[c,I]),r.useEffect(()=>{b&&c===""&&t.next_process&&$(t.next_process)},[b,t.next_process,c]),r.useEffect(()=>{!b&&P.length>0&&$(P[0]||"")},[b,P]),r.useEffect(()=>{const a=async()=>{try{const d=`https://click.wa.expert/api/reference/setup/check?owner_id=${Y}&product_name=${L}`,{data:l}=await w.get(d),g=l.setup.process_steps||[];te(g),se(l==null?void 0:l.setup.webhook);const y=(await w.post("https://click.wa.expert/api/data/getRecordByTarget",{schemaName:t.schemaName,tableName:t.tableName,targetColumn:t.targetColumn||"id",targetValue:t.recordId})).data;oe(y);const z=g.indexOf(t.current_process),C=g.filter((A,H)=>H>z&&y[A]!=="Not Required");re(C),await ne()}catch{R.error("Failed to load process steps or record data")}};L&&t.schemaName&&t.tableName&&t.recordId&&a()},[Y,L,t.schemaName,t.tableName,t.recordId,t.current_process]),r.useEffect(()=>{if(n&&t.current_process){const a=t.current_process+"_balance";ae(n[a]||0)}},[n,t.current_process]);const ie=async()=>{try{const{data:a}=await w.post(je,{id:decodeURIComponent(t.us_id),schemaName:t.schemaName,tableName:t.tableName});X(a)}catch{R.error("Failed to find the record")}};r.useEffect(()=>{t.recordId&&t.schemaName&&t.tableName&&ie()},[t.recordId,t.schemaName,t.tableName]),r.useEffect(()=>{if(W){const a=setTimeout(()=>{m(-1)},2e3);return()=>clearTimeout(a)}},[W,m]);const G=async()=>{if(!i.trim()||isNaN(i)||Number(i)<0||!s.trim()||isNaN(s)||Number(s)<0){p("Please enter a valid positive number.");return}const a=Number(i)+Number(s);if(a>B){p(`Total (Received + Wastage = ${a}) cannot exceed Current Balance (${B})`);return}if(!t.schemaName||!t.tableName||!t.recordId||!t.ownerId){p("Please provide required details");return}if(!n){p("Parent record data not loaded");return}try{M(!0),p("");const d=t.current_process,l=c,g=d+"_balance",f=l+"_quantity_received",E=l+"_wastage",y=l+"_balance",z=Number(i),C=Number(B)-Number(i)-Number(s),A=(n==null?void 0:n.wastage)||0,H=Number(A)+Number(s),me=(n==null?void 0:n[f])||0,xe=(n==null?void 0:n[E])||0,ge=(n==null?void 0:n[y])||0,fe=Number(me)+Number(i),he=Number(xe)+Number(s),be=Number(ge)+z,ye=new URLSearchParams(t).toString();let v=7,D=`${Z}${ye}&col1=${g}&val1=${C}&col2=${E}&val2=${he}&col3=wastage&val3=${H}&col4=${f}&val4=${fe}&col5=${y}&val5=${be}&col6=${d}&val6=${Number(C)<=0?"Completed":n[d]}&col7=${t.current_process}_date&val7=${new Date().toISOString()}`;if(S&&(v++,D+=`&col${v}=${l}_vendor&val${v}=${encodeURIComponent(S)}`),h&&(v++,D+=`&col${v}=${t.current_process}_comment&val${v}=${encodeURIComponent(h)}`),K){const we=F(K);D+=`&wid=${we}`}const Ee=await w.get(D),ve=Math.floor(Date.now()/1e3),N={...n,us_id:ve,pa_id:t.us_id,[f]:i,[E]:s,[y]:z,[g]:C,wastage:s};S&&(N[`${l}_vendor`]=S),h&&(N[`${t.current_process}_comment`]=h),delete N.id,delete N.recordId;const ze=await w.post(Re,{schemaName:t.schemaName,tableName:t.tableName,record:N});J(!0),_(""),q(""),O(""),V(""),b||$(""),R.success("Wastage submitted and new record created successfully!")}catch{p("Failed to submit. Please try again."),R.error("Failed to submit wastage")}finally{M(!1)}},ce=a=>{_(a.target.value),u&&p("")},le=a=>{q(a.target.value),u&&p("")},de=a=>{$(a.target.value),u&&p("")},ue=a=>{O(a.target.value),u&&p("")},pe=a=>{V(a.target.value)},U=a=>{a.key==="Enter"&&(a.preventDefault(),G())};return W?e.jsxs("div",{style:o.container,children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",style:o.logo}),e.jsxs("div",{style:o.successContainer,children:[e.jsx("div",{style:o.successIcon,children:"âœ“"}),e.jsx("h2",{style:o.successHeading,children:"Success!"}),e.jsx("p",{style:o.successMessage,children:"Your wastage number has been submitted successfully."})]})]}):e.jsxs("div",{style:o.container,children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",style:o.logo}),e.jsxs("div",{style:o.headerSection,children:[e.jsx("p",{style:o.subheading,children:"Please enter the wastage details below"}),e.jsxs(Ne,{className:"status-badge bg-blue-100 text-blue-700 mt-2 px-4",children:["Current Process ","-> "+t.current_process.charAt(0).toUpperCase()+t.current_process.slice(1)," : ",B]})]}),e.jsxs("div",{style:o.form,children:[e.jsxs("div",{style:o.inputGroup,children:[b?e.jsxs("div",{style:o.infoBox,children:[e.jsx("strong",{children:"Next Process:"})," ",c?c.charAt(0).toUpperCase()+c.slice(1):""]}):e.jsxs("div",{className:"",children:[e.jsx(j,{htmlFor:"next-process",style:o.inputLabel,children:"Select Next Process"}),e.jsxs("select",{id:"next-process",value:c,onChange:de,style:{...o.input,...u&&!c?o.inputError:{},marginBottom:"12px"},disabled:x,children:[e.jsx("option",{value:"",children:"-- Select Next Process --"}),P.map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))]})]}),e.jsx(j,{htmlFor:"received-number",style:o.inputLabel,children:"Enter Received Quantity"}),e.jsx("input",{id:"received-number",type:"number",value:i,onChange:le,onKeyDown:U,placeholder:"Enter received quantity...",style:{marginBottom:"12px",...o.input,...u?o.inputError:{}},disabled:x,min:"0",step:"1"}),e.jsx(j,{htmlFor:"wastage-number",style:o.inputLabel,children:"Enter Wastage Quantity"}),e.jsxs("div",{style:o.inputContainer,children:[e.jsx("input",{id:"wastage-number",type:"number",value:s,onChange:ce,onKeyDown:U,placeholder:"Enter wastage number...",style:{...o.input,...u?o.inputError:{}},disabled:x,min:"0",step:"1"}),(s||i)&&e.jsxs("div",{style:o.valueDisplay,children:[e.jsxs("div",{children:["Received: ",i||"0"]}),e.jsxs("div",{children:["Wastage: ",s||"0"]}),e.jsxs("div",{children:["Total Used: ",i&&s?Number(i)+Number(s):"0"]})]})]}),c&&T.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(j,{htmlFor:"vendor",style:{...o.inputLabel,marginTop:"16px"},children:"Select Vendor (Optional)"}),e.jsxs("select",{id:"vendor",value:S,onChange:pe,onKeyDown:U,style:{...o.input,marginBottom:"12px"},disabled:x,children:[e.jsx("option",{value:"",children:"-- Select Vendor (Optional) --"}),T.map(a=>e.jsx("option",{value:a.name||a.vendor_name||a.id,children:a.name||a.vendor_name||`Vendor ${a.id}`},a.id))]})]}),c&&T.length===0&&I.length>0&&e.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",fontSize:"14px",color:"#856404"},children:['No vendors available for the selected process "',c,'"']}),e.jsx(j,{htmlFor:"comment",style:{...o.inputLabel,marginTop:"16px"},children:"Comment (Optional)"}),e.jsxs("div",{style:o.textareaContainer,children:[e.jsx("textarea",{id:"comment",value:h,onChange:ue,placeholder:"Type your comment or notes here...",style:{...o.textarea,...u?o.textareaError:{}},rows:4,disabled:x}),e.jsxs("div",{style:o.characterCount,children:[h.length," characters"]})]}),u&&e.jsx("div",{style:o.errorMessage,children:u})]}),e.jsx("button",{onClick:G,style:{...o.button,...x?o.buttonDisabled:{},...s.trim()&&i.trim()&&c?o.buttonActive:{}},disabled:x||!s.trim()||!i.trim()||!c,children:e.jsx("div",{style:o.buttonContent,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:o.spinner}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:16}),"Submit Wastage"]})})})]})]})}const o={container:{maxWidth:"500px",margin:"50px auto",padding:"32px",border:"1px solid #e1e5e9",borderRadius:"16px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:"#ffffff",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',minHeight:"400px"},logo:{width:"20rem",height:"auto",marginBottom:"1rem"},headerSection:{textAlign:"center",marginBottom:"32px",width:"100%"},subheading:{fontSize:"16px",color:"#718096",margin:0,lineHeight:"1.5"},form:{display:"flex",flexDirection:"column",width:"100%",gap:"24px"},inputGroup:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},inputLabel:{fontSize:"14px",fontWeight:"600",color:"#2d3748",marginBottom:"4px",textAlign:"center"},inputContainer:{position:"relative",width:"100%"},input:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",minHeight:"56px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},inputError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},infoBox:{backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"8px",padding:"12px 16px",marginBottom:"12px",fontSize:"14px",color:"#0050b3",textAlign:"center"},valueDisplay:{marginTop:"8px",fontSize:"14px",color:"#4a5568",backgroundColor:"#f7fafc",padding:"12px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"4px"},textareaContainer:{position:"relative",width:"100%"},textarea:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",resize:"vertical",minHeight:"120px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},textareaError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},characterCount:{position:"absolute",bottom:"8px",right:"12px",fontSize:"12px",color:"#a0aec0",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px"},errorMessage:{fontSize:"14px",color:"#e53e3e",backgroundColor:"#fed7d7",padding:"8px 12px",borderRadius:"6px",border:"1px solid #feb2b2",marginTop:"8px"},button:{padding:"16px 24px",fontSize:"16px",fontWeight:"600",border:"none",borderRadius:"12px",backgroundColor:"#a0aec0",color:"#ffffff",cursor:"not-allowed",transition:"all 0.3s ease",outline:"none",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"56px",transform:"translateY(0)"},buttonActive:{backgroundColor:"#4388c1",cursor:"pointer",boxShadow:"0 4px 12px rgba(67, 136, 193, 0.3)"},buttonDisabled:{backgroundColor:"#a0aec0",cursor:"not-allowed",transform:"none",boxShadow:"none"},buttonContent:{display:"flex",alignItems:"center",gap:"8px"},spinner:{width:"16px",height:"16px",border:"2px solid transparent",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite"},successContainer:{textAlign:"center",padding:"40px 20px",width:"100%"},successIcon:{width:"64px",height:"64px",backgroundColor:"#48bb78",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"32px",fontWeight:"bold",margin:"0 auto 24px",animation:"bounceIn 0.6s ease-out"},successHeading:{fontSize:"24px",fontWeight:"700",color:"#2d3748",margin:"0 0 12px 0"},successMessage:{fontSize:"16px",color:"#718096",margin:"0 0 32px 0",lineHeight:"1.5"}};if(typeof document<"u"){const m=document.createElement("style");m.type="text/css",m.innerText=`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      @keyframes bounceIn {
        0% { 
          transform: scale(0.3);
          opacity: 0;
        }
        50% { 
          transform: scale(1.05);
        }
        70% { 
          transform: scale(0.9);
        }
        100% { 
          transform: scale(1);
          opacity: 1;
        }
      }
      
      input:focus, select:focus, textarea:focus {
        border-color: #4388c1 !important;
        background-color: #ffffff !important;
        box-shadow: 0 0 0 3px rgba(67, 136, 193, 0.1) !important;
      }
      
      button:not(:disabled):hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 6px 20px rgba(67, 136, 193, 0.4) !important;
      }
    `,document.getElementById("wastage-styles")||(m.id="wastage-styles",document.head.appendChild(m))}export{Ve as default};
