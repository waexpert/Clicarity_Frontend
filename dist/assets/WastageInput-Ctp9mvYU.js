import{u as be,r as o,a as ye,j as e,k as ve,L as R,b as w,a0 as _,a2 as we}from"./index-C8rB76ST.js";import{a as Se,c as Ce}from"./apiConfig-CtLEPF4c.js";import{S as Ne}from"./send-BeMFGx0S.js";function je(){const m=we(),s=new URLSearchParams(m.search),S={};for(const[i,$]of s.entries())S[i]=$;return S}function Ee(){const m=be(),[s,S]=o.useState(""),[i,$]=o.useState(""),[F,Y]=o.useState(!1),[x,M]=o.useState(!1),[u,p]=o.useState(""),t=je(),[c,I]=o.useState(t.next_process||""),[n,G]=o.useState(null),[h,O]=o.useState(""),J="https://click.wa.expert/api/data/updateMultiple?",[C,W]=o.useState(""),[P,X]=o.useState([]),[V,Q]=o.useState([]),T=t.tableName,b=!!t.next_process,k=ye(a=>a.user),[Re,Z]=o.useState([]),[B,ee]=o.useState(0),[_e,te]=o.useState(null),[E,ae]=o.useState([]),L=k.owner_id===null?k.id:k.owner_id,re=async()=>{try{const a={schemaName:k.schema_name,tableName:"vendor"},l=(await w.post("https://click.wa.expert/api/data/getAllData",a)).data.data||[];l.unshift({id:Date.now(),name:"In House"}),X(l)}catch{_.error("Failed to load vendors")}};o.useEffect(()=>{if(c&&P.length>0){const a=P.filter(d=>{var f;if(d.name==="In House")return!0;const l=((f=d.process_name)==null?void 0:f.toLowerCase())||"",g=c.toLowerCase();return l===g});Q(a)}else Q([]);W("")},[c,P]),o.useEffect(()=>{b&&c===""&&t.next_process&&I(t.next_process)},[b,t.next_process,c]),o.useEffect(()=>{!b&&E.length>0&&I(E[0]||"")},[b,E]),o.useEffect(()=>{const a=async()=>{try{const d=`https://click.wa.expert/api/reference/setup/check?owner_id=${L}&product_name=${T}`,{data:l}=await w.get(d),g=l.setup.process_steps||[];Z(g);const y=(await w.post("https://click.wa.expert/api/data/getRecordByTarget",{schemaName:t.schemaName,tableName:t.tableName,targetColumn:t.targetColumn||"id",targetValue:t.recordId})).data;te(y);const D=g.indexOf(t.current_process),N=g.filter((H,A)=>A>D&&y[H]!=="Not Required");ae(N),await re()}catch{_.error("Failed to load process steps or record data")}};L&&T&&t.schemaName&&t.tableName&&t.recordId&&a()},[L,T,t.schemaName,t.tableName,t.recordId,t.current_process]),o.useEffect(()=>{if(n&&t.current_process){const a=t.current_process+"_balance";ee(n[a]||0)}},[n,t.current_process]);const oe=async()=>{try{const{data:a}=await w.post(Se,{id:decodeURIComponent(t.us_id),schemaName:t.schemaName,tableName:t.tableName});G(a)}catch{_.error("Failed to find the record")}};o.useEffect(()=>{t.recordId&&t.schemaName&&t.tableName&&oe()},[t.recordId,t.schemaName,t.tableName]),o.useEffect(()=>{if(F){const a=setTimeout(()=>{m(-1)},2e3);return()=>clearTimeout(a)}},[F,m]);const K=async()=>{if(!i.trim()||isNaN(i)||Number(i)<0||!s.trim()||isNaN(s)||Number(s)<0){p("Please enter a valid positive number.");return}const a=Number(i)+Number(s);if(a>B){p(`Total (Received + Wastage = ${a}) cannot exceed Current Balance (${B})`);return}if(!t.schemaName||!t.tableName||!t.recordId||!t.ownerId){p("Please provide required details");return}if(!n){p("Parent record data not loaded");return}try{M(!0),p("");const d=t.current_process,l=c,g=d+"_balance",f=l+"_quantity_received",z=l+"_wastage",y=l+"_balance",D=Number(i),N=Number(B)-Number(i)-Number(s),H=(n==null?void 0:n.wastage)||0,A=Number(H)+Number(s),de=(n==null?void 0:n[f])||0,ue=(n==null?void 0:n[z])||0,pe=(n==null?void 0:n[y])||0,me=Number(de)+Number(i),xe=Number(ue)+Number(s),ge=Number(pe)+D,fe=new URLSearchParams(t).toString();let v=7,q=`${J}${fe}&col1=${g}&val1=${N}&col2=${z}&val2=${xe}&col3=wastage&val3=${A}&col4=${f}&val4=${me}&col5=${y}&val5=${ge}&col6=${d}&val6=${Number(N)<=0?"Completed":n[d]}&col7=${t.current_process}_date&val7=${new Date().toISOString()}`;C&&(v++,q+=`&col${v}=${l}_vendor&val${v}=${encodeURIComponent(C)}`),h&&(v++,q+=`&col${v}=${t.current_process}_comment&val${v}=${encodeURIComponent(h)}`);const $e=await w.get(q),he=Math.floor(Date.now()/1e3),j={...n,us_id:he,pa_id:t.us_id,[f]:i,[z]:s,[y]:D,[g]:N,wastage:s};C&&(j[`${l}_vendor`]=C),h&&(j[`${t.current_process}_comment`]=h),delete j.id,delete j.recordId;const Ie=await w.post(Ce,{schemaName:t.schemaName,tableName:t.tableName,record:j});Y(!0),S(""),$(""),O(""),W(""),b||I(""),_.success("Wastage submitted and new record created successfully!")}catch{p("Failed to submit. Please try again."),_.error("Failed to submit wastage")}finally{M(!1)}},se=a=>{S(a.target.value),u&&p("")},ne=a=>{$(a.target.value),u&&p("")},ie=a=>{I(a.target.value),u&&p("")},ce=a=>{O(a.target.value),u&&p("")},le=a=>{W(a.target.value)},U=a=>{a.key==="Enter"&&(a.preventDefault(),K())};return F?e.jsxs("div",{style:r.container,children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",style:r.logo}),e.jsxs("div",{style:r.successContainer,children:[e.jsx("div",{style:r.successIcon,children:"âœ“"}),e.jsx("h2",{style:r.successHeading,children:"Success!"}),e.jsx("p",{style:r.successMessage,children:"Your wastage number has been submitted successfully."})]})]}):e.jsxs("div",{style:r.container,children:[e.jsx("img",{src:"https://clicarity.s3.eu-north-1.amazonaws.com/logo.png",alt:"logo",style:r.logo}),e.jsxs("div",{style:r.headerSection,children:[e.jsx("p",{style:r.subheading,children:"Please enter the wastage details below"}),e.jsxs(ve,{className:"status-badge bg-blue-100 text-blue-700 mt-2 px-4",children:["Current Process ","-> "+t.current_process.charAt(0).toUpperCase()+t.current_process.slice(1)," : ",B]})]}),e.jsxs("div",{style:r.form,children:[e.jsxs("div",{style:r.inputGroup,children:[b?e.jsxs("div",{style:r.infoBox,children:[e.jsx("strong",{children:"Next Process:"})," ",c?c.charAt(0).toUpperCase()+c.slice(1):""]}):e.jsxs("div",{className:"",children:[e.jsx(R,{htmlFor:"next-process",style:r.inputLabel,children:"Select Next Process"}),e.jsxs("select",{id:"next-process",value:c,onChange:ie,style:{...r.input,...u&&!c?r.inputError:{},marginBottom:"12px"},disabled:x,children:[e.jsx("option",{value:"",children:"-- Select Next Process --"}),E.map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))]})]}),e.jsx(R,{htmlFor:"received-number",style:r.inputLabel,children:"Enter Received Quantity"}),e.jsx("input",{id:"received-number",type:"number",value:i,onChange:ne,onKeyDown:U,placeholder:"Enter received quantity...",style:{marginBottom:"12px",...r.input,...u?r.inputError:{}},disabled:x,min:"0",step:"1"}),e.jsx(R,{htmlFor:"wastage-number",style:r.inputLabel,children:"Enter Wastage Quantity"}),e.jsxs("div",{style:r.inputContainer,children:[e.jsx("input",{id:"wastage-number",type:"number",value:s,onChange:se,onKeyDown:U,placeholder:"Enter wastage number...",style:{...r.input,...u?r.inputError:{}},disabled:x,min:"0",step:"1"}),(s||i)&&e.jsxs("div",{style:r.valueDisplay,children:[e.jsxs("div",{children:["Received: ",i||"0"]}),e.jsxs("div",{children:["Wastage: ",s||"0"]}),e.jsxs("div",{children:["Total Used: ",i&&s?Number(i)+Number(s):"0"]})]})]}),c&&V.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{htmlFor:"vendor",style:{...r.inputLabel,marginTop:"16px"},children:"Select Vendor (Optional)"}),e.jsxs("select",{id:"vendor",value:C,onChange:le,onKeyDown:U,style:{...r.input,marginBottom:"12px"},disabled:x,children:[e.jsx("option",{value:"",children:"-- Select Vendor (Optional) --"}),V.map(a=>e.jsx("option",{value:a.name||a.vendor_name||a.id,children:a.name||a.vendor_name||`Vendor ${a.id}`},a.id))]})]}),c&&V.length===0&&P.length>0&&e.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",fontSize:"14px",color:"#856404"},children:['No vendors available for the selected process "',c,'"']}),e.jsx(R,{htmlFor:"comment",style:{...r.inputLabel,marginTop:"16px"},children:"Comment (Optional)"}),e.jsxs("div",{style:r.textareaContainer,children:[e.jsx("textarea",{id:"comment",value:h,onChange:ce,placeholder:"Type your comment or notes here...",style:{...r.textarea,...u?r.textareaError:{}},rows:4,disabled:x}),e.jsxs("div",{style:r.characterCount,children:[h.length," characters"]})]}),u&&e.jsx("div",{style:r.errorMessage,children:u})]}),e.jsx("button",{onClick:K,style:{...r.button,...x?r.buttonDisabled:{},...s.trim()&&i.trim()&&c?r.buttonActive:{}},disabled:x||!s.trim()||!i.trim()||!c,children:e.jsx("div",{style:r.buttonContent,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:r.spinner}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:16}),"Submit Wastage"]})})})]})]})}const r={container:{maxWidth:"500px",margin:"50px auto",padding:"32px",border:"1px solid #e1e5e9",borderRadius:"16px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:"#ffffff",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',minHeight:"400px"},logo:{width:"20rem",height:"auto",marginBottom:"1rem"},headerSection:{textAlign:"center",marginBottom:"32px",width:"100%"},subheading:{fontSize:"16px",color:"#718096",margin:0,lineHeight:"1.5"},form:{display:"flex",flexDirection:"column",width:"100%",gap:"24px"},inputGroup:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},inputLabel:{fontSize:"14px",fontWeight:"600",color:"#2d3748",marginBottom:"4px",textAlign:"center"},inputContainer:{position:"relative",width:"100%"},input:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",minHeight:"56px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},inputError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},infoBox:{backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"8px",padding:"12px 16px",marginBottom:"12px",fontSize:"14px",color:"#0050b3",textAlign:"center"},valueDisplay:{marginTop:"8px",fontSize:"14px",color:"#4a5568",backgroundColor:"#f7fafc",padding:"12px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"4px"},textareaContainer:{position:"relative",width:"100%"},textarea:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",border:"2px solid #e2e8f0",transition:"all 0.3s ease",outline:"none",resize:"vertical",minHeight:"120px",fontFamily:"inherit",lineHeight:"1.5",backgroundColor:"#fafafa",boxSizing:"border-box"},textareaError:{borderColor:"#e53e3e",backgroundColor:"#fed7d7"},characterCount:{position:"absolute",bottom:"8px",right:"12px",fontSize:"12px",color:"#a0aec0",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px"},errorMessage:{fontSize:"14px",color:"#e53e3e",backgroundColor:"#fed7d7",padding:"8px 12px",borderRadius:"6px",border:"1px solid #feb2b2",marginTop:"8px"},button:{padding:"16px 24px",fontSize:"16px",fontWeight:"600",border:"none",borderRadius:"12px",backgroundColor:"#a0aec0",color:"#ffffff",cursor:"not-allowed",transition:"all 0.3s ease",outline:"none",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"56px",transform:"translateY(0)"},buttonActive:{backgroundColor:"#4388c1",cursor:"pointer",boxShadow:"0 4px 12px rgba(67, 136, 193, 0.3)"},buttonDisabled:{backgroundColor:"#a0aec0",cursor:"not-allowed",transform:"none",boxShadow:"none"},buttonContent:{display:"flex",alignItems:"center",gap:"8px"},spinner:{width:"16px",height:"16px",border:"2px solid transparent",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite"},successContainer:{textAlign:"center",padding:"40px 20px",width:"100%"},successIcon:{width:"64px",height:"64px",backgroundColor:"#48bb78",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"32px",fontWeight:"bold",margin:"0 auto 24px",animation:"bounceIn 0.6s ease-out"},successHeading:{fontSize:"24px",fontWeight:"700",color:"#2d3748",margin:"0 0 12px 0"},successMessage:{fontSize:"16px",color:"#718096",margin:"0 0 32px 0",lineHeight:"1.5"}};if(typeof document<"u"){const m=document.createElement("style");m.type="text/css",m.innerText=`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      @keyframes bounceIn {
        0% { 
          transform: scale(0.3);
          opacity: 0;
        }
        50% { 
          transform: scale(1.05);
        }
        70% { 
          transform: scale(0.9);
        }
        100% { 
          transform: scale(1);
          opacity: 1;
        }
      }
      
      input:focus, select:focus, textarea:focus {
        border-color: #4388c1 !important;
        background-color: #ffffff !important;
        box-shadow: 0 0 0 3px rgba(67, 136, 193, 0.1) !important;
      }
      
      button:not(:disabled):hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 6px 20px rgba(67, 136, 193, 0.4) !important;
      }
    `,document.getElementById("wastage-styles")||(m.id="wastage-styles",document.head.appendChild(m))}export{Ee as default};
