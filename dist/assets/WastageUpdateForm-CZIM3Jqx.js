import{u as k,a as T,r as l,j as s,B as v}from"./index-CxXEh7ic.js";import{R as W}from"./RecordDetails-DcG-s_ff.js";/* empty css                        */import"./alert-DD6I4KQq.js";const U=({data:e,loading:d,visibleColumns:m,setupData:c,tableName:h,schemaName:x,childRecords:N=[],selectedColumns:w})=>{const j=k(),p=T(r=>r.user),[t,C]=l.useState(""),[g,f]=l.useState(null),[b,$]=l.useState(!1),[u,P]=l.useState([]);l.useEffect(()=>{c!=null&&c.process_steps&&P(c.process_steps)},[c]);const y=l.useMemo(()=>!e||!m||m.length===0?e:Object.keys(e).filter(r=>m.includes(r)).reduce((r,o)=>(r[o]=e[o],r),{}),[e,m]),_=()=>{e!=null&&e.us_id?j(`/${h}/record?pa_id=${e.us_id}&status=${e==null?void 0:e.status}&show=true`):f("Record ID not found")},i=l.useMemo(()=>{if(!e||!u||u.length===0)return[];const r=[];return u.forEach(o=>{const S=`${o}_balance`,a=e[S];a!=null&&Number(a)>0&&r.push({processName:o,balanceColumn:S,balance:a,displayText:`${o.charAt(0).toUpperCase()+o.slice(1)} (${a})`})}),r},[e,u]),n=l.useMemo(()=>t&&i.find(o=>o.processName===t)||null,[t,i]),B=r=>{C(r.target.value),f(null)},R=()=>{if(!t||!n){f("Please select a process first"),alert("Please select a process from the dropdown");return}const r=new URLSearchParams({schemaName:x,tableName:h,recordId:e==null?void 0:e.id,us_id:e==null?void 0:e.us_id,ownerId:p.owner_id===null?p.id:p.owner_id,current_process:n.processName});j(`/wastage?${r.toString()}`,{state:{parentRecord:e,childRecords:N,selectedProcess:n.processName,selectedBalance:n.balance,balanceColumn:n.balanceColumn,tableName:h,schemaName:x,setupData:c}})};return s.jsxs("div",{className:"",children:[s.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1.1rem",fontWeight:"600"},children:"Original Record Details"}),s.jsx(W,{data:y,loading:d,selectedColumns:w}),i&&i.length>0?s.jsxs(s.Fragment,{children:[s.jsx("h3",{style:{marginTop:"1.5rem",marginBottom:"1rem",fontSize:"1.1rem",fontWeight:"600"},children:"Select Process for Wastage"}),s.jsxs("div",{className:"select-wrapper",style:{marginBottom:"1rem"},children:[s.jsxs("select",{id:"process-selection",value:t,onChange:B,className:`select ${g&&!t?"select-error":""}`,disabled:b||d,children:[s.jsx("option",{value:"",disabled:!0,className:"placeholder-option",children:"-- Select Process (with balance > 0) --"}),i.map(r=>s.jsx("option",{value:r.processName,className:"option",children:r.displayText},r.processName))]}),s.jsx("div",{className:"select-arrow",children:s.jsx("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",children:s.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),g&&s.jsx("div",{className:"error-message",style:{color:"red",marginTop:"0.5rem"},children:g})]}),n&&s.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#e0f2fe",borderRadius:"0.5rem",marginBottom:"1rem",border:"2px solid #0284c7"},children:s.jsxs("p",{style:{margin:0,fontSize:"0.95rem",fontWeight:"600",color:"#0c4a6e"},children:["Selected Process: ",s.jsx("strong",{children:n.processName.toUpperCase()})," - Balance: ",s.jsx("strong",{children:n.balance})]})})]}):s.jsx("div",{style:{padding:"1rem",backgroundColor:"#f3f4f6",borderRadius:"0.5rem",marginTop:"1.5rem"},children:s.jsx("p",{style:{margin:0,color:"#6b7280"},children:"No processes with balance > 0 available for wastage in the original record."})}),s.jsxs("div",{className:"action-buttons",style:{marginTop:"1.5rem"},children:[s.jsx(v,{className:"button",onClick:R,disabled:d||!e||b||!t,"aria-label":"Move to wastage page",children:b?"Processing...":"Enter Wastage"}),s.jsx(v,{className:"button",onClick:_,"aria-label":"Split job",disabled:d||!e,children:"Split This Job"})]})]})};export{U as default};
