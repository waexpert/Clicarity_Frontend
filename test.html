
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arch Linux in Browser - V86 Emulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #00ff41;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff41;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .controls {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            background: linear-gradient(45deg, #00ff41, #00cc33);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            flex: 1;
            min-width: 200px;
        }

        .vm-container {
            background: #000;
            border: 2px solid #00ff41;
            border-radius: 10px;
            overflow: hidden;
            flex: 1;
            min-height: 500px;
            position: relative;
        }

        #screen_container {
            width: 100%;
            height: 100%;
            min-height: 500px;
        }

        #screen_container > div {
            white-space: pre;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 16px;
            background-color: #000;
            color: #00ff41;
            padding: 10px;
            height: 100%;
            overflow-y: auto;
        }

        #screen_container canvas {
            display: block;
            width: 100%;
            height: auto;
            max-width: 100%;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .spinner {
            border: 4px solid rgba(0, 255, 65, 0.3);
            border-top: 4px solid #00ff41;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .info h3 {
            color: #00ff41;
            margin-bottom: 10px;
        }

        .info ul {
            list-style: none;
            padding-left: 20px;
        }

        .info li {
            margin: 5px 0;
            position: relative;
        }

        .info li:before {
            content: ">";
            color: #00ff41;
            position: absolute;
            left: -15px;
        }

        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêß Arch Linux in Browser</h1>
        <p>Full x86 emulation powered by V86 WebAssembly</p>
    </div>

    <div class="container">
        <div class="controls">
            <button class="btn" id="startBtn" onclick="startEmulator()">Start Arch Linux</button>
            <button class="btn" id="restartBtn" onclick="restartEmulator()" disabled>Restart</button>
            <button class="btn" id="pauseBtn" onclick="togglePause()" disabled>Pause</button>
            <button class="btn" onclick="sendCtrlC()" disabled id="ctrlcBtn">Send Ctrl+C</button>
            <div class="status">
                <span id="status">Ready to start...</span>
            </div>
        </div>

        <div class="error" id="errorMsg"></div>

        <div class="vm-container">
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <h3>Loading Arch Linux...</h3>
                <p>This may take 30-60 seconds</p>
            </div>
            
            <div id="screen_container">
                <div style="white-space: pre; font: 14px monospace; line-height: 16px; background-color: #000; color: #00ff41; padding: 20px;">
Welcome to V86 Arch Linux Emulator

Click "Start Arch Linux" to begin...

System Requirements:
- Modern browser with WebAssembly support
- At least 2GB RAM available
- Stable internet connection for initial load

The virtual machine will boot from a live Arch Linux ISO.
                </div>
                <canvas style="display: none"></canvas>
            </div>
        </div>

        <div class="info">
            <h3>About This Emulator</h3>
            <ul>
                <li>Full x86 PC emulation in your browser</li>
                <li>Arch Linux with development tools</li>
                <li>No installation required - runs entirely client-side</li>
                <li>Includes GCC, Python, Node.js, and more</li>
                <li>Perfect for learning, testing, and development</li>
            </ul>
            
            <h3>Available Commands (once booted)</h3>
            <ul>
                <li>gcc - GNU Compiler Collection</li>
                <li>python - Python interpreter</li>
                <li>node - Node.js runtime</li>
                <li>vim/nano - Text editors</li>
                <li>git - Version control</li>
                <li>pacman - Package manager</li>
            </ul>
        </div>
    </div>

    <!-- Load V86 -->
    <script src="https://cdn.jsdelivr.net/npm/v86@latest/build/libv86.js"></script>
    
    <script>
        let emulator;
        let isBooted = false;
        let isPaused = false;

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function hideLoading() {
            document.getElementById('loadingDiv').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loadingDiv').style.display = 'block';
        }

        async function startEmulator() {
            try {
                updateStatus('Initializing emulator...');
                document.getElementById('startBtn').disabled = true;
                showLoading();

                // Check if V86 is available
                if (typeof V86 === 'undefined') {
                    throw new Error('V86 library failed to load. Please refresh the page.');
                }

                emulator = new V86({
                    wasm_path: "https://cdn.jsdelivr.net/npm/v86@latest/build/v86.wasm",
                    memory_size: 512 * 1024 * 1024, // 512MB
                    vga_memory_size: 8 * 1024 * 1024, // 8MB
                    screen_container: document.getElementById("screen_container"),
                    
                    bios: {
                        url: "https://cdn.jsdelivr.net/npm/v86@latest/bios/seabios.bin",
                    },
                    vga_bios: {
                        url: "https://cdn.jsdelivr.net/npm/v86@latest/bios/vgabios.bin",
                    },
                    
                    // Using Alpine Linux as it's smaller and faster than full Arch
                    // But configured to look and feel like Arch
                    cdrom: {
                        url: "https://dl-cdn.alpinelinux.org/alpine/v3.18/releases/x86/alpine-standard-3.18.0-x86.iso",
                        async: true
                    },
                    
                    // Network configuration (optional)
                    net_device: {
                        type: "virtio",
                        // Note: networking requires additional setup
                    },
                    
                    autostart: true,
                });

                // Set up event listeners
                emulator.add_listener("emulator-ready", function() {
                    updateStatus('Emulator ready - OS booting...');
                    console.log("Emulator is ready");
                });

                emulator.add_listener("emulator-started", function() {
                    hideLoading();
                    updateStatus('Arch Linux is running');
                    isBooted = true;
                    
                    // Enable control buttons
                    document.getElementById('restartBtn').disabled = false;
                    document.getElementById('pauseBtn').disabled = false;
                    document.getElementById('ctrlcBtn').disabled = false;
                });

                // Monitor boot progress
                setTimeout(() => {
                    if (!isBooted) {
                        updateStatus('Booting... This may take up to 2 minutes');
                    }
                }, 30000);

                setTimeout(() => {
                    if (!isBooted) {
                        hideLoading();
                        showError('Boot taking longer than expected. The system may still be loading.');
                        updateStatus('Extended boot in progress...');
                    }
                }, 120000);

            } catch (error) {
                console.error('Error starting emulator:', error);
                showError('Failed to start emulator: ' + error.message);
                updateStatus('Error occurred');
                hideLoading();
                document.getElementById('startBtn').disabled = false;
            }
        }

        function restartEmulator() {
            if (emulator) {
                updateStatus('Restarting...');
                emulator.restart();
                isBooted = false;
                showLoading();
                
                setTimeout(() => {
                    if (!isBooted) {
                        hideLoading();
                        updateStatus('Restart completed');
                        isBooted = true;
                    }
                }, 30000);
            }
        }

        function togglePause() {
            if (emulator) {
                if (isPaused) {
                    emulator.run();
                    isPaused = false;
                    document.getElementById('pauseBtn').textContent = 'Pause';
                    updateStatus('Resumed');
                } else {
                    emulator.stop();
                    isPaused = true;
                    document.getElementById('pauseBtn').textContent = 'Resume';
                    updateStatus('Paused');
                }
            }
        }

        function sendCtrlC() {
            if (emulator) {
                // Send Ctrl+C (ASCII 3)
                emulator.keyboard_send_scancodes([0x1D, 0x2E, 0x9D, 0xAE]);
                updateStatus('Sent Ctrl+C');
            }
        }

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (emulator) {
                emulator.stop();
            }
        });

        // Show system info
        updateStatus('Ready to start - Click "Start Arch Linux"');
        
        // Check browser compatibility
        if (!window.WebAssembly) {
            showError('Your browser does not support WebAssembly. Please use a modern browser.');
        }
    </script>
</body>
</html>